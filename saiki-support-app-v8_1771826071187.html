<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>„Åï„ÅÑ„ÅçËë¨Á•≠ „ÅîËë¨ÂÑÄ„Çµ„Éù„Éº„Éà</title>
<style>
  /* ===================================================
     „Ç´„É©„Éº„Éë„É¨„ÉÉ„ÉàÔºàCSSÂ§âÊï∞Ôºâ
     primary  : „É©„Ç§„É†„Ç∞„É™„Éº„É≥ #7CB342
     secondary: Ê∑°„ÅÑ„Éî„É≥„ÇØ   #F48FB1
  =================================================== */
  :root {
    --clr-primary:     #7CB342;
    --clr-primary-d:   #558B2F;
    --clr-primary-l:   #9CCC65;
    --clr-primary-bg:  #F1F8E9;
    --clr-primary-lt:  #DCEDC8;
    --clr-pink:        #F48FB1;
    --clr-pink-d:      #E91E63;
    --clr-pink-bg:     #FCE4EC;
    --clr-pink-lt:     #F8BBD0;
    --clr-bg:          #F4FBF0;
    --clr-text:        #2E3A1F;
    --clr-text-sub:    #5A6A3A;
    --clr-border:      #C5E1A5;
    --clr-white:       #FFFFFF;
    --radius:          12px;
    --shadow:          0 4px 14px rgba(124,179,66,0.15);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Noto Sans JP', 'Hiragino Kaku Gothic Pro', Meiryo, sans-serif;
    background: var(--clr-bg);
    color: var(--clr-text);
    font-size: 16px;
    -webkit-text-size-adjust: 100%;
  }

  /* ===== „Éò„ÉÉ„ÉÄ„Éº ===== */
  .app-header {
    background: linear-gradient(135deg, var(--clr-primary-d) 0%, var(--clr-primary) 60%, #A5D66A 100%);
    color: #fff;
    padding: 18px 20px;
    text-align: center;
    box-shadow: 0 3px 12px rgba(85,139,47,0.35);
    position: relative;
    overflow: hidden;
  }
  .app-header::before {
    content: '';
    position: absolute; inset: 0;
    background: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.06'%3E%3Ccircle cx='20' cy='20' r='8'/%3E%3C/g%3E%3C/svg%3E");
  }
  .app-header h1 {
    font-size: 1.3rem;
    letter-spacing: 2px;
    text-shadow: 0 1px 3px rgba(0,0,0,0.2);
    position: relative;
  }
  .app-header p { font-size: 0.8rem; opacity: 0.9; margin-top: 4px; position: relative; }

  /* ===== Èü≥Â£∞ÂÖ•ÂäõÊ°àÂÜÖ„Éê„Éä„Éº ===== */
  .voice-notice {
    background: linear-gradient(135deg, var(--clr-primary-bg), var(--clr-primary-lt));
    border: 2px solid var(--clr-primary);
    border-radius: 10px;
    padding: 14px 16px;
    margin: 12px 16px;
    line-height: 1.7;
    display: flex; align-items: center; gap: 10px;
  }
  .voice-notice .icon { font-size: 1.8rem; }
  .voice-notice .text { font-size: 0.85rem; color: var(--clr-primary-d); font-weight: bold; line-height: 1.5; }

  /* ===== „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº ===== */
  .progress-bar {
    background: var(--clr-primary-lt);
    padding: 12px 16px;
    display: flex; gap: 6px; justify-content: flex-start; align-items: center;
    overflow-x: auto; scroll-behavior: smooth; -webkit-overflow-scrolling: touch;
  }
  .step-dot {
    width: 28px; height: 28px; border-radius: 50%;
    background: #C8E6C9; color: #fff; font-size: 0.7rem;
    display: flex; align-items: center; justify-content: center;
    font-weight: bold; flex-shrink: 0; transition: all 0.3s;
  }
  .step-dot.active {
    background: var(--clr-primary);
    box-shadow: 0 0 0 3px var(--clr-primary-lt), 0 0 0 5px var(--clr-primary);
    transform: scale(1.18);
  }
  .step-dot.done { background: var(--clr-primary-d); }
  .step-connector { width: 20px; height: 2px; background: #C8E6C9; flex-shrink: 0; transition: background 0.3s; }
  .step-connector.done { background: var(--clr-primary-d); }

  /* ===== „Çπ„ÉÜ„ÉÉ„Éó„Ç≥„É≥„ÉÜ„É≥„ÉÑ ===== */
  .step { display: none; padding: 20px 18px; }
  .step.active { display: block; }

  .step-title {
    font-size: 1.1rem; font-weight: bold; color: var(--clr-primary-d);
    margin-bottom: 16px; padding-bottom: 8px;
    border-bottom: 2.5px solid var(--clr-primary);
    display: flex; align-items: center; gap: 8px;
    position: relative;
  }
  .step-title .step-num {
    background: linear-gradient(135deg, var(--clr-primary), var(--clr-primary-d));
    color: #fff; width: 28px; height: 28px;
    border-radius: 50%; display: flex; align-items: center;
    justify-content: center; font-size: 0.85rem; flex-shrink: 0;
    box-shadow: 0 2px 6px rgba(124,179,66,0.4);
  }

  /* ===== „Éï„Ç©„Éº„É†Ë¶ÅÁ¥† ===== */
  .form-group { margin-bottom: 18px; }
  .form-label { font-size: 0.9rem; font-weight: bold; color: var(--clr-primary-d); margin-bottom: 8px; display: block; }
  .form-input {
    width: 100%; padding: 12px; border: 2px solid var(--clr-border);
    border-radius: 8px; font-size: 0.95rem;
    background: #fff; transition: border-color 0.2s, box-shadow 0.2s;
  }
  .form-input:focus { outline: none; border-color: var(--clr-primary); box-shadow: 0 0 0 3px rgba(124,179,66,0.15); }
  .form-select {
    width: 100%; padding: 12px; border: 2px solid var(--clr-border);
    border-radius: 8px; font-size: 0.95rem;
    background: #fff; appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8'%3E%3Cpath d='M0 0l6 8 6-8z' fill='%237CB342'/%3E%3C/svg%3E");
    background-repeat: no-repeat; background-position: right 12px center;
    cursor: pointer; transition: border-color 0.2s;
  }
  .form-select:focus { outline: none; border-color: var(--clr-primary); }

  /* ===== ÈÅ∏Êäû„Éú„Çø„É≥„Ç∞„É´„Éº„Éó ===== */
  .btn-group { display: flex; flex-direction: column; gap: 8px; }
  .btn-choice {
    width: 100%; padding: 14px 16px; border: 2px solid var(--clr-border);
    border-radius: 10px; background: #fff; cursor: pointer;
    text-align: left; font-size: 0.95rem; color: #333;
    transition: all 0.2s; display: flex; align-items: center; gap: 10px;
  }
  .btn-choice:hover { border-color: var(--clr-primary); background: var(--clr-primary-bg); }
  .btn-choice.selected {
    border-color: var(--clr-primary);
    background: linear-gradient(135deg, var(--clr-primary-bg), #E8F5E9);
    color: var(--clr-primary-d); font-weight: bold;
    box-shadow: 0 2px 8px rgba(124,179,66,0.2);
  }
  .btn-choice .choice-icon { font-size: 1.4rem; flex-shrink: 0; }
  .btn-choice .choice-text { flex: 1; }
  .btn-choice .choice-desc { font-size: 0.78rem; color: #888; margin-top: 2px; }
  .btn-choice.selected .choice-desc { color: var(--clr-primary); }
  .btn-choice .check-mark { display: none; color: var(--clr-primary); font-size: 1.2rem; }
  .btn-choice.selected .check-mark { display: block; }

  /* ===== „Éó„É©„É≥ÊèêÊ°à„Ç´„Éº„Éâ ===== */
  .plan-cards { display: flex; flex-direction: column; gap: 12px; margin-bottom: 16px; }
  .plan-card {
    border-radius: var(--radius); overflow: hidden;
    border: 2px solid var(--clr-border); background: #fff;
    transition: all 0.2s; cursor: pointer;
  }
  .plan-card:hover { border-color: var(--clr-primary); box-shadow: var(--shadow); }
  .plan-card.selected {
    border-color: var(--clr-primary);
    box-shadow: 0 4px 16px rgba(124,179,66,0.3);
  }
  .plan-card-badge {
    padding: 6px 14px; font-size: 0.78rem; font-weight: bold;
    display: flex; align-items: center; gap: 6px;
  }
  .badge-small { background: var(--clr-primary-bg); color: var(--clr-primary-d); }
  .badge-rec { background: linear-gradient(135deg, var(--clr-pink-lt), var(--clr-pink)); color: #880e4f; }
  .badge-large { background: var(--clr-pink-bg); color: #880e4f; }
  .plan-card-body { padding: 14px; }
  .plan-card-title { font-size: 1.05rem; font-weight: bold; color: #333; margin-bottom: 4px; }
  .plan-card-sub { font-size: 0.82rem; color: #888; margin-bottom: 8px; }
  .plan-card-desc { font-size: 0.85rem; color: #555; line-height: 1.6; }

  /* ===== „Éõ„Éº„É´„Ç´„Éº„Éâ ===== */
  .hall-cards { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; }
  @media (max-width: 400px) { .hall-cards { grid-template-columns: 1fr; } }
  .hall-card {
    border-radius: var(--radius); overflow: hidden;
    border: 2px solid var(--clr-border); background: #fff;
    cursor: pointer; transition: all 0.2s;
  }
  .hall-card:hover { border-color: var(--clr-primary); box-shadow: var(--shadow); }
  .hall-card.selected {
    border-color: var(--clr-primary);
    box-shadow: 0 4px 16px rgba(124,179,66,0.3);
  }
  .hall-card-img { width: 100%; height: 110px; object-fit: cover; }
  .hall-card-body { padding: 10px; }
  .hall-card-name { font-size: 0.85rem; font-weight: bold; color: #333; margin-bottom: 4px; }
  .hall-card-cap { font-size: 0.73rem; color: #888; margin-bottom: 3px; }
  .hall-card-addr { font-size: 0.7rem; color: #aaa; }
  .hall-recommended-badge {
    position: absolute; top: 6px; right: 6px;
    background: linear-gradient(135deg, var(--clr-pink), var(--clr-pink-d));
    color: #fff; font-size: 0.65rem;
    padding: 2px 6px; border-radius: 10px; font-weight: bold;
  }
  .hall-card-wrapper { position: relative; }
  .hall-selected-check {
    position: absolute; top: 6px; left: 6px; display: none;
    background: var(--clr-primary); color: #fff; width: 24px; height: 24px;
    border-radius: 50%; align-items: center; justify-content: center; font-size: 0.9rem;
  }
  .hall-card.selected .hall-selected-check { display: flex; }

  /* ===== „Ç≥„Éº„Çπ„Ç´„Éº„Éâ ===== */
  .course-cards { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; }
  @media (max-width: 400px) { .course-cards { grid-template-columns: 1fr; } }
  .course-card {
    border-radius: var(--radius); overflow: hidden;
    border: 2px solid var(--clr-border); background: #fff;
    cursor: pointer; transition: all 0.2s;
  }
  .course-card:hover { border-color: var(--clr-primary); box-shadow: var(--shadow); }
  .course-card.selected {
    border-color: var(--clr-pink);
    box-shadow: 0 4px 16px rgba(244,143,177,0.35);
  }
  .course-card-img { width: 100%; height: 130px; object-fit: cover; }
  .course-card-body { padding: 12px; }
  .course-card-name { font-size: 1rem; font-weight: bold; color: var(--clr-primary-d); margin-bottom: 4px; }
  .course-card-price { font-size: 0.82rem; color: #888; }
  .course-card-price .member-price { font-size: 1rem; font-weight: bold; color: var(--clr-primary); }
  .course-card-desc { font-size: 0.75rem; color: #888; margin-top: 4px; line-height: 1.5; }
  .course-selected-mark {
    display: none; text-align: center; padding: 4px;
    background: linear-gradient(90deg, var(--clr-primary-bg), var(--clr-pink-bg));
    font-size: 0.8rem; color: var(--clr-primary-d); font-weight: bold;
  }
  .course-card.selected .course-selected-mark { display: block; }

  /* ===== „Éä„Éì„Éú„Çø„É≥ ===== */
  .nav-buttons { display: flex; gap: 10px; margin-top: 20px; }
  .btn-back {
    flex: 1; padding: 14px; border: 2px solid var(--clr-border);
    border-radius: 10px; background: #fff; color: var(--clr-primary-d);
    font-size: 1rem; cursor: pointer; font-weight: bold;
    transition: all 0.2s;
  }
  .btn-back:hover { background: var(--clr-primary-bg); border-color: var(--clr-primary); }
  .btn-next {
    flex: 2; padding: 14px; border: none;
    border-radius: 10px;
    background: linear-gradient(135deg, var(--clr-primary), var(--clr-primary-d));
    color: #fff; font-size: 1rem; cursor: pointer;
    font-weight: bold; transition: all 0.2s;
    box-shadow: 0 3px 8px rgba(124,179,66,0.4);
  }
  .btn-next:hover {
    background: linear-gradient(135deg, var(--clr-primary-l), var(--clr-primary));
    transform: translateY(-1px);
  }
  .btn-next:disabled { background: #C8E6C9; cursor: not-allowed; transform: none; box-shadow: none; }
  .btn-finish {
    flex: 2; padding: 14px; border: none;
    border-radius: 10px;
    background: linear-gradient(135deg, var(--clr-primary), var(--clr-primary-d));
    color: #fff; font-size: 1rem; cursor: pointer;
    font-weight: bold; transition: all 0.2s;
    box-shadow: 0 3px 8px rgba(124,179,66,0.4);
  }

  /* ===== „ÉÜ„Ç≠„Çπ„Éà„Ç®„É™„Ç¢ ===== */
  .form-textarea {
    width: 100%; padding: 12px; border: 2px solid var(--clr-border);
    border-radius: 8px; font-size: 0.95rem; background: #fff;
    resize: vertical; min-height: 100px; font-family: inherit;
    transition: border-color 0.2s;
  }
  .form-textarea:focus { outline: none; border-color: var(--clr-primary); }

  /* ===== Ë¶ãÁ©ç„ÇÇ„Çä„Ç´„Éº„Éâ ===== */
  .estimate-card {
    background: #fff; border-radius: 14px;
    border: 2px solid var(--clr-border); padding: 20px 18px;
    margin-bottom: 16px;
    box-shadow: var(--shadow);
  }
  .estimate-section-title {
    font-size: 1.05rem; font-weight: bold; color: var(--clr-primary-d);
    margin-bottom: 12px; padding-bottom: 8px;
    border-bottom: 2px solid var(--clr-primary-lt);
  }
  .estimate-row {
    display: flex; justify-content: space-between;
    align-items: flex-start; padding: 10px 0;
    border-bottom: 1px solid var(--clr-primary-bg); font-size: 1rem;
  }
  .estimate-row:last-child { border-bottom: none; }
  .estimate-label { color: #666; flex: 1; }
  .estimate-value { color: #333; font-weight: bold; text-align: right; flex-shrink: 0; word-break: keep-all; max-width: 55%; }
  .estimate-total {
    background: linear-gradient(135deg, var(--clr-primary), var(--clr-primary-d));
    color: #fff; padding: 16px; border-radius: 12px;
    margin-top: 14px; text-align: center;
    box-shadow: 0 4px 12px rgba(124,179,66,0.3);
  }
  .estimate-total-label { font-size: 0.85rem; opacity: 0.9; margin-bottom: 4px; }
  .estimate-total-price { font-size: 1.9rem; font-weight: bold; }
  .estimate-total-note { font-size: 0.73rem; opacity: 0.8; margin-top: 4px; }
  
  /* Á∑èÂêàË®àÁõ¥‰∏ã„ÅÆË≠¶Âëä */
  .estimate-total-warning {
    margin-top: 10px;
    padding: 12px 14px;
    background: linear-gradient(135deg, #fff3e0, #ffe0b2);
    border: 2px solid #ff6f00;
    border-radius: 8px;
    text-align: left;
  }
  .estimate-total-warning-title {
    font-size: 0.95rem;
    font-weight: bold;
    color: #d84315;
    margin-bottom: 6px;
    text-align: center;
  }
  .estimate-total-warning-text {
    font-size: 0.85rem;
    color: #bf360c;
    line-height: 1.6;
    font-weight: 500;
  }

  /* ===== STEP8 ÂÆå‰∫ÜÁîªÈù¢ ===== */
  /* Á¥ôÂêπÈõ™„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
  @keyframes confettiFall {
    0%   { transform: translateY(-20px) rotate(0deg);  opacity: 1; }
    100% { transform: translateY(120px) rotate(360deg); opacity: 0; }
  }
  @keyframes confettiSway {
    0%,100% { margin-left: 0; }
    50%      { margin-left: 14px; }
  }
  @keyframes pulse-ring {
    0%   { transform: scale(0.85); box-shadow: 0 0 0 0 rgba(124,179,66,0.5); }
    70%  { transform: scale(1);    box-shadow: 0 0 0 16px rgba(124,179,66,0); }
    100% { transform: scale(0.85); box-shadow: 0 0 0 0  rgba(124,179,66,0); }
  }
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(18px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  @keyframes heartbeat {
    0%,100% { transform: scale(1); }
    14%     { transform: scale(1.2); }
    28%     { transform: scale(1); }
    42%     { transform: scale(1.15); }
    70%     { transform: scale(1); }
  }

  .confetti-wrap {
    position: relative; height: 56px; overflow: hidden;
    margin-bottom: 4px; pointer-events: none;
  }
  .confetti-piece {
    position: absolute; top: -10px; width: 8px; height: 8px;
    border-radius: 2px;
    animation: confettiFall 1.8s ease-in infinite, confettiSway 1.2s ease-in-out infinite;
  }

  .complete-card {
    background: linear-gradient(160deg, var(--clr-primary-bg) 0%, #fff 40%, var(--clr-pink-bg) 100%);
    border-radius: 20px;
    border: 2.5px solid var(--clr-primary);
    padding: 28px 22px 22px;
    text-align: center; margin-bottom: 18px;
    box-shadow: 0 8px 32px rgba(124,179,66,0.18), 0 2px 8px rgba(244,143,177,0.15);
    animation: fadeInUp 0.6s ease both;
  }
  .complete-icon {
    font-size: 3.6rem; margin-bottom: 10px;
    display: inline-block;
    animation: heartbeat 2.4s ease-in-out infinite;
  }
  .complete-badge {
    display: inline-block;
    background: linear-gradient(135deg, var(--clr-primary), var(--clr-primary-d));
    color: #fff; font-size: 0.72rem; font-weight: bold;
    padding: 4px 14px; border-radius: 20px; letter-spacing: 1px;
    margin-bottom: 12px;
    box-shadow: 0 2px 8px rgba(124,179,66,0.3);
  }
  .complete-title {
    font-size: 1.45rem; font-weight: bold;
    background: linear-gradient(135deg, var(--clr-primary-d), var(--clr-pink-d));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 10px; line-height: 1.4;
  }
  .complete-subtitle {
    font-size: 0.9rem; color: var(--clr-primary-d); font-weight: bold;
    margin-bottom: 14px; opacity: 0.85;
  }
  .complete-divider {
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--clr-primary-lt), var(--clr-pink-lt), transparent);
    margin: 14px 0;
    border-radius: 1px;
  }
  .complete-text {
    font-size: 0.9rem; color: #555; line-height: 1.9;
    background: rgba(255,255,255,0.7); border-radius: 10px;
    padding: 14px; margin-top: 4px;
  }
  .complete-phone {
    display: inline-flex; align-items: center; gap: 8px;
    background: linear-gradient(135deg, var(--clr-primary), var(--clr-primary-d));
    color: #fff; font-size: 1.15rem; font-weight: bold;
    padding: 10px 22px; border-radius: 30px; margin: 10px 0;
    box-shadow: 0 4px 12px rgba(124,179,66,0.35);
    text-decoration: none;
  }
  .complete-hours { font-size: 0.78rem; color: var(--clr-primary-d); margin-top: 4px; opacity: 0.8; }

  /* STEP8 „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ */
  .step8-actions {
    display: flex; flex-direction: column; gap: 12px;
    margin: 20px 0 10px;
    animation: fadeInUp 0.8s ease 0.3s both;
  }
  .step8-actions-title {
    text-align: center; font-size: 0.88rem; font-weight: bold;
    color: var(--clr-primary-d); margin-bottom: 4px;
    display: flex; align-items: center; justify-content: center; gap: 6px;
  }
  .btn-s8 {
    display: flex; align-items: center; justify-content: center; gap: 10px;
    padding: 16px 20px; border: none; border-radius: 14px;
    font-size: 1.05rem; font-weight: bold; letter-spacing: 0.04em;
    cursor: pointer; width: 100%; min-height: 58px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.14);
    transition: transform 0.15s, box-shadow 0.15s;
    text-decoration: none;
  }
  .btn-s8:active { transform: scale(0.97); box-shadow: 0 2px 6px rgba(0,0,0,0.12); }
  .btn-s8 .s8-icon { font-size: 1.5rem; flex-shrink: 0; }
  .btn-s8 .s8-label { display: flex; flex-direction: column; align-items: flex-start; line-height: 1.3; }
  .btn-s8 .s8-main { font-size: 1.05rem; font-weight: bold; }
  .btn-s8 .s8-sub  { font-size: 0.78rem; opacity: 0.88; font-weight: normal; }

  .btn-s8-line  { background: linear-gradient(135deg, #00B900, #008000); color: #fff; }
  .btn-s8-sms   { background: linear-gradient(135deg, var(--clr-primary), var(--clr-primary-d)); color: #fff; }
  .btn-s8-pdf   { background: linear-gradient(135deg, #EF5350, #B71C1C); color: #fff; }
  .btn-s8-restart {
    background: linear-gradient(135deg, var(--clr-pink-lt), var(--clr-pink));
    color: #4a148c; border: none;
  }

  /* ===== ÊÉÖÂ†±„Éú„ÉÉ„ÇØ„Çπ ===== */
  /* ===== Âº∑Ë™øË≠¶Âëä„Éú„ÉÉ„ÇØ„ÇπÔºàÊ≠£ÂºèË¶ãÁ©ç„ÇÇ„Çä„Åß„ÅØ„Å™„ÅÑÊ≥®ÊÑèÔºâ ===== */
  .warning-box-strong {
    background: linear-gradient(135deg, #fff3e0, #ffe0b2);
    border: 3px solid #ff6f00;
    border-radius: 12px;
    padding: 18px 16px;
    margin: 16px 0;
    box-shadow: 0 4px 12px rgba(255, 111, 0, 0.25);
    animation: warning-pulse 2s ease-in-out infinite;
  }
  
  @keyframes warning-pulse {
    0%, 100% { box-shadow: 0 4px 12px rgba(255, 111, 0, 0.25); }
    50% { box-shadow: 0 4px 16px rgba(255, 111, 0, 0.4), 0 0 0 4px rgba(255, 111, 0, 0.1); }
  }
  
  .warning-box-strong .warning-icon {
    font-size: 2.5rem;
    text-align: center;
    margin-bottom: 8px;
    animation: warning-shake 3s ease-in-out infinite;
  }
  
  @keyframes warning-shake {
    0%, 100% { transform: rotate(0deg); }
    10%, 30%, 50%, 70%, 90% { transform: rotate(-5deg); }
    20%, 40%, 60%, 80% { transform: rotate(5deg); }
  }
  
  .warning-box-strong .warning-title {
    font-size: 1.15rem;
    font-weight: bold;
    color: #e65100;
    text-align: center;
    margin-bottom: 10px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }
  
  .warning-box-strong .warning-content {
    font-size: 0.95rem;
    color: #bf360c;
    line-height: 1.8;
    background: rgba(255, 255, 255, 0.7);
    padding: 12px;
    border-radius: 8px;
    font-weight: 500;
  }
  
  .warning-box-strong .warning-emphasis {
    display: block;
    font-size: 1.05rem;
    font-weight: bold;
    color: #d84315;
    margin-top: 10px;
    text-align: center;
    padding: 8px;
    background: rgba(255, 111, 0, 0.15);
    border-radius: 6px;
    border: 2px dashed #ff6f00;
  }

  .info-box {
    background: linear-gradient(135deg, var(--clr-primary-bg), var(--clr-pink-bg));
    border: 1px solid var(--clr-primary-lt);
    border-radius: 8px; padding: 14px; margin-top: 12px;
    font-size: 0.92rem; color: #666; line-height: 1.8;
  }

  /* ===== „Éõ„Éº„É´Ë©≥Á¥∞ ===== */
  .selected-hall-detail {
    background: var(--clr-primary-bg); border-radius: 8px;
    padding: 12px; margin-top: 12px;
    border: 1px solid var(--clr-border); font-size: 0.83rem;
    color: #666; line-height: 1.7;
  }

  /* ===== „Ç®„É©„ÉºË°®Á§∫ ===== */
  .error-msg { color: #E53935; font-size: 0.8rem; margin-top: 4px; display: none; }
  .required  { color: #E53935; margin-left: 4px; }

  /* ===== ÈÅ∏Êäû„Çµ„Éû„É™„Éº ===== */
  .selection-summary {
    background: var(--clr-primary-bg); border-radius: 8px; padding: 10px 14px;
    margin-bottom: 14px; font-size: 0.82rem; color: var(--clr-primary-d);
    border-left: 3px solid var(--clr-primary);
  }

  /* ===== „ÇÑ„Åô„Çâ„Åé„É™„Éì„É≥„Ç∞ÁâπÂà•„Éê„ÉÉ„Ç∏ ===== */
  .living-badge {
    display: inline-block; background: var(--clr-primary-bg); color: var(--clr-primary-d);
    font-size: 0.7rem; padding: 2px 8px; border-radius: 10px;
    font-weight: bold; margin-top: 4px;
  }

  .hall-all-btn {
    width: 100%; padding: 12px; border: 2px dashed var(--clr-border);
    border-radius: 10px; background: #fafafa; cursor: pointer;
    text-align: center; font-size: 0.9rem; color: var(--clr-primary-d);
    transition: all 0.2s; margin-top: 8px; font-weight: bold;
  }
  .hall-all-btn:hover { background: var(--clr-primary-bg); border-color: var(--clr-primary); }

  /* ===== „Éó„É©„É≥„Çø„Ç§„Éó„É©„Éô„É´ ===== */
  .plan-type-tag {
    display: inline-block; font-size: 0.7rem; padding: 2px 8px;
    border-radius: 10px; font-weight: bold; margin-left: 6px;
  }
  .tag-compact { background: var(--clr-primary-bg);  color: var(--clr-primary-d); }
  .tag-living  { background: #E8F5E9; color: #2E7D32; }
  .tag-family  { background: #FFF3E0; color: #E65100; }
  .tag-normal  { background: var(--clr-pink-bg);     color: #880E4F; }

  /* ===== „ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà ===== */
  .chat-window {
    background: var(--clr-primary-bg); border-radius: 14px; overflow: hidden;
    border: 2px solid var(--clr-border); margin-bottom: 14px;
    display: flex; flex-direction: column; height: 380px;
  }
  .chat-header {
    background: linear-gradient(135deg, var(--clr-primary), var(--clr-primary-d));
    color: #fff; padding: 10px 14px;
    display: flex; align-items: center; gap: 8px;
    font-size: 0.88rem; font-weight: bold; flex-shrink: 0;
  }
  .chat-header .bot-avatar {
    width: 30px; height: 30px; border-radius: 50%;
    background: #fff; display: flex; align-items: center;
    justify-content: center; font-size: 1rem;
  }
  .chat-messages {
    flex: 1; overflow-y: auto; padding: 12px;
    display: flex; flex-direction: column; gap: 10px;
  }
  .chat-msg { display: flex; gap: 8px; align-items: flex-end; max-width: 88%; }
  .chat-msg.bot  { align-self: flex-start; }
  .chat-msg.user { align-self: flex-end; flex-direction: row-reverse; }
  .msg-avatar {
    width: 28px; height: 28px; border-radius: 50%;
    background: var(--clr-primary); color: #fff; font-size: 0.8rem;
    display: flex; align-items: center; justify-content: center; flex-shrink: 0;
  }
  .msg-avatar.user-av { background: var(--clr-primary-d); }
  .msg-bubble {
    padding: 10px 13px; border-radius: 16px;
    font-size: 0.88rem; line-height: 1.6; max-width: 100%;
  }
  .bot  .msg-bubble {
    background: #fff; color: #333;
    border-bottom-left-radius: 4px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  }
  .user .msg-bubble {
    background: linear-gradient(135deg, var(--clr-primary), var(--clr-primary-d));
    color: #fff; border-bottom-right-radius: 4px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.2);
  }
  .chat-typing {
    display: none; align-self: flex-start;
    padding: 8px 14px; background: #fff; border-radius: 16px;
    border-bottom-left-radius: 4px; font-size: 0.82rem; color: #999;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  }
  .chat-typing.show { display: block; }
  .typing-dots { display: inline-flex; gap: 3px; }
  .typing-dots span {
    width: 6px; height: 6px; background: #bbb; border-radius: 50%;
    animation: typingBounce 1.2s infinite;
  }
  .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
  .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
  @keyframes typingBounce {
    0%,60%,100% { transform: translateY(0); }
    30%          { transform: translateY(-5px); }
  }
  /* „ÇØ„Ç§„ÉÉ„ÇØ„É™„Éó„É©„Ç§ */
  .quick-replies {
    padding: 8px 12px; display: flex; flex-wrap: wrap;
    gap: 6px; background: #fff; border-top: 1px solid var(--clr-primary-lt);
    flex-shrink: 0;
  }
  .quick-reply-btn {
    padding: 6px 12px; border: 1.5px solid var(--clr-primary);
    border-radius: 20px; background: #fff; color: var(--clr-primary-d);
    font-size: 0.78rem; cursor: pointer; font-weight: bold;
    transition: all 0.2s; white-space: nowrap;
  }
  .quick-reply-btn:hover { background: var(--clr-primary-bg); }
  /* „ÉÅ„É£„ÉÉ„ÉàÂÖ•Âäõ„Ç®„É™„Ç¢ */
  .chat-input-area {
    display: flex; gap: 6px; padding: 8px 12px;
    background: #fff; border-top: 2px solid var(--clr-primary-lt);
    flex-shrink: 0; align-items: center;
  }
  .chat-input {
    flex: 1; padding: 8px 12px; border: 2px solid var(--clr-border);
    border-radius: 20px; font-size: 0.9rem;
    outline: none; font-family: inherit; resize: none;
    max-height: 80px; line-height: 1.4;
  }
  .chat-input:focus { border-color: var(--clr-primary); }
  .chat-send-btn {
    width: 36px; height: 36px; border: none;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--clr-primary), var(--clr-primary-d));
    color: #fff; font-size: 1rem; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0; transition: all 0.2s;
  }
  .chat-send-btn:hover { transform: scale(1.08); }
  .chat-send-btn:disabled { background: #C8E6C9; cursor: not-allowed; }
  /* „ÉÅ„É£„ÉÉ„ÉàÂÆå‰∫Ü„Éê„Éä„Éº */
  .chat-done-banner {
    display: none; background: var(--clr-primary-bg); border: 2px solid var(--clr-primary);
    border-radius: 10px; padding: 10px 14px; margin-bottom: 10px;
    font-size: 0.85rem; color: var(--clr-primary-d); font-weight: bold;
  }
  .chat-done-banner.show { display: block; }

  /* ===== ÂÜôÁúü„Ç§„É°„Éº„Ç∏Ê≥®Ë®ò ===== */
  .image-notice {
    background: var(--clr-primary-bg); border: 1px solid var(--clr-primary-lt);
    border-radius: 8px; padding: 8px 12px;
    font-size: 0.78rem; color: var(--clr-primary-d);
    margin-bottom: 10px; text-align: center; font-weight: bold;
  }

  /* ===== ÂΩìÊó•ÂÖ•‰ºö„Éê„ÉÉ„Ç∏ ===== */
  .join-badge {
    display: inline-block; background: var(--clr-pink-bg); color: var(--clr-pink-d);
    font-size: 0.68rem; padding: 1px 6px; border-radius: 8px;
    font-weight: bold; margin-left: 4px; border: 1px solid var(--clr-pink-lt);
  }

  /* ===== Âç∞Âà∑Áî®„Çπ„Çø„Ç§„É´ ===== */
  @media print {
    body { background: #fff !important; }
    .app-header, .voice-notice, .progress-bar, .nav-buttons,
    .btn-finish, .step:not(#step8), .chat-window,
    .chat-input-area, .quick-replies, #autoSaveBanner { display: none !important; }
    #step8 { display: block !important; }
    .print-header { display: block !important; }
    .print-chat-log { display: block !important; }
    .print-summary { display: block !important; }
    .no-print { display: none !important; }
    .complete-card { border: 1px solid #ccc !important; box-shadow: none !important;
      background: #fff !important; }
    .pdf-chat-bubble-bot  { background: #f5f5f5 !important; }
    .pdf-chat-bubble-user { background: var(--clr-primary-lt) !important; }
    @page { margin: 15mm; size: A4; }
  }

  /* ===== Âç∞Âà∑Â∞ÇÁî®„Éò„ÉÉ„ÉÄ„Éº ===== */
  .print-header {
    display: none; text-align: center; padding: 16px 0 10px;
    border-bottom: 2px solid var(--clr-primary); margin-bottom: 14px;
  }
  .print-header h2 { font-size: 1.2rem; color: var(--clr-primary-d); letter-spacing: 2px; }
  .print-header p  { font-size: 0.78rem; color: #888; margin-top: 4px; }

  /* ===== „ÉÅ„É£„ÉÉ„ÉàÂ±•Ê≠¥PDFÁî® ===== */
  .print-chat-log {
    display: none;
    background: var(--clr-primary-bg); border: 2px solid var(--clr-border);
    border-radius: 12px; padding: 16px; margin-bottom: 14px;
  }
  .print-chat-log-title {
    font-size: 0.95rem; font-weight: bold; color: var(--clr-primary-d);
    margin-bottom: 12px; padding-bottom: 6px;
    border-bottom: 2px solid var(--clr-primary);
    display: flex; align-items: center; gap: 6px;
  }
  .pdf-chat-row { display: flex; gap: 8px; margin-bottom: 8px; align-items: flex-start; }
  .pdf-chat-row.user-row { flex-direction: row-reverse; }
  .pdf-chat-label {
    font-size: 0.72rem; font-weight: bold; white-space: nowrap;
    padding-top: 3px; color: #888; flex-shrink: 0;
  }
  .pdf-chat-row.user-row .pdf-chat-label { color: var(--clr-primary-d); }
  .pdf-chat-bubble-bot {
    background: #fff; border: 1px solid var(--clr-border);
    border-radius: 12px; border-bottom-left-radius: 3px;
    padding: 8px 12px; font-size: 0.85rem; line-height: 1.65;
    color: #333; max-width: 82%;
  }
  .pdf-chat-bubble-user {
    background: var(--clr-primary-lt); border: 1px solid var(--clr-primary);
    border-radius: 12px; border-bottom-right-radius: 3px;
    padding: 8px 12px; font-size: 0.85rem; line-height: 1.65;
    color: var(--clr-primary-d); font-weight: bold; max-width: 82%;
  }
  .pdf-chat-time { font-size: 0.68rem; color: #bbb; margin-top: 2px; text-align: right; }
  .pdf-chat-row.user-row .pdf-chat-time { text-align: left; }

  /* ===== FAQ„Éë„Éç„É´ ===== */
  .faq-panel {
    background: #fff; border: 2px solid var(--clr-border);
    border-radius: 14px; margin-bottom: 12px; overflow: hidden;
  }
  .faq-panel-header {
    background: linear-gradient(135deg, var(--clr-primary-bg), var(--clr-primary-lt));
    padding: 10px 14px; display: flex; align-items: center;
    justify-content: space-between; cursor: pointer; user-select: none;
  }
  .faq-panel-header-left {
    display: flex; align-items: center; gap: 8px;
    font-size: 0.88rem; font-weight: bold; color: var(--clr-primary-d);
  }
  .faq-toggle-icon { font-size: 0.75rem; color: var(--clr-primary); transition: transform 0.3s; }
  .faq-toggle-icon.open { transform: rotate(180deg); }
  .faq-body { display: none; padding: 10px 12px 12px; }
  .faq-body.open { display: block; }
  .faq-category { margin-bottom: 10px; }
  .faq-category-label {
    font-size: 0.75rem; font-weight: bold; color: var(--clr-primary-d);
    margin-bottom: 6px; padding: 3px 8px;
    background: var(--clr-primary-bg); border-radius: 6px; display: inline-block;
  }
  .faq-items { display: flex; flex-wrap: wrap; gap: 6px; }
  .faq-btn {
    padding: 7px 12px; border: 1.5px solid var(--clr-primary);
    border-radius: 20px; background: #fff; color: var(--clr-primary-d);
    font-size: 0.78rem; cursor: pointer; font-weight: bold;
    transition: all 0.2s; display: flex; align-items: center; gap: 4px;
  }
  .faq-btn:hover {
    background: var(--clr-primary-bg); border-color: var(--clr-primary-d);
    transform: translateY(-1px); box-shadow: 0 2px 6px rgba(124,179,66,0.2);
  }
  .faq-btn .faq-icon { font-size: 0.9rem; }
  .faq-btn.used { background: var(--clr-primary-bg); border-color: var(--clr-primary); color: var(--clr-primary-d); cursor: default; }
  .faq-btn.used:hover { transform: none; box-shadow: none; }

  /* FAQÊèêÊ°à„Éê„Éä„Éº */
  .chat-faq-suggest {
    background: linear-gradient(135deg, var(--clr-primary-bg), #fff);
    border: 1.5px solid var(--clr-primary-lt);
    border-radius: 10px; padding: 8px 10px;
    margin: 6px 0 2px; font-size: 0.78rem; color: var(--clr-primary-d);
  }
  .chat-faq-suggest-title { font-weight: bold; margin-bottom: 5px; display: flex; align-items: center; gap: 4px; }
  .chat-faq-suggest-btns { display: flex; flex-wrap: wrap; gap: 5px; }
  .chat-faq-suggest-btn {
    padding: 5px 10px; border: 1.5px solid var(--clr-primary);
    border-radius: 16px; background: #fff; color: var(--clr-primary-d);
    font-size: 0.75rem; cursor: pointer; font-weight: bold; transition: all 0.18s;
  }
  .chat-faq-suggest-btn:hover { background: var(--clr-primary-bg); }

  /* FAQÂõûÁ≠î„Éê„Éñ„É´ */
  .faq-answer-bubble {
    background: #fffeff; border: 1px solid var(--clr-primary-lt);
    border-radius: 12px; border-bottom-left-radius: 3px;
    padding: 10px 13px; font-size: 0.85rem; line-height: 1.7;
    color: #333; max-width: 100%;
    box-shadow: 0 1px 4px rgba(0,0,0,0.08);
  }
  .faq-answer-bubble strong { color: var(--clr-primary-d); }
  .faq-answer-badge {
    display: inline-block; font-size: 0.68rem;
    background: var(--clr-primary-bg); color: var(--clr-primary-d);
    border: 1px solid var(--clr-primary-lt); border-radius: 8px;
    padding: 1px 6px; margin-bottom: 4px; font-weight: bold;
  }

  /* ===== ÈÄÅ‰ø°Âá¶ÁêÜUI ===== */
  .submit-overlay {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,0.55); z-index: 9999;
    align-items: center; justify-content: center;
    flex-direction: column; gap: 14px;
  }
  .submit-overlay.show { display: flex; }
  .submit-spinner {
    width: 52px; height: 52px; border: 5px solid var(--clr-primary-lt);
    border-top-color: var(--clr-primary); border-radius: 50%;
    animation: spin 0.9s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .submit-overlay-text { color: #fff; font-size: 1.05rem; font-weight: bold; }
  .submit-result-banner {
    display: none; margin: 12px 0; padding: 14px 16px;
    border-radius: 10px; font-size: 0.9rem; line-height: 1.7; text-align: center;
  }
  .submit-result-banner.success { display: block; background: var(--clr-primary-bg); border: 2px solid var(--clr-primary); color: var(--clr-primary-d); }
  .submit-result-banner.error   { display: block; background: #fce4ec; border: 2px solid #ef9a9a; color: #b71c1c; }

  /* ===== Ë¶ãÁ©ç„ÇÇ„Çä„Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ ===== */
  .estimate-action-buttons { display: flex; flex-direction: column; gap: 12px; margin: 20px 0 10px; }
  .btn-estimate-action {
    display: flex; align-items: center; justify-content: center; gap: 8px;
    padding: 16px 20px; border: none; border-radius: 14px;
    font-size: 1.05rem; font-weight: bold; letter-spacing: 0.05em;
    cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.18);
    transition: transform 0.15s, box-shadow 0.15s;
    width: 100%; min-height: 56px; text-decoration: none;
  }
  .btn-estimate-action:active { transform: scale(0.97); box-shadow: 0 2px 6px rgba(0,0,0,0.15); }
  .btn-pdf   { background: linear-gradient(135deg, #E53935, #B71C1C); color: #fff; }
  .btn-line  { background: linear-gradient(135deg, #00C300, #008000); color: #fff; }
  .btn-email { background: linear-gradient(135deg, #1565C0, #0D47A1); color: #fff; }
  .btn-estimate-action .btn-icon { font-size: 1.4rem; flex-shrink: 0; }
  .btn-estimate-action .btn-label { display: flex; flex-direction: column; align-items: flex-start; line-height: 1.3; }
  .btn-estimate-action .btn-label-main { font-size: 1.05rem; font-weight: bold; }
  .btn-estimate-action .btn-label-sub  { font-size: 0.80rem; opacity: 0.9; font-weight: normal; letter-spacing: 0.02em; }
  #estimateEmailBanner { margin: 10px 0; padding: 12px 14px; border-radius: 10px; font-size: 0.88rem; text-align: center; display: none; }
  .email-banner-success { background: var(--clr-primary-bg); color: var(--clr-primary-d); border: 1.5px solid var(--clr-primary); }
  .email-banner-error   { background: #fff5f5; color: #c62828; border: 1.5px solid #e53935; }

  /* ===== „Çπ„Éû„ÉõÂêë„ÅëËøΩÂä†ÊîπÂñÑ ===== */
  @media (max-width: 480px) {
    .step { padding: 18px 14px; }
    .estimate-card { padding: 16px 13px; margin-bottom: 14px; }
    .estimate-row { padding: 10px 0; font-size: 0.97rem; }
    .estimate-total-price { font-size: 1.85rem; }
    /* ===== Âº∑Ë™øË≠¶Âëä„Éú„ÉÉ„ÇØ„ÇπÔºàÊ≠£ÂºèË¶ãÁ©ç„ÇÇ„Çä„Åß„ÅØ„Å™„ÅÑÊ≥®ÊÑèÔºâ ===== */
  .warning-box-strong {
    background: linear-gradient(135deg, #fff3e0, #ffe0b2);
    border: 3px solid #ff6f00;
    border-radius: 12px;
    padding: 18px 16px;
    margin: 16px 0;
    box-shadow: 0 4px 12px rgba(255, 111, 0, 0.25);
    animation: warning-pulse 2s ease-in-out infinite;
  }
  
  @keyframes warning-pulse {
    0%, 100% { box-shadow: 0 4px 12px rgba(255, 111, 0, 0.25); }
    50% { box-shadow: 0 4px 16px rgba(255, 111, 0, 0.4), 0 0 0 4px rgba(255, 111, 0, 0.1); }
  }
  
  .warning-box-strong .warning-icon {
    font-size: 2.5rem;
    text-align: center;
    margin-bottom: 8px;
    animation: warning-shake 3s ease-in-out infinite;
  }
  
  @keyframes warning-shake {
    0%, 100% { transform: rotate(0deg); }
    10%, 30%, 50%, 70%, 90% { transform: rotate(-5deg); }
    20%, 40%, 60%, 80% { transform: rotate(5deg); }
  }
  
  .warning-box-strong .warning-title {
    font-size: 1.15rem;
    font-weight: bold;
    color: #e65100;
    text-align: center;
    margin-bottom: 10px;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }
  
  .warning-box-strong .warning-content {
    font-size: 0.95rem;
    color: #bf360c;
    line-height: 1.8;
    background: rgba(255, 255, 255, 0.7);
    padding: 12px;
    border-radius: 8px;
    font-weight: 500;
  }
  
  .warning-box-strong .warning-emphasis {
    display: block;
    font-size: 1.05rem;
    font-weight: bold;
    color: #d84315;
    margin-top: 10px;
    text-align: center;
    padding: 8px;
    background: rgba(255, 111, 0, 0.15);
    border-radius: 6px;
    border: 2px dashed #ff6f00;
  }

  .info-box { font-size: 0.88rem; padding: 14px 12px; line-height: 1.8; }
    .btn-estimate-action { padding: 15px 16px; font-size: 1rem; min-height: 58px; }
    .estimate-section-title { font-size: 1rem; margin: 16px 0 8px; }
    .btn-s8 { padding: 14px 16px; font-size: 1rem; min-height: 56px; }
    .complete-title { font-size: 1.25rem; }
  }

  /* ===== ÊúÄÂàù„Å´Êàª„Çã„Éú„Çø„É≥ ===== */
  .restart-btn-wrap { text-align: center; margin-top: 10px; margin-bottom: 4px; }
  .btn-restart-top {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 10px 24px; background: transparent;
    color: var(--clr-primary-d); border: 2px solid var(--clr-border);
    border-radius: 20px; font-size: 0.88rem; font-weight: bold;
    cursor: pointer; transition: background .15s, color .15s;
  }
  .btn-restart-top:hover { background: var(--clr-primary-bg); border-color: var(--clr-primary); }

  /* ===== STEP3„Äú7: Âè≥‰∏ä„ÄåÊúÄÂàù„Å´Êàª„Çã„Äç„Éú„Çø„É≥ ===== */
  .step-title { position: relative; }
  .btn-restart-topright {
    position: absolute; top: 50%; right: 0; transform: translateY(-50%);
    display: inline-flex; align-items: center; gap: 4px;
    padding: 5px 10px; background: rgba(255,255,255,0.9);
    color: var(--clr-primary-d); border: 1.5px solid var(--clr-border);
    border-radius: 16px; font-size: 0.75rem; font-weight: bold;
    cursor: pointer; white-space: nowrap;
    box-shadow: 0 2px 6px rgba(124,179,66,0.15);
    transition: background .15s, color .15s, border-color .15s; z-index: 10;
  }
  .btn-restart-topright:active { background: var(--clr-primary-bg); border-color: var(--clr-primary); }
  .step-title-text { display: inline-block; padding-right: 90px; }

  /* ===== SMS button (STEP7) ===== */
  .btn-sms { background: linear-gradient(135deg, var(--clr-primary), var(--clr-primary-d)); color: #fff; }
  .btn-sms:hover { background: linear-gradient(135deg, var(--clr-primary-l), var(--clr-primary)); transform: translateY(-2px); }

  /* ===== Ëë¨ÂÑÄ„ÅÆÊµÅ„Çå „Çø„Ç§„É†„É©„Ç§„É≥ (ËøΩÂä†) ===== */
  .flow-section {
    margin-top: 24px;
    padding: 0 4px;
  }
  .flow-section-title {
    text-align: center;
    font-size: 1.05rem;
    font-weight: 800;
    color: var(--clr-primary-d);
    margin-bottom: 20px;
    padding: 12px 16px;
    background: linear-gradient(135deg, var(--clr-primary-bg), #fff);
    border-radius: 10px;
    border-left: 4px solid var(--clr-primary);
    letter-spacing: 0.05em;
  }
  .flow-phase-label {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 16px 0 12px -4px;
  }
  .flow-phase-badge {
    background: var(--clr-primary-d);
    color: #fff;
    font-size: 0.72rem;
    font-weight: 700;
    padding: 3px 12px;
    border-radius: 12px;
    letter-spacing: 0.08em;
    white-space: nowrap;
  }
  .flow-phase-line {
    flex: 1;
    height: 1px;
    background: var(--clr-primary-lt);
  }
  .flow-timeline {
    position: relative;
    padding-left: 52px;
  }
  .flow-timeline::before {
    content: '';
    position: absolute;
    left: 18px;
    top: 0;
    bottom: 0;
    width: 3px;
    background: linear-gradient(to bottom, var(--clr-primary-d), var(--clr-primary), var(--clr-primary-l));
    border-radius: 2px;
  }
  .flow-item {
    position: relative;
    margin-bottom: 16px;
  }
  .flow-item:last-child { margin-bottom: 0; }
  .flow-badge {
    position: absolute;
    left: -44px;
    top: 8px;
    width: 34px;
    height: 34px;
    background: var(--clr-primary-d);
    color: #fff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.62rem;
    font-weight: 800;
    border: 3px solid #fff;
    box-shadow: 0 2px 8px rgba(85,139,47,0.3);
    z-index: 1;
    flex-direction: column;
    line-height: 1;
  }
  .flow-badge .badge-num { font-size: 0.6rem; opacity: 0.85; }
  .flow-card {
    background: #fff;
    border-radius: 10px;
    padding: 11px 13px;
    border: 1px solid var(--clr-primary-lt);
    box-shadow: 0 2px 6px rgba(124,179,66,0.08);
  }
  .flow-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 5px;
    flex-wrap: wrap;
  }
  .flow-icon { font-size: 1.2rem; }
  .flow-title {
    font-size: 0.92rem;
    font-weight: 700;
    color: var(--clr-primary-d);
    flex: 1;
  }
  .flow-timing {
    font-size: 0.68rem;
    background: var(--clr-primary);
    color: #fff;
    padding: 2px 8px;
    border-radius: 10px;
    white-space: nowrap;
    font-weight: 600;
  }
  .flow-desc {
    font-size: 0.79rem;
    color: #444;
    line-height: 1.6;
  }
  .flow-note {
    margin-top: 5px;
    padding: 5px 9px;
    background: var(--clr-primary-bg);
    border-radius: 6px;
    font-size: 0.74rem;
    color: var(--clr-primary-d);
    font-weight: 600;
  }
  .flow-after-section {
    margin-top: 14px;
    padding: 13px;
    background: linear-gradient(135deg, var(--clr-primary-d), #3d6b1c);
    border-radius: 12px;
    color: #fff;
    text-align: center;
  }
  .flow-after-section .after-title {
    font-size: 0.88rem;
    font-weight: 700;
    margin-bottom: 8px;
    color: #d4f0a0;
  }
  .flow-after-items {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    justify-content: center;
  }
  .flow-after-tag {
    background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.3);
    color: #fff;
    font-size: 0.72rem;
    padding: 3px 9px;
    border-radius: 10px;
  }
  .flow-phone-cta {
    margin-top: 18px;
    background: linear-gradient(135deg, var(--clr-primary), var(--clr-primary-d));
    border-radius: 13px;
    padding: 14px;
    text-align: center;
    box-shadow: 0 4px 14px rgba(124,179,66,0.3);
  }
  .flow-phone-cta .cta-text {
    font-size: 0.8rem;
    color: rgba(255,255,255,0.9);
    margin-bottom: 6px;
    font-weight: 600;
  }
  .flow-phone-cta a {
    display: inline-block;
    font-size: 1.25rem;
    font-weight: 800;
    color: #fff;
    text-decoration: none;
    letter-spacing: 0.05em;
  }
  .flow-phone-cta .cta-sub {
    font-size: 0.7rem;
    color: rgba(255,255,255,0.75);
    margin-top: 3px;
  }
</style>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

  <!-- Google Analytics GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-XXXXXXXXXX', {
      send_page_view: true,
      page_title: '„Åï„ÅÑ„ÅçËë¨Á•≠ „ÅîËë¨ÂÑÄ„Çµ„Éù„Éº„Éà',
      page_path: '/funeral-support'
    });

    // ============================================================
    // GA4 „Ç´„Çπ„Çø„É†„Ç§„Éô„É≥„ÉàÈÄÅ‰ø°„Éò„É´„Éë„Éº
    // ============================================================
    const STEP_LABELS = {
      1: 'Âü∫Êú¨ÊÉÖÂ†±ÂÖ•Âäõ',
      2: '‰∫∫Êï∞„ÉªËë¨ÂÑÄÂΩ¢Âºè',
      3: '„Éó„É©„É≥ÈÅ∏Êäû',
      4: 'ÂºèÂ†¥ÈÅ∏Êäû',
      5: '„Ç≥„Éº„ÇπÈÅ∏Êäû',
      6: 'AI„ÉÅ„É£„ÉÉ„ÉàÁõ∏Ë´á',
      7: 'Ë¶ãÁ©ç„ÇÇ„ÇäÁ¢∫Ë™ç',
      8: 'ÈÄÅ‰ø°ÂÆå‰∫Ü'
    };

    function gaTrack(eventName, params = {}) {
      if (typeof gtag === 'undefined') return;
      gtag('event', eventName, {
        app_name: 'saiki_funeral_support',
        ...params
      });
    }

    // „Çπ„ÉÜ„ÉÉ„ÉóË°®Á§∫„Ç§„Éô„É≥„ÉàÔºà‰ªÆÊÉ≥„Éö„Éº„Ç∏„Éì„É•„ÉºÔºâ
    function gaStepView(stepNum) {
      const label = STEP_LABELS[stepNum] || '„Çπ„ÉÜ„ÉÉ„Éó' + stepNum;
      gaTrack('step_view', {
        step_number: stepNum,
        step_label: label,
        page_path: '/funeral-support/step' + stepNum,
        page_title: 'STEP' + stepNum + ': ' + label
      });
      // GA4 „ÅÆ‰ªÆÊÉ≥„Éö„Éº„Ç∏„Éì„É•„Éº„Å®„Åó„Å¶„ÇÇÈÄÅ‰ø°
      gtag('config', 'G-XXXXXXXXXX', {
        page_path: '/funeral-support/step' + stepNum,
        page_title: 'STEP' + stepNum + ': ' + label
      });
    }

    // Èõ¢ËÑ±„Ç§„Éô„É≥„ÉàÔºàvisibilitychange + beforeunloadÔºâ
    let _gaExitSent = false;
    function gaSendExit() {
      if (_gaExitSent) return;
      _gaExitSent = true;
      if (typeof state === 'undefined') return;
      const step = state.currentStep || 1;
      const label = STEP_LABELS[step] || '„Çπ„ÉÜ„ÉÉ„Éó' + step;
      // sendBeacon „ÅßÁ¢∫ÂÆü„Å´ÈÄÅ‰ø°
      if (navigator.sendBeacon) {
        const body = JSON.stringify({
          event: 'step_exit',
          step_number: step,
          step_label: label
        });
        // GA4 Measurement Protocol „Å∏ÈÄÅ‰ø°Ôºà„Çπ„Çø„É≥„Éâ„Ç¢„É≠„É≥Ôºâ
        gaTrack('step_exit', {
          step_number: step,
          step_label: label,
          engagement_time_msec: Date.now() - _gaPageStart
        });
      }
    }
    const _gaPageStart = Date.now();
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'hidden') gaSendExit();
    });
    window.addEventListener('pagehide', gaSendExit);
    window.addEventListener('beforeunload', gaSendExit);
  </script>
</head>
<body>


<!-- ===== ÈÄÅ‰ø°‰∏≠„Ç™„Éº„Éê„Éº„É¨„Ç§ ===== -->
<div class="submit-overlay" id="submitOverlay">
  <div class="submit-spinner"></div>
  <div class="submit-overlay-text">ÈÄÅ‰ø°‰∏≠„Åß„Åô„ÄÇ„Åó„Å∞„Çâ„Åè„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ‚Ä¶</div>
</div>
<div class="app-header">
  <h1>‚öò „Åï„ÅÑ„ÅçËë¨Á•≠ „ÅîËë¨ÂÑÄ„Çµ„Éù„Éº„Éà</h1>
  <p>„Åì„ÅÆ„Åü„Å≥„ÅØ„Åî‰æùÈ†º„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ<br>Êú¨Êâì„Å°Âêà„Çè„ÅõÂâç„ÅÆ‰∫ãÂâçÊÉÖÂ†±ÂÖ•Âäõ„Ç¢„Éó„É™</p>
</div>

<!-- Èü≥Â£∞ÂÖ•ÂäõÊ°àÂÜÖ„Éê„Éä„Éº -->
<div class="voice-notice">
  <div class="icon">üéôÔ∏è</div>
  <div class="text">
    Èü≥Â£∞ÂÖ•Âäõ„Çí„ÅîÂà©Áî®„ÅÆÊñπ„Å∏Ôºö<br>
    Â∞ë„ÄÖ„ÅÆË™§Â≠ó„ÉªÂ§âÊèõ„Éü„Çπ„Åå„ÅÇ„Å£„Å¶„ÇÇÂ§ß‰∏àÂ§´„Åß„Åô„ÄÇ<br>
    ÊãÖÂΩìËÄÖ„Åå„ÅîÁ¢∫Ë™ç„ÅÆ‰∏ä„ÄÅ‰∏ÅÂØß„Å´„ÅîÂØæÂøú„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ
  </div>
</div>

<!-- ÈÄî‰∏≠‰øùÂ≠ò„Éê„Éä„Éº -->
<div id="autoSaveBanner" style="display:none; background:linear-gradient(135deg,#e8f5e9,#c8e6c9); border-bottom:2px solid #4caf50; padding:8px 18px; font-size:0.88rem; color:#2e7d32; display:flex; align-items:center; justify-content:space-between; gap:8px;">
  <span id="autoSaveMsg">üíæ ÂÖ•ÂäõÂÜÖÂÆπ„ÇíËá™Âãï‰øùÂ≠ò„Åó„Åæ„Åó„Åü</span>
  <button onclick="clearSavedData()" style="background:none; border:1px solid #4caf50; color:#2e7d32; border-radius:6px; padding:3px 10px; font-size:0.8rem; cursor:pointer;">„ÇØ„É™„Ç¢</button>
</div>

<!-- „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº -->
<div class="progress-bar" id="progressBar">
  <div class="step-dot active" id="dot1">1</div>
  <div class="step-connector" id="con1"></div>
  <div class="step-dot" id="dot2">2</div>
  <div class="step-connector" id="con2"></div>
  <div class="step-dot" id="dot3">3</div>
  <div class="step-connector" id="con3"></div>
  <div class="step-dot" id="dot4">4</div>
  <div class="step-connector" id="con4"></div>
  <div class="step-dot" id="dot5">5</div>
  <div class="step-connector" id="con5"></div>
  <div class="step-dot" id="dot6">6</div>
  <div class="step-connector" id="con6"></div>
  <div class="step-dot" id="dot7">7</div>
  <div class="step-connector" id="con7"></div>
  <div class="step-dot" id="dot8">8</div>
</div>

<!-- ===== STEP 1: Âü∫Êú¨ÊÉÖÂ†± ===== -->
<div class="step active" id="step1">
  <div class="step-title"><span class="step-title-text"><span class="step-num">1</span>Âü∫Êú¨ÊÉÖÂ†±„Çí„ÅäËÅû„Åã„Åõ„Åè„Å†„Åï„ÅÑ</span><button class="btn-restart-topright no-print" onclick="restartApp()">üîÑ ÊúÄÂàù„Å´Êàª„Çã</button></div>
  
  <div class="form-group">
    <label class="form-label">Âñ™‰∏ªÂêç<span class="required">*</span></label>
    <input type="text" class="form-input" id="moshuName" placeholder="‰æãÔºöÂ±±Áî∞ Â§™ÈÉé">
    <div class="error-msg" id="moshuNameError">Âñ™‰∏ªÂêç„Çí„ÅîÂÖ•Âäõ„Åè„Å†„Åï„ÅÑ</div>
  </div>
  
  <div class="form-group">
    <label class="form-label">‰∫°„Åè„Å™„Çâ„Çå„ÅüÊñπ„ÅÆ„ÅäÂêçÂâç<span class="required">*</span></label>
    <input type="text" class="form-input" id="deceasedName" placeholder="‰æã:Â±±Áî∞ Ëä±Â≠ê">
    <div class="error-msg" id="deceasedNameError">‰∫°„Åè„Å™„Çâ„Çå„ÅüÊñπ„ÅÆ„ÅäÂêçÂâç„Çí„ÅîÂÖ•Âäõ„Åè„Å†„Åï„ÅÑ</div>
  </div>
  <div class="form-group">
    <label class="form-label">ÊïÖ‰∫∫Êßò„Å®„ÅÆ„ÅîÈñ¢‰øÇ<span class="required">*</span></label>
    <select class="form-select" id="relation">
      <option value="">--- „ÅäÈÅ∏„Å≥„Åè„Å†„Åï„ÅÑ ---</option>
      <option value="spouse">ÈÖçÂÅ∂ËÄÖÔºàÂ§´„ÉªÂ¶ªÔºâ</option>
      <option value="parent">Ë¶™ÔºàÁà∂„ÉªÊØçÔºâ</option>
      <option value="child">Â≠ê„Å©„ÇÇ</option>
      <option value="sibling">ÂÖÑÂºü„ÉªÂßâÂ¶π</option>
      <option value="grandparent">Á•ñÁà∂„ÉªÁ•ñÊØç</option>
      <option value="inlaw">Áæ©ÁêÜ„ÅÆË¶™</option>
      <option value="relative">„Åù„ÅÆ‰ªñË¶™Êóè</option>
      <option value="other">„Åù„ÅÆ‰ªñ</option>
    </select>
    <div class="error-msg" id="relationError">„ÅîÈñ¢‰øÇ„Çí„ÅäÈÅ∏„Å≥„Åè„Å†„Åï„ÅÑ</div>
  </div>
  
  <div class="form-group">
    <label class="form-label">„ÅäÈõªË©±Áï™Âè∑Ôºà‰ªªÊÑèÔºâ</label>
    <input type="tel" class="form-input" id="phone" placeholder="‰æãÔºö0120-315-312">
  </div>
  
  <div class="info-box">
    üìã „ÅîÂÖ•Âäõ„ÅÑ„Åü„Å†„ÅÑ„ÅüÊÉÖÂ†±„ÅØ„ÅäË¶ãÁ©ç„ÇÇ„Çä„ÅÆ‰ΩúÊàê„Å´„ÅÆ„Åø‰ΩøÁî®„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ<br>
    ÂÄã‰∫∫ÊÉÖÂ†±„ÅØÂé≥Èáç„Å´ÁÆ°ÁêÜ„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ
  </div>
  
  <div class="nav-buttons">
    <button class="btn-next" onclick="goToStep(2)">Ê¨°„Å∏ ‚Üí ‰∫∫Êï∞„ÉªËë¨ÂÑÄÂΩ¢Âºè</button>
  </div>
</div>

<!-- ===== STEP 2: ÂèÇÂàó‰∫∫Êï∞„ÉªËë¨ÂÑÄÂΩ¢Âºè ===== -->
<div class="step" id="step2">
  <div class="step-title"><span class="step-title-text"><span class="step-num">2</span>ÂèÇÂàó‰∫∫Êï∞„ÉªËë¨ÂÑÄÂΩ¢Âºè</span><button class="btn-restart-topright no-print" onclick="restartApp()">üîÑ ÊúÄÂàù„Å´Êàª„Çã</button></div>
  
  <div class="form-group">
    <label class="form-label">ÂèÇÂàó‰∫àÂÆö‰∫∫Êï∞„Çí„ÅäÊïô„Åà„Åè„Å†„Åï„ÅÑ<span class="required">*</span></label>
    <div class="btn-group" id="attendanceGroup">
      <button class="btn-choice" onclick="selectAttendance(this,'under5')" data-value="under5">
        <span class="choice-icon">üë§</span>
        <span class="choice-text">
          <strong>5Âêç‰ª•‰∏ã</strong>
          <div class="choice-desc">„Åî„ÅèË∫´Ëøë„Å™„ÅîÂÆ∂Êóè„ÅÆ„ÅøÔºàÁõ¥Ëë¨„ÉªÂØÜËë¨Âêë„ÅçÔºâ</div>
        </span>
        <span class="check-mark">‚úî</span>
      </button>
      <button class="btn-choice" onclick="selectAttendance(this,'under15')" data-value="under15">
        <span class="choice-icon">üë•</span>
        <span class="choice-text">
          <strong>15Âêç‰ª•‰∏ã</strong>
          <div class="choice-desc">ËøëË¶™ËÄÖ‰∏≠ÂøÉ„ÅÆÂ∞èË¶èÊ®°ÂÆ∂ÊóèËë¨</div>
        </span>
        <span class="check-mark">‚úî</span>
      </button>
      <button class="btn-choice" onclick="selectAttendance(this,'15to30')" data-value="15to30">
        <span class="choice-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
        <span class="choice-text">
          <strong>15Âêç„Åã„Çâ30Âêç</strong>
          <div class="choice-desc">Ë¶™Êóè„ÉªËøë„Åó„ÅÑÂèã‰∫∫„ÇíÂê´„ÇÄÂÆ∂ÊóèËë¨</div>
        </span>
        <span class="check-mark">‚úî</span>
      </button>
      <button class="btn-choice" onclick="selectAttendance(this,'30to50')" data-value="30to50">
        <span class="choice-icon">üè¢</span>
        <span class="choice-text">
          <strong>30Âêç„Åã„Çâ50Âêç</strong>
          <div class="choice-desc">‰∏ÄËà¨Ëë¨„ÉªÁü•‰∫∫„Éª‰ªï‰∫ãÈñ¢‰øÇ„ÇíÂê´„ÇÄ</div>
        </span>
        <span class="check-mark">‚úî</span>
      </button>
      <button class="btn-choice" onclick="selectAttendance(this,'over50')" data-value="over50">
        <span class="choice-icon">üèõÔ∏è</span>
        <span class="choice-text">
          <strong>50Âêç‰ª•‰∏ä</strong>
          <div class="choice-desc">Â§ßË¶èÊ®°‰∏ÄËà¨Ëë¨„Éª‰ºöÁ§æ„ÉªÂõ£‰ΩìÈñ¢‰øÇÂ§öÊï∞</div>
        </span>
        <span class="check-mark">‚úî</span>
      </button>
    </div>
    <div class="error-msg" id="attendanceError">ÂèÇÂàó‰∫àÂÆö‰∫∫Êï∞„Çí„ÅäÈÅ∏„Å≥„Åè„Å†„Åï„ÅÑ</div>
  </div>
  
  <div class="form-group" style="margin-top:20px">
    <label class="form-label">„ÅîÂ∏åÊúõ„ÅÆËë¨ÂÑÄÂΩ¢Âºè<span class="required">*</span></label>
    <div class="btn-group" id="funeralTypeGroup">
      <button class="btn-choice" onclick="selectFuneralType(this,'family')" data-value="family">
        <span class="choice-icon">üå∏</span>
        <span class="choice-text">
          <strong>ÂÆ∂ÊóèËë¨</strong>
          <div class="choice-desc">„ÅîÈÅ∫Êóè„ÉªËøëË¶™ËÄÖ„ÅÆ„Åø„ÅßÈùô„Åã„Å´„ÅäË¶ãÈÄÅ„Çä</div>
        </span>
        <span class="check-mark">‚úî</span>
      </button>
      <button class="btn-choice" onclick="selectFuneralType(this,'family_friends')" data-value="family_friends">
        <span class="choice-icon">üåº</span>
        <span class="choice-text">
          <strong>ÂÆ∂ÊóèËë¨„Å†„ÅåÂ∞ë„ÅóÂèã‰∫∫„ÅåÊù•„Çã</strong>
          <div class="choice-desc">‰∏ª„Å´ÂÆ∂Êóè‰∏≠ÂøÉ„Å†„Åå„ÄÅÂèã‰∫∫„ÉªÁü•‰∫∫„ÇÇÊï∞ÂêçÂèÇÂàó</div>
        </span>
        <span class="check-mark">‚úî</span>
      </button>
      <button class="btn-choice" onclick="selectFuneralType(this,'general')" data-value="general">
        <span class="choice-icon">üåø</span>
        <span class="choice-text">
          <strong>‰∏ÄËà¨Ëë¨ÔºàË¶™Êóè„ÉªÁü•‰∫∫„Éª‰ªï‰∫ãÈñ¢‰øÇ„Å™„Å©Ôºâ</strong>
          <div class="choice-desc">Â∫É„ÅèÂèÇÂàóËÄÖ„Çí„ÅäËøé„Åà„Åô„Çã‰∏ÄËà¨ÁöÑ„Å™„ÅäËë¨Âºè</div>
        </span>
        <span class="check-mark">‚úî</span>
      </button>
      <button class="btn-choice" onclick="selectFuneralType(this,'general_company')" data-value="general_company">
        <span class="choice-icon">üè¢</span>
        <span class="choice-text">
          <strong>‰∏ÄËà¨Ëë¨„Åã„Å§‰ºöÁ§æ„ÉªÂõ£‰ΩìÈñ¢‰øÇ„ÇÇÂëº„Å∂</strong>
          <div class="choice-desc">‰ºöÁ§æ„ÉªÂõ£‰Ωì„ÉªÁµÑÂêà„Å™„Å©Â§öÊï∞ÂèÇÂàó„ÅÆÂ§ßË¶èÊ®°Ëë¨ÂÑÄ</div>
        </span>
        <span class="check-mark">‚úî</span>
      </button>
      <button class="btn-choice" onclick="selectFuneralType(this,'chokuso')" data-value="chokuso">
        <span class="choice-icon">üïäÔ∏è</span>
        <span class="choice-text">
          <strong>Áõ¥Ëë¨„ÉªÁÅ´Ëë¨Âºè</strong>
          <div class="choice-desc">ÈÄöÂ§ú„ÉªÂëäÂà•Âºè„Å™„Åó„ÄÇÁÅ´Ëë¨„ÅÆ„Åø„ÄÅ„Åæ„Åü„ÅØÊúÄÂ∞èÈôê„ÅÆ„ÅäÂà•„Çå</div>
        </span>
        <span class="check-mark">‚úî</span>
      </button>
      <button class="btn-choice" onclick="selectFuneralType(this,'kasouonly')" data-value="kasouonly">
        <span class="choice-icon">‚õ©Ô∏è</span>
        <span class="choice-text">
          <strong>ÁÅ´Ëë¨„ÅÆ„ÅøÔºàÊúÄ„ÇÇ„Ç∑„É≥„Éó„É´Ôºâ</strong>
          <div class="choice-desc">„ÅîÈÅ∫‰Ωì„ÅÆÊê¨ÈÄÅ„Å®ÁÅ´Ëë¨„ÅÆ„Åø„ÄÇÊúÄ‰ΩéÈôê„ÅÆË≤ªÁî®„Åß„ÅÆ„ÅäË¶ãÈÄÅ„Çä</div>
        </span>
        <span class="check-mark">‚úî</span>
      </button>
    </div>
    <div class="error-msg" id="funeralTypeError">Ëë¨ÂÑÄÂΩ¢Âºè„Çí„ÅäÈÅ∏„Å≥„Åè„Å†„Åï„ÅÑ</div>
  </div>
  
  <div class="nav-buttons">
    <button class="btn-back" onclick="goToStep(1)">‚Üê Êàª„Çã</button>
    <button class="btn-next" onclick="goToStep(3)">Ê¨°„Å∏ ‚Üí „Éó„É©„É≥ÊèêÊ°à</button>
  </div>
</div>

<!-- ===== STEP 3: „Éó„É©„É≥ÊèêÊ°àÔºà3Á®ÆÈ°ûÔºâ ===== -->
<div class="step" id="step3">
  <div class="step-title"><span class="step-title-text"><span class="step-num">3</span>„ÅäÂãß„ÇÅ„Éó„É©„É≥„Çí„ÅäÈÅ∏„Å≥„Åè„Å†„Åï„ÅÑ</span><button class="btn-restart-topright no-print" onclick="restartApp()">üîÑ ÊúÄÂàù„Å´Êàª„Çã</button></div>
  <div class="selection-summary" id="step3Summary"></div>
  
  <div class="plan-cards" id="planCards">
    <!-- JavaScript„ÅßÂãïÁöÑÁîüÊàê -->
  </div>
  
  <div class="error-msg" id="planError" style="display:block">„Éó„É©„É≥„Çí„ÅäÈÅ∏„Å≥„Åè„Å†„Åï„ÅÑ</div>
  
  <div class="nav-buttons">
    <button class="btn-back" onclick="goToStep(2)">‚Üê Êàª„Çã</button>
    <button class="btn-next" onclick="goToStep(4)">Ê¨°„Å∏ ‚Üí „Éõ„Éº„É´ÈÅ∏Êäû</button>
  </div>
</div>

<!-- ===== STEP 4: „Éõ„Éº„É´ÈÅ∏Êäû ===== -->
<div class="step" id="step4">
  <div class="step-title"><span class="step-title-text"><span class="step-num">4</span>ÂºèÂ†¥Ôºà„Éõ„Éº„É´Ôºâ„Çí„ÅäÈÅ∏„Å≥„Åè„Å†„Åï„ÅÑ</span><button class="btn-restart-topright no-print" onclick="restartApp()">üîÑ ÊúÄÂàù„Å´Êàª„Çã</button></div>
  <div class="selection-summary" id="step4Summary"></div>
  
  <div class="hall-cards" id="hallCards">
    <!-- JavaScript„ÅßÂãïÁöÑÁîüÊàê -->
  </div>
  
  <button class="hall-all-btn" id="showAllHallsBtn" onclick="showAllHalls()" style="display:none">
    ‚ñΩ „Åù„ÅÆ‰ªñ„ÅÆ„Éõ„Éº„É´„ÇÇ„Åô„Åπ„Å¶Ë°®Á§∫„Åô„Çã
  </button>
  
  <div class="error-msg" id="hallError" style="display:block">„Éõ„Éº„É´„Çí„ÅäÈÅ∏„Å≥„Åè„Å†„Åï„ÅÑ</div>
  
  <div class="nav-buttons">
    <button class="btn-back" onclick="goToStep(3)">‚Üê Êàª„Çã</button>
    <button class="btn-next" onclick="goToStep(5)">Ê¨°„Å∏ ‚Üí Á•≠Â£á„Ç≥„Éº„ÇπÈÅ∏Êäû</button>
  </div>
</div>

<!-- ===== STEP 5: „Ç≥„Éº„ÇπÈÅ∏Êäû ===== -->
<div class="step" id="step5">
  <div class="step-title"><span class="step-title-text"><span class="step-num">5</span>Á•≠Â£á„Ç≥„Éº„Çπ„Çí„ÅäÈÅ∏„Å≥„Åè„Å†„Åï„ÅÑ</span><button class="btn-restart-topright no-print" onclick="restartApp()">üîÑ ÊúÄÂàù„Å´Êàª„Çã</button></div>
  <div class="selection-summary" id="step5Summary"></div>
  
  <!-- ÂÜôÁúü„Ç§„É°„Éº„Ç∏Ê≥®Ë®ò -->
  <div class="image-notice">üì∑ Êé≤Ëºâ„Åó„Å¶„ÅÑ„ÇãÁ•≠Â£á„ÅÆÂÜôÁúü„ÅØ„ÅÇ„Åè„Åæ„Åß„ÇÇ„Ç§„É°„Éº„Ç∏„Åß„Åô„ÄÇÂÆüÈöõ„ÅÆÁ•≠Â£á„ÅÆË©≥Á¥∞„ÅØ„ÅäÊ∞óËªΩ„Å´ÊãÖÂΩìËÄÖ„Å∏„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇ</div>
  
  <div class="course-cards" id="courseCards">
    <!-- JavaScript„ÅßÂãïÁöÑÁîüÊàê -->
  </div>
  
  <div class="info-box">
    ‚ú® <strong>ÊòéÊúó‰ºöË®à</strong>„ÅÆ„ÅäÁ¥ÑÊùüÔºö‰∫ãÂâç„ÅäË¶ãÁ©ç„Çä‰ª•Â§ñ„ÅÆËøΩÂä†Ë´ãÊ±Ç„ÅØ‰∏ÄÂàá„Åî„Åñ„ÅÑ„Åæ„Åõ„Çì„ÄÇ<br>
    ‰∫∫Êï∞Ë∂ÖÈÅéÁ≠â„ÅåÁîü„Åò„ÅüÂ†¥Âêà„ÅØ„ÄÅÂøÖ„ÅöÂñ™‰∏ªÊßò„Å´„ÅîÁ¢∫Ë™ç„ÅÆ‰∏ä„Åß„ÅîÂØæÂøú„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ
  </div>
  
  <div class="error-msg" id="courseError" style="display:block">„Ç≥„Éº„Çπ„Çí„ÅäÈÅ∏„Å≥„Åè„Å†„Åï„ÅÑ</div>
  
  <div class="nav-buttons">
    <button class="btn-back" onclick="goToStep(4)">‚Üê Êàª„Çã</button>
    <button class="btn-next" onclick="goToStep(6)">Ê¨°„Å∏ ‚Üí „ÅîÂ∏åÊúõ„Éª„Åî‰∏çÂÆâ</button>
  </div>
</div>

<!-- ===== STEP 6: „ÅîÂ∏åÊúõ„Éª„Åî‰∏çÂÆâÔºà„ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„ÉàÔºâ ===== -->
<div class="step" id="step6">
  <div class="step-title"><span class="step-title-text"><span class="step-num">6</span>„ÅîÂ∏åÊúõ„Éª„Åî‰∏çÂÆâ„Çí„ÅäËÅû„Åã„Åõ„Åè„Å†„Åï„ÅÑ</span><button class="btn-restart-topright no-print" onclick="restartApp()">üîÑ ÊúÄÂàù„Å´Êàª„Çã</button></div>
  
  <!-- „Çà„Åè„ÅÇ„ÇãË≥™Âïè FAQ„Éë„Éç„É´ -->
  <div class="faq-panel" id="faqPanel">
    <div class="faq-panel-header" onclick="toggleFaq()">
      <div class="faq-panel-header-left">
        <span>üí°</span>
        <span>„Çà„Åè„ÅÇ„ÇãË≥™Âïè‰∏ÄË¶ßÔºà„Çø„ÉÉ„Éó„Åô„Çã„Å®„ÉÅ„É£„ÉÉ„Éà„ÅßË≥™Âïè„Åß„Åç„Åæ„ÅôÔºâ</span>
        <span id="faqUsedCount" style="font-size:0.72rem; background:#4caf50; color:#fff; padding:1px 7px; border-radius:10px; display:none;">0‰ª∂Áô∫Ë®ÄÊ∏à</span>
      </div>
      <span class="faq-toggle-icon" id="faqToggleIcon">‚ñº</span>
    </div>
    <div class="faq-body" id="faqBody">

      <div class="faq-category">
        <span class="faq-category-label">üí∞ Ë≤ªÁî®„Éª„ÅäÊîØÊâï„ÅÑ</span>
        <div class="faq-items">
          <button class="faq-btn" onclick="faqClick(this,'Ë≤ªÁî®„Å´„Å§„ÅÑ„Å¶Êïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ')"><span class="faq-icon">‚ùì</span>Ë≤ªÁî®„Å´„Å§„ÅÑ„Å¶Êïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</button>
          <button class="faq-btn" onclick="faqClick(this,'ËøΩÂä†Ë≤ªÁî®„ÅØ„Åã„Åã„Çä„Åæ„Åô„ÅãÔºü')"><span class="faq-icon">‚ùì</span>ËøΩÂä†Ë≤ªÁî®„ÅØ„Åã„Åã„Çä„Åæ„Åô„ÅãÔºü</button>
          <button class="faq-btn" onclick="faqClick(this,'ÂàÜÂâ≤Êâï„ÅÑ„ÅØÂèØËÉΩ„Åß„Åô„ÅãÔºü')"><span class="faq-icon">‚ùì</span>ÂàÜÂâ≤Êâï„ÅÑ„ÅØÂèØËÉΩ„Åß„Åô„ÅãÔºü</button>
          <button class="faq-btn" onclick="faqClick(this,'‰ºöÂì°Ââ≤Âºï„ÅÆË©≥Á¥∞„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ')"><span class="faq-icon">‚ùì</span>‰ºöÂì°Ââ≤Âºï„ÅÆË©≥Á¥∞„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</button>
          <button class="faq-btn" onclick="faqClick(this,'Ëë¨Á•≠Ë≤ªË£úÂä©Èáë„ÉªÈ¶ôÂÖ∏Ëøî„Åó„Å´„Å§„ÅÑ„Å¶')"><span class="faq-icon">‚ùì</span>Ëë¨Á•≠Ë≤ªË£úÂä©Èáë„ÉªÈ¶ôÂÖ∏Ëøî„Åó„Å´„Å§„ÅÑ„Å¶</button>
        </div>
      </div>

      <div class="faq-category">
        <span class="faq-category-label">üìã ÊâãÁ∂ö„Åç„ÉªÊµÅ„Çå</span>
        <div class="faq-items">
          <button class="faq-btn" onclick="faqClick(this,'Ëë¨Âºè„ÅÆÊµÅ„Çå„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ')"><span class="faq-icon">‚ùì</span>Ëë¨Âºè„ÅÆÊµÅ„Çå„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</button>
          <button class="faq-btn" onclick="faqClick(this,'Ê≠ª‰∫°Âæå„ÅÆÂΩπÊâÄÊâãÁ∂ö„Åç„ÅØÔºü')"><span class="faq-icon">‚ùì</span>Ê≠ª‰∫°Âæå„ÅÆÂΩπÊâÄÊâãÁ∂ö„Åç„ÅØÔºü</button>
          <button class="faq-btn" onclick="faqClick(this,'Ê≠ª‰∫°Ë®∫Êñ≠Êõ∏„Å´„Å§„ÅÑ„Å¶Êïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ')"><span class="faq-icon">‚ùì</span>Ê≠ª‰∫°Ë®∫Êñ≠Êõ∏„Å´„Å§„ÅÑ„Å¶Êïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</button>
          <button class="faq-btn" onclick="faqClick(this,'ÈÄ£Áµ°„Åô„ÇãÁØÑÂõ≤„ÅØÔºü')"><span class="faq-icon">‚ùì</span>ÈÄ£Áµ°„Åô„ÇãÁØÑÂõ≤„ÅØÔºü</button>
          <button class="faq-btn" onclick="faqClick(this,'ÈÄöÂ§ú„ÉªÂëäÂà•Âºè„ÅÆÈÅï„ÅÑ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ')"><span class="faq-icon">‚ùì</span>ÈÄöÂ§ú„ÉªÂëäÂà•Âºè„ÅÆÈÅï„ÅÑ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ</button>
        </div>
      </div>

      <div class="faq-category">
        <span class="faq-category-label">üè∑Ô∏è ÂÆóÊïô„Éª„ÅäÂ∏ÉÊñΩ</span>
        <div class="faq-items">
          <button class="faq-btn" onclick="faqClick(this,'„ÅäÂ∏ÉÊñΩ„ÅÆÁõÆÂÆâ„ÅØÔºü')"><span class="faq-icon">‚ùì</span>„ÅäÂ∏ÉÊñΩ„ÅÆÁõÆÂÆâ„ÅØÔºü</button>
          <button class="faq-btn" onclick="faqClick(this,'ÁÑ°ÂÆóÊïô„ÉªÁÑ°ÂÆóÊ¥æ„Åß„ÇÇ„Åß„Åç„Åæ„Åô„ÅãÔºü')"><span class="faq-icon">‚ùì</span>ÁÑ°ÂÆóÊïô„ÉªÁÑ°ÂÆóÊ¥æ„Åß„ÇÇ„Åß„Åç„Åæ„Åô„ÅãÔºü</button>
          <button class="faq-btn" onclick="faqClick(this,'‰ªñÂÆóÊ¥æ„Åß„ÇÇÂØæÂøú„Åß„Åç„Åæ„Åô„ÅãÔºü')"><span class="faq-icon">‚ùì</span>‰ªñÂÆóÊ¥æ„Åß„ÇÇÂØæÂøú„Åß„Åç„Åæ„Åô„ÅãÔºü</button>
          <button class="faq-btn" onclick="faqClick(this,'„ÅØ„Å™Á≠í„ÉªÁßòÂå£„ÅÆÈÅï„ÅÑ„ÅØÔºü')"><span class="faq-icon">‚ùì</span>„ÅØ„Å™Á≠í„ÉªÁßòÂå£„ÅÆÈÅï„ÅÑ„ÅØÔºü</button>
        </div>
      </div>

      <div class="faq-category">
        <span class="faq-category-label">üë∂ „ÅäÂ≠êÊßò„ÉªÂ≠ê„Å©„ÇÇ„ÅÆ„Åü„ÇÅ„Å´</span>
        <div class="faq-items">
          <button class="faq-btn" onclick="faqClick(this,'Â∞è„Åï„Å™Â≠ê„Å©„ÇÇ„ÇÇÂèÇÂàó„Åß„Åç„Åæ„Åô„ÅãÔºü')"><span class="faq-icon">‚ùì</span>Â∞è„Åï„Å™Â≠ê„Å©„ÇÇ„ÇÇÂèÇÂàó„Åß„Åç„Åæ„Åô„ÅãÔºü</button>
          <button class="faq-btn" onclick="faqClick(this,'„Ç≠„ÉÉ„Ç∫„Çπ„Éö„Éº„Çπ„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü')"><span class="faq-icon">‚ùì</span>„Ç≠„ÉÉ„Ç∫„Çπ„Éö„Éº„Çπ„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü</button>
          <button class="faq-btn" onclick="faqClick(this,'Êéà‰π≥ÂÆ§„Éª„Åä„ÇÄ„Å§‰∫§Êèõ„ÅØ„Åß„Åç„Åæ„Åô„ÅãÔºü')"><span class="faq-icon">‚ùì</span>Êéà‰π≥ÂÆ§„Éª„Åä„ÇÄ„Å§‰∫§Êèõ„ÅØ„Åß„Åç„Åæ„Åô„ÅãÔºü</button>
        </div>
      </div>

      <div class="faq-category">
        <span class="faq-category-label">üå∏ „ÅäÂà•„Çå„ÉªÊºîÂá∫</span>
        <div class="faq-items">
          <button class="faq-btn" onclick="faqClick(this,'„ÅäËä±„Çí„Åü„Åè„Åï„ÇìÈ£æ„Çä„Åü„ÅÑ„Åß„Åô')"><span class="faq-icon">‚ùì</span>„ÅäËä±„Çí„Åü„Åè„Åï„ÇìÈ£æ„Çä„Åü„ÅÑ</button>
          <button class="faq-btn" onclick="faqClick(this,'Èü≥Ê•Ω„ÇÑÊò†ÂÉè„ÇíÊµÅ„Åó„Åü„ÅÑ„Åß„Åô')"><span class="faq-icon">‚ùì</span>Èü≥Ê•Ω„ÉªÊò†ÂÉè„ÇíÊµÅ„Åó„Åü„ÅÑ</button>
          <button class="faq-btn" onclick="faqClick(this,'„Éö„ÉÉ„Éà„ÇÇ‰∏ÄÁ∑í„Å´„ÅäÂà•„Çå„Åó„Åü„ÅÑ„Åß„Åô')"><span class="faq-icon">‚ùì</span>„Éö„ÉÉ„Éà„ÇÇ‰∏ÄÁ∑í„Å´„ÅäÂà•„Çå„Åó„Åü„ÅÑ</button>
          <button class="faq-btn" onclick="faqClick(this,'ÂÜôÁúüÂÖ•„Çä„ÅÆ‰ΩçÁâå„Çí‰Ωú„Çä„Åü„ÅÑ„Åß„Åô')"><span class="faq-icon">‚ùì</span>ÂÜôÁúüÂÖ•„Çä„ÅÆ‰ΩçÁâå„Çí‰Ωú„Çä„Åü„ÅÑ</button>
        </div>
      </div>

      <div class="faq-category">
        <span class="faq-category-label">üò∑ ÊÑüÊüìÁóá„ÉªÂÅ•Â∫∑ÂØæÂøú</span>
        <div class="faq-items">
          <button class="faq-btn" onclick="faqClick(this,'ÊÑüÊüìÁóá„Åß‰∫°„Åè„Å™„Å£„ÅüÂ†¥Âêà„ÅÆÂØæÂøú„ÅØÔºü')"><span class="faq-icon">‚ùì</span>ÊÑüÊüìÁóá„Åß‰∫°„Åè„Å™„Å£„ÅüÂ†¥Âêà„ÅÆÂØæÂøú„ÅØÔºü</button>
          <button class="faq-btn" onclick="faqClick(this,'ÂèÇÂàóËÄÖÊï∞„ÇíÂà∂Èôê„Åó„Åü„ÅÑÂ†¥Âêà„ÅØÔºü')"><span class="faq-icon">‚ùì</span>ÂèÇÂàóËÄÖÊï∞„ÇíÂà∂Èôê„Åó„Åü„ÅÑÂ†¥Âêà„ÅØÔºü</button>
        </div>
      </div>

    </div><!-- /faq-body -->
  </div><!-- /faq-panel -->

  <!-- „ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„ÉàUI -->
  <div class="chat-window" id="chatWindow">
    <div class="chat-header">
      <div class="bot-avatar">ü§ù</div>
      <div>
        <div>„Åï„ÅÑ„ÅçËë¨Á•≠ Áõ∏Ë´á„Çµ„Éù„Éº„Éà</div>
        <div style="font-size:0.72rem; opacity:0.85;">„ÅîÂ∏åÊúõ„Éª„Åî‰∏çÂÆâ„Çí‰Ωï„Åß„ÇÇ„ÅäÊ∞óËªΩ„Å´</div>
      </div>
    </div>
    <div class="chat-messages" id="chatMessages">
      <!-- „É°„ÉÉ„Çª„Éº„Ç∏„ÅØJS„ÅßËøΩÂä† -->
    </div>
    <div class="typing-dots" id="typingIndicator" style="display:none; padding:8px 14px; background:#fff; border-radius:16px; margin:4px 12px; align-self:flex-start;">
      <span></span><span></span><span></span>
    </div>
    <div class="quick-replies" id="quickReplies" style="display:none;">
      <!-- „ÇØ„Ç§„ÉÉ„ÇØ„É™„Éó„É©„Ç§„ÅØJS„ÅßËøΩÂä† -->
    </div>
    <div class="chat-input-area">
      <textarea class="chat-input" id="chatInput" rows="1" placeholder="„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ‚Ä¶ ‚ÄªÈü≥Â£∞ÂÖ•Âäõ„ÅÆË™§Â≠ó„ÇÇÂ§ß‰∏àÂ§´„Åß„Åô" onkeydown="chatKeyDown(event)"></textarea>
      <button class="chat-send-btn" id="chatSendBtn" onclick="sendChatMessage()" title="ÈÄÅ‰ø°">‚û§</button>
    </div>
  </div>
  
  <!-- „ÉÅ„É£„ÉÉ„ÉàÂÆå‰∫Ü„Éê„Éä„Éº -->
  <div class="chat-done-banner" id="chatDoneBanner">
    ‚úÖ „ÅîÂÖ•Âäõ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åó„Åü„ÄÇÊãÖÂΩìËÄÖ„ÅåÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç„ÅÆ‰∏ä„ÄÅ‰∏ÅÂØß„Å´„ÅîÂØæÂøú„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ
  </div>
  
  <!-- ÂÆóÊïô„ÉªËè©ÊèêÂØ∫ÊÉÖÂ†± -->
  <div class="religion-section" style="margin-top: 24px; padding: 16px; background: linear-gradient(135deg, #f3f8ff, #e8f4f8); border: 2px solid #81c784; border-radius: 12px;">
    <div class="religion-header" style="display: flex; align-items: center; gap: 8px; margin-bottom: 14px;">
      <span style="font-size: 1.5rem;">üôè</span>
      <h3 style="font-size: 1rem; font-weight: bold; color: var(--clr-primary-d); margin: 0;">ÂÆóÊïô„ÉªËè©ÊèêÂØ∫„Å´„Å§„ÅÑ„Å¶Ôºà‰ªªÊÑèÔºâ</h3>
    </div>
    <div style="font-size: 0.85rem; color: #666; margin-bottom: 16px; line-height: 1.6;">
      ÂΩìÊó•„ÅÆÊâì„Å°Âêà„Çè„Åõ„Çí„Çπ„É†„Éº„Ç∫„Å´ÈÄ≤„ÇÅ„Çã„Åü„ÇÅ„ÄÅ„ÅäÂàÜ„Åã„Çä„ÅÆÁØÑÂõ≤„ÅßÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ<br>
      <strong>‚ÄªÂÖ•Âäõ„ÅØ‰ªªÊÑè„Åß„Åô„ÄÇÂàÜ„Åã„Çâ„Å™„ÅÑÂ†¥Âêà„ÅØÁ©∫ÁôΩ„ÅÆ„Åæ„Åæ„ÅßÊßã„ÅÑ„Åæ„Åõ„Çì„ÄÇ</strong>
    </div>
    
    <div class="form-group">
      <label class="form-label" style="font-size: 0.9rem;">„ÅîÂÆóÊïô„ÉªÂÆóÊ¥æ</label>
      <select class="form-select" id="religion" onchange="updateReligionState()">
        <option value="">--- „ÅäÈÅ∏„Å≥„Åè„Å†„Åï„ÅÑÔºà‰ªªÊÑèÔºâ---</option>
        <option value="‰ªèÊïôÔºàÂÆóÊ¥æ‰∏çÊòéÔºâ">‰ªèÊïôÔºàÂÆóÊ¥æ‰∏çÊòéÔºâ</option>
        <option value="ÁúüÂÆóÂ§ßË∞∑Ê¥æÔºàÊù±Êú¨È°òÂØ∫Ôºâ">ÁúüÂÆóÂ§ßË∞∑Ê¥æÔºàÊù±Êú¨È°òÂØ∫Ôºâ</option>
        <option value="ÊµÑÂúüÁúüÂÆóÊú¨È°òÂØ∫Ê¥æÔºàË•øÊú¨È°òÂØ∫Ôºâ">ÊµÑÂúüÁúüÂÆóÊú¨È°òÂØ∫Ê¥æÔºàË•øÊú¨È°òÂØ∫Ôºâ</option>
        <option value="ÁúüË®ÄÂÆó">ÁúüË®ÄÂÆó</option>
        <option value="Â§©Âè∞ÂÆó">Â§©Âè∞ÂÆó</option>
        <option value="ÊµÑÂúüÂÆó">ÊµÑÂúüÂÆó</option>
        <option value="ÊõπÊ¥ûÂÆó">ÊõπÊ¥ûÂÆó</option>
        <option value="Ëá®Ê∏àÂÆó">Ëá®Ê∏àÂÆó</option>
        <option value="Êó•ËìÆÂÆó">Êó•ËìÆÂÆó</option>
        <option value="Êó•ËìÆÊ≠£ÂÆó">Êó•ËìÆÊ≠£ÂÆó</option>
        <option value="Á•ûÈÅì">Á•ûÈÅì</option>
        <option value="„Ç≠„É™„Çπ„ÉàÊïô">„Ç≠„É™„Çπ„ÉàÊïô</option>
        <option value="ÁÑ°ÂÆóÊïô">ÁÑ°ÂÆóÊïô</option>
        <option value="„Åù„ÅÆ‰ªñ">„Åù„ÅÆ‰ªñ</option>
      </select>
    </div>
    
    <div class="form-group">
      <label class="form-label" style="font-size: 0.9rem;">Ëè©ÊèêÂØ∫„Éª„ÅäÂØ∫„ÅÆÊÉÖÂ†±</label>
      <textarea class="form-textarea" id="templeInfo" rows="3" placeholder="‰æãÔºö‚óã‚óãÂØ∫Ôºà‰ΩèËÅ∑ÔºöÂ±±Áî∞Êßò„ÄÅÈõªË©±Ôºö0120-XXX-XXXÔºâ&#10;‰æãÔºöÊ™ÄÂÆ∂„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì&#10;‰æãÔºö„ÅäÂØ∫„Å®„ÅÆ‰ªò„ÅçÂêà„ÅÑ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì&#10;&#10;‚Äª„ÅäÂØ∫„ÅÆÂêçÂâç„ÄÅ‰ΩèÊâÄ„ÄÅÈõªË©±Áï™Âè∑„ÄÅ‰ΩèËÅ∑Âêç„Å™„Å©„ÄÅÂàÜ„Åã„ÇãÁØÑÂõ≤„Åß" style="resize: vertical; min-height: 80px;" onchange="updateTempleState()"></textarea>
      <div style="font-size: 0.75rem; color: #888; margin-top: 4px;">
        „ÅäÂØ∫„Å®„ÅÆÈñ¢‰øÇ„ÄÅ‰ΩèËÅ∑„ÅÆ„ÅäÂêçÂâç„ÄÅÈÄ£Áµ°ÂÖà„Å™„Å©„ÄÅÂàÜ„Åã„ÇãÁØÑÂõ≤„ÅßÁµêÊßã„Åß„Åô
      </div>
    </div>
  </div>
  
  <!-- ‰ºöÂì°Á¢∫Ë™ç -->
  <div class="form-group" style="margin-top:4px;">
    <label class="form-label">„ÇÑ„Åô„Çâ„Åé‰ºöÂì°Êßò„Åß„Åô„ÅãÔºü</label>
    <div class="btn-group" id="memberGroup">
      <button class="btn-choice" onclick="selectMember(this,'yes')">
        <span class="choice-icon">üí≥</span>
        <span class="choice-text">
          <strong>‰ºöÂì°„Åß„Åô</strong>
          <div class="choice-desc">35%Ââ≤Âºï„ÅÆ‰ºöÂì°‰æ°Ê†º„ÅåÈÅ©Áî®„Åï„Çå„Åæ„Åô</div>
        </span>
        <span class="check-mark">‚úî</span>
      </button>
      <button class="btn-choice" onclick="selectMember(this,'join')">
        <span class="choice-icon">üéâ</span>
        <span class="choice-text">
          <strong>ÂΩìÊó•‰ºöÂì°ÂÖ•‰ºö„Åó„Åü„ÅÑ <span class="join-badge">30%Ââ≤Âºï</span></strong>
          <div class="choice-desc">ÂΩìÊó•„ÅîÂÖ•‰ºö„Åß„ÇÇ30%Ââ≤Âºï„ÅåÈÅ©Áî®„Åï„Çå„Åæ„Åô</div>
        </span>
        <span class="check-mark">‚úî</span>
      </button>
      <button class="btn-choice" onclick="selectMember(this,'no')">
        <span class="choice-icon">üìù</span>
        <span class="choice-text">
          <strong>‰ºöÂì°„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</strong>
          <div class="choice-desc">‰∏ÄËà¨‰æ°Ê†º„Åß„ÅÆ„ÅîÊ°àÂÜÖ„Å®„Å™„Çä„Åæ„Åô</div>
        </span>
        <span class="check-mark">‚úî</span>
      </button>
      <button class="btn-choice" onclick="selectMember(this,'unknown')">
        <span class="choice-icon">‚ùì</span>
        <span class="choice-text">
          <strong>„Çè„Åã„Çä„Åæ„Åõ„Çì</strong>
          <div class="choice-desc">ÊãÖÂΩìËÄÖ„Åå„ÅîÁ¢∫Ë™ç„ÅÑ„Åü„Åó„Åæ„Åô</div>
        </span>
        <span class="check-mark">‚úî</span>
      </button>
    </div>
  </div>
  
  <div class="nav-buttons">
    <button class="btn-back" onclick="goToStep(5)">‚Üê Êàª„Çã</button>
    <button class="btn-next" onclick="goToStep(7)">Ê¨°„Å∏ ‚Üí „ÅäË¶ãÁ©ç„ÇÇ„ÇäÁ¢∫Ë™ç</button>
  </div>
</div>

<!-- ===== STEP 7: „ÅäË¶ãÁ©ç„ÇÇ„ÇäÁ¢∫Ë™ç ===== -->
<div class="step" id="step7">
  <div class="step-title"><span class="step-title-text"><span class="step-num">7</span>„ÅäË¶ãÁ©ç„ÇÇ„Çä„ÅÆÁ¢∫Ë™ç</span><button class="btn-restart-topright no-print" onclick="restartApp()">üîÑ ÊúÄÂàù„Å´Êàª„Çã</button></div>
  
  <div class="estimate-card" id="estimateCard">
    <!-- JavaScript„ÅßÂãïÁöÑÁîüÊàê -->
  </div>
  
  <!-- Âº∑Ë™øË≠¶ÂëäÔºöÊ≠£ÂºèË¶ãÁ©ç„ÇÇ„Çä„Åß„ÅØ„Å™„ÅÑ -->
  <div class="warning-box-strong">
    <div class="warning-icon">‚ö†Ô∏è</div>
    <div class="warning-title">„ÄêÈáçË¶Å„Äë„Åì„Çå„ÅØÊ≠£ÂºèË¶ãÁ©ç„ÇÇ„Çä„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</div>
    <div class="warning-content">
      ‰∏äË®ò„ÅÆÈáëÈ°ç„ÅØ„ÄÅ„ÅîÂÖ•Âäõ„ÅÑ„Åü„Å†„ÅÑ„ÅüÊÉÖÂ†±„ÇíÂü∫„Å´„Åó„Åü<strong>Ê¶ÇÁÆó„ÅÆÁõÆÂÆâ</strong>„Åß„Åô„ÄÇ<br>
      <br>
      ÂÆüÈöõ„ÅÆË≤ªÁî®„ÅØ‰ª•‰∏ã„Å´„Çà„ÇäÂ§âÂãï„Åó„Åæ„ÅôÔºö<br>
      ‚Ä¢ „Åä„ÇÇ„Å¶„Å™„ÅóË≤ªÁî®ÔºàÂèÇÂàóËÄÖÊï∞„Å´„Çà„ÇãÔºâ<br>
      ‚Ä¢ „Ç™„Éó„Ç∑„Éß„É≥„Çµ„Éº„Éì„Çπ„ÅÆÈÅ∏ÊäûÂÜÖÂÆπ<br>
      ‚Ä¢ ÂºèÂ†¥„ÅÆ‰ΩøÁî®Áä∂Ê≥Å„ÇÑÊó•Á®ã<br>
      ‚Ä¢ „Åù„ÅÆ‰ªñ„ÅîË¶ÅÊúõ„Å´„Çà„ÇãËøΩÂä†È†ÖÁõÆ<br>
      <br>
      <strong>Ê≠£Âºè„Å™„ÅäË¶ãÁ©ç„ÇÇ„Çä„ÅØ„ÄÅÊãÖÂΩìËÄÖ„Å®„ÅÆÊâì„Å°Âêà„Çè„ÅõÂæå„Å´‰ΩúÊàê„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ</strong>
      <span class="warning-emphasis">üìû Ë©≥Á¥∞„ÅØÊãÖÂΩìËÄÖ„Å´ÂøÖ„Åö„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ</span>
    </div>
  </div>
  
  <!-- PDF„ÉªLINE„Éª„É°„Éº„É´ ÂÖ±Êúâ„Éú„Çø„É≥ÔºàÊîπÂñÑÁâàÔºâ -->
  <div class="estimate-action-buttons">
    <button type="button" class="btn-estimate-action btn-pdf" onclick="gaTrack('pdf_download',{step:state.currentStep}); downloadEstimatePDF()">
      <span class="btn-icon">üìÑ</span>
      <span class="btn-label">
        <span class="btn-label-main">PDF‰øùÂ≠ò</span>
        <span class="btn-label-sub">Ë¶ãÁ©ç„ÇÇ„Çä„ÇíPDF„Éï„Ç°„Ç§„É´„Åß‰øùÂ≠ò„Åô„Çã</span>
      </span>
    </button>
    <button type="button" class="btn-estimate-action btn-line" onclick="gaTrack('line_share',{step:state.currentStep}); shareToLINE()">
      <span class="btn-icon">üí¨</span>
      <span class="btn-label">
        <span class="btn-label-main">LINE„ÅßÂÖ±Êúâ</span>
        <span class="btn-label-sub">Ë©≥Á¥∞„Å™Ë¶ãÁ©ç„ÇÇ„ÇäÂÜÖÂÆπ„ÇíLINE„Å´ÈÄÅ„Çã</span>
      </span>
    </button>
    <button type="button" id="sendEstimateEmailBtn" class="btn-estimate-action btn-email" onclick="gaTrack('email_send_click',{step:state.currentStep}); sendEstimateEmail()">
      <span class="btn-icon">‚úâÔ∏è</span>
      <span class="btn-label">
        <span class="btn-label-main">„É°„Éº„É´ÈÄÅ‰ø°</span>
        <span class="btn-label-sub">ÊãÖÂΩìËÄÖ„Å∏Ë¶ãÁ©ç„ÇÇ„Çä„Çí„É°„Éº„É´„ÅßÈÄÅ‰ø°„Åô„Çã</span>
      </span>
    </button>
    <button type="button" class="btn-estimate-action btn-sms" onclick="smsShare()">
      <span class="btn-icon">üì±</span>
      <span class="btn-label">
        <span class="btn-label-main">SMS„ÅßÈÄÅ‰ø°</span>
        <span class="btn-label-sub">„Ç∑„Éß„Éº„Éà„É°„ÉÉ„Çª„Éº„Ç∏„ÅßÂÜÖÂÆπ„ÇíÈÄÅ‰ø°„Åô„Çã</span>
      </span>
    </button>
  </div>

  <!-- „É°„Éº„É´ÈÄÅ‰ø°ÁµêÊûú„Éê„Éä„ÉºÔºàstep7Áî®Ôºâ -->
  <div id="estimateEmailBanner" style="display:none; margin-top:12px; padding:12px 16px; border-radius:10px; font-size:0.92rem; font-weight:bold; line-height:1.6;"></div>

  <div class="nav-buttons">
    <button class="btn-back" onclick="goToStep(6)">‚Üê Êàª„Çã</button>
    <button class="btn-finish" id="submitBtn" onclick="submitAndComplete()">‚úî ÈÄÅ‰ø°„Åó„Å¶ÂÆå‰∫Ü</button>
  </div>
</div>

<!-- ===== STEP 8: ÂÆå‰∫Ü ===== -->
<div class="step" id="step8">

  <!-- Á¥ôÂêπÈõ™ -->
  <div class="confetti-wrap no-print" id="confettiWrap"></div>

  <!-- ÊÑüË¨ù„É°„ÉÉ„Çª„Éº„Ç∏„Ç´„Éº„Éâ -->
  <div class="complete-card">
    <div class="complete-icon">üå∏</div>
    <div class="complete-badge">‚ú® ÂÖ•ÂäõÂÆå‰∫Ü ‚ú®</div>
    <div class="complete-title">
      „ÅîÂÖ•Âäõ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ<br>
      ÂøÉ„Çà„Çä„ÅäÁ§ºÁî≥„Åó‰∏ä„Åí„Åæ„Åô
    </div>
    <div class="complete-subtitle">‚öò „Åï„ÅÑ„ÅçËë¨Á•≠„Çπ„Çø„ÉÉ„Éï‰∏ÄÂêå„Çà„Çä</div>
    <div class="complete-divider"></div>
    <div class="complete-text">
      „ÅäÁ¥ÑÊùü„ÅÆ„ÅäÊôÇÈñì„Å´ÊãÖÂΩìËÄÖ„ÅåÂèÇ„Çä„Åæ„Åô„ÄÇ<br>
      ÂøÉ„ÇíËæº„ÇÅ„Å¶„ÅäÊâì„Å°Âêà„Çè„Åõ„ÅÆÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç„Åï„Åõ„Å¶„ÅÑ„Åü„Å†„Åç„Åæ„Åô„ÄÇ<br><br>
      „ÅäÊÄ•„Åé„ÅÆÂ†¥Âêà„ÅØ„ÅäÈõªË©±„Åè„Å†„Åï„ÅÑ„ÄÇ<br>
      24ÊôÇÈñì365Êó•„ÄÅ„ÅÑ„Å§„Åß„ÇÇ„ÅäÂèó„Åë„Åó„Åæ„Åô„ÄÇ
      <br><br>
      <a class="complete-phone no-print" href="tel:0120315312">
        üìû 0120-315-312
      </a>
      <div class="complete-hours">24ÊôÇÈñì 365Êó• Âπ¥‰∏≠ÁÑ°‰ºë</div>
    </div>
  </div>

  <!-- Âç∞Âà∑Â∞ÇÁî®„Éò„ÉÉ„ÉÄ„Éº -->
  <div class="print-header" id="printHeader">
    <h2>‚öò „Åï„ÅÑ„ÅçËë¨Á•≠ „ÅîËë¨ÂÑÄ„Çµ„Éù„Éº„Éà „ÅäË¶ãÁ©ç„ÇÇ„ÇäÔºÜ„ÅîÁõ∏Ë´áË®òÈå≤</h2>
    <p id="printDate"></p>
  </div>

  <div class="submit-result-banner" id="submitResultBanner"></div>

  <div id="finalSummary" style="background:#fff; border-radius:12px; border:2px solid var(--clr-border); padding:16px; margin-bottom:16px; font-size:0.87rem; line-height:1.9;"></div>

  <!-- „ÉÅ„É£„ÉÉ„Éà‰ºöË©±Â±•Ê≠¥ÔºàPDFÂç∞Âà∑Áî®Ôºâ -->
  <div class="print-chat-log" id="printChatLog">
    <div class="print-chat-log-title">üí¨ „ÅîÂ∏åÊúõ„Éª„Åî‰∏çÂÆâ „ÉÅ„É£„ÉÉ„Éà‰ºöË©±Â±•Ê≠¥</div>
    <div id="printChatMessages"></div>
  </div>

  <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
  <div class="step8-actions no-print">
    <div class="step8-actions-title">üíö Ë¶ãÁ©ç„ÇÇ„Çä„Çí‰øùÂ≠ò„ÉªÂÖ±Êúâ„Åô„Çã</div>

    <button type="button" class="btn-s8 btn-s8-line" onclick="shareToLINE()">
      <span class="s8-icon">üí¨</span>
      <span class="s8-label">
        <span class="s8-main">LINE„ÅßÂÖ±Êúâ</span>
        <span class="s8-sub">Ë¶ãÁ©ç„ÇÇ„ÇäË©≥Á¥∞„ÇíLINE„Å´ÈÄÅ„Çã</span>
      </span>
    </button>

    <button type="button" class="btn-s8 btn-s8-sms" onclick="smsShare()">
      <span class="s8-icon">üì±</span>
      <span class="s8-label">
        <span class="s8-main">SMS„ÅßÂÖ±Êúâ</span>
        <span class="s8-sub">„Ç∑„Éß„Éº„Éà„É°„ÉÉ„Çª„Éº„Ç∏„ÅßÈÄÅ„Çã</span>
      </span>
    </button>

    <button class="btn-s8 btn-s8-pdf" onclick="printPage()">
      <span class="s8-icon">üñ®Ô∏è</span>
      <span class="s8-label">
        <span class="s8-main">Âç∞Âà∑„ÉªPDF‰øùÂ≠ò</span>
        <span class="s8-sub">Ë¶ãÁ©ç„ÇÇ„Çä„ÇíPDF„Å®„Åó„Å¶‰øùÂ≠ò</span>
      </span>
    </button>

    <div class="step8-actions-title" style="margin-top:8px;">üîÑ „ÇÑ„ÇäÁõ¥„Åô</div>
    <button class="btn-s8 btn-s8-restart" onclick="restartApp()">
      <span class="s8-icon">üîÑ</span>
      <span class="s8-label">
        <span class="s8-main">ÊúÄÂàù„Å´Êàª„Çã</span>
        <span class="s8-sub">‚öò „Åï„ÅÑ„ÅçËë¨Á•≠ „ÅîËë¨ÂÑÄ„Çµ„Éù„Éº„Éà„ÅÆ„Éà„ÉÉ„Éó„Å∏</span>
      </span>
    </button>
  </div>

  <!-- ===== Ëë¨ÂÑÄ„ÅÆÊµÅ„Çå „Çø„Ç§„É†„É©„Ç§„É≥ ===== -->
  <div class="flow-section no-print">
    <div class="flow-section-title">üìã „ÅîËë¨ÂÑÄ„ÅÆÊµÅ„ÇåÔºà‰∏ÄËà¨ÁöÑ„Å™ÂÆ∂ÊóèËë¨„ÅÆÂ†¥ÂêàÔºâ</div>

    <!-- „Éï„Çß„Éº„Ç∫1: Áî≥Ëæº„ÉªÊ∫ñÂÇô -->
    <div class="flow-phase-label">
      <span class="flow-phase-badge">üìû Áî≥Ëæº„ÉªÊ∫ñÂÇô</span>
      <span class="flow-phase-line"></span>
    </div>
    <div class="flow-timeline">

      <div class="flow-item">
        <div class="flow-badge"><span>STEP</span><span class="badge-num">1</span></div>
        <div class="flow-card">
          <div class="flow-header">
            <span class="flow-icon">üìû</span>
            <span class="flow-title">„ÅäÈõªË©±„Éª„ÅîÈÄ£Áµ°</span>
            <span class="flow-timing">„ÅîÈÄùÂéªÁõ¥Âæå</span>
          </div>
          <div class="flow-desc">
            „Åæ„Åö„Åï„ÅÑ„ÅçËë¨Á•≠„Å∏„ÅäÈõªË©±„Åè„Å†„Åï„ÅÑ„ÄÇ24ÊôÇÈñì365Êó•„ÄÅÂ∞ÇÈñÄ„Çπ„Çø„ÉÉ„Éï„ÅåÂØæÂøú„ÄÇÊúÄÁü≠30ÂàÜ„ÅßÂØùÂè∞Ëªä„Åå„ÅäËøé„Åà„Å´‰º∫„ÅÑ„Åæ„Åô„ÄÇ
            <div class="flow-note">üì± 0120-315-312Ôºà24ÊôÇÈñì„ÉªÁÑ°ÊñôÔºâ<br>„Åä‰ºù„Åà„ÅÑ„Åü„Å†„Åè„Åì„Å®ÔºöÊïÖ‰∫∫Êßò„ÅÆ„ÅäÂêçÂâç / „ÅäËøé„ÅàÂ†¥ÊâÄ / „ÅäÈÄÅ„ÇäÂÖà</div>
          </div>
        </div>
      </div>

      <div class="flow-item">
        <div class="flow-badge"><span>STEP</span><span class="badge-num">2</span></div>
        <div class="flow-card">
          <div class="flow-header">
            <span class="flow-icon">üöê</span>
            <span class="flow-title">„ÅîÊê¨ÈÄÅ„Éª„ÅîÂÆâÁΩÆ</span>
            <span class="flow-timing">ÂΩìÊó•„ÄúÁøåÊó•</span>
          </div>
          <div class="flow-desc">
            ÁóÖÈô¢Á≠â„ÅÆ„ÅîÈÄùÂéªÂ†¥ÊâÄ„Åã„Çâ„ÄÅËá™ÂÆÖ„Åæ„Åü„ÅØÂÆâÁΩÆÊâÄ„Å∏Êê¨ÈÄÅ„ÄÇÂåªÂ∏´„Çà„ÇäÊ≠ª‰∫°Ë®∫Êñ≠Êõ∏„ÇíÂèó„ÅëÂèñ„Çä„Åæ„Åô„ÄÇÊûïÈ£æ„Çä„Éª„Éâ„É©„Ç§„Ç¢„Ç§„Çπ„ÅØ„Åï„ÅÑ„ÅçËë¨Á•≠„Åß„ÅîÁî®ÊÑè„Åó„Åæ„Åô„ÄÇ
          </div>
        </div>
      </div>

      <div class="flow-item">
        <div class="flow-badge"><span>STEP</span><span class="badge-num">3</span></div>
        <div class="flow-card">
          <div class="flow-header">
            <span class="flow-icon">üìã</span>
            <span class="flow-title">Êâì„Å°Âêà„Çè„Åõ„Éª„ÅîÊ∫ñÂÇô„Éª„ÅîÁ¥çÊ£∫</span>
            <span class="flow-timing">1Êó•ÁõÆ</span>
          </div>
          <div class="flow-desc">
            „Çπ„Çø„ÉÉ„Éï„Å®Êó•Á®ã„ÉªÂ†¥ÊâÄ„ÉªÂÜÖÂÆπ„ÉªË≤ªÁî®„ÇíÊâì„Å°Âêà„Çè„Åõ„ÄÇ„Åî‰∫àÁÆó„Å´Âøú„Åò„Åü„Éó„É©„É≥„Çí„ÅîÊèêÊ°à„Åó„Åæ„Åô„ÄÇ„ÅîÂÆ∂ÊóèÂèÇÂä†Âûã„ÅÆÁ¥çÊ£∫„ÇíÊé®Â•®„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
            <div class="flow-note">üìÑ „ÅîÊ∫ñÂÇô„ÅÑ„Åü„Å†„Åè„ÇÇ„ÅÆÔºöÊ≠ª‰∫°Ë®∫Êñ≠Êõ∏ / „ÅäÂÜôÁúü / Âç∞ÈëëÔºàË™çÂç∞Ôºâ<br>‚ÄªÁÅ´Ëë¨Ë®±ÂèØÁî≥Ë´ã„ÅØ„Åï„ÅÑ„ÅçËë¨Á•≠„ÅåÁÑ°Êñô„Åß‰ª£Ë°å„Åó„Åæ„Åô</div>
          </div>
        </div>
      </div>

    </div><!-- /flow-timeline Áî≥ËæºÊ∫ñÂÇô -->

    <!-- „Éï„Çß„Éº„Ç∫2: „ÅäÈÄöÂ§ú -->
    <div class="flow-phase-label">
      <span class="flow-phase-badge">üïØÔ∏è „ÅäÈÄöÂ§ú</span>
      <span class="flow-phase-line"></span>
    </div>
    <div class="flow-timeline">

      <div class="flow-item">
        <div class="flow-badge"><span>STEP</span><span class="badge-num">4</span></div>
        <div class="flow-card">
          <div class="flow-header">
            <span class="flow-icon">üïØÔ∏è</span>
            <span class="flow-title">„ÅäÈÄöÂ§ú</span>
            <span class="flow-timing">1„Äú2Êó•ÁõÆ Â§ïÊñπÔºà18:00„ÄúÔºâ</span>
          </div>
          <div class="flow-desc">
            ÂÉß‰æ∂„ÅÆ„ÅîË™≠Áµå„ÅÆ„ÇÇ„Å®„ÄÅÈÅ∫Êóè‚ÜíË¶™Êóè‚ÜíÂºîÂïèËÄÖ„ÅÆÈ†Ü„Åß„ÅîÁÑºÈ¶ô„ÄÇÂèó‰ªò„ÉªÊé•ÂæÖÊñπÊ≥ï„Å™„Å©‰∫ãÂâç„Å´‰∏ÅÂØß„Å´„Ç¢„Éâ„Éê„Ç§„Çπ„Åó„Åæ„Åô„ÄÇ<br>‚Äª„ÅîÈÄùÂéªÂΩìÊó•„ÄúÁøåÊó•„ÅÆÂ§ïÊñπ„Å´Ë°å„ÅÑ„Åæ„Åô„ÄÇÊê¨ÈÄÅ„ÉªÊâìÂêà„Åõ„ÅÆ„Çø„Ç§„Éü„É≥„Ç∞„Å´„Çà„Çä1Êó•ÁõÆ„Éª2Êó•ÁõÆ„Å©„Å°„Çâ„Å´„Å™„ÇãÂ†¥Âêà„ÇÇ„ÅÇ„Çä„Åæ„Åô„ÄÇ
            <div class="flow-note">
              üïê <strong>ÈñãÂºèÁõÆÂÆâÔºö18:00„Äú</strong>ÔºàÂèó‰ªò„ÅØ30ÂàÜÂâç 17:30„ÄúÔºâ<br>
              üï° <strong>ÁµÇÂºèÁõÆÂÆâÔºö18:30„Äú19:00</strong><br>
              ‚è±Ô∏è ÈÄöÂ§úÂºèÔºö<strong>Á¥Ñ30„Äú60ÂàÜ</strong><br>
              üåô „Åù„ÅÆÂæå„ÄÅ„ÅîÈÅ∫Êóè„ÅØÊïÖ‰∫∫Êßò„Å®„Å®„ÇÇ„Å´Â§ú„ÇíÈÅé„Åî„Åó„Åæ„ÅôÔºàÈÄöÂ§úÊåØ„ÇãËàû„ÅÑÔºâ
            </div>
          </div>
        </div>
      </div>

    </div><!-- /flow-timeline „ÅäÈÄöÂ§ú -->

    <!-- „Éï„Çß„Éº„Ç∫3: Ëë¨ÂÑÄÂΩìÊó• -->
    <div class="flow-phase-label">
      <span class="flow-phase-badge">‚õ©Ô∏è Ëë¨ÂÑÄÂΩìÊó•</span>
      <span class="flow-phase-line"></span>
    </div>
    <div class="flow-timeline">

      <div class="flow-item">
        <div class="flow-badge"><span>STEP</span><span class="badge-num">5</span></div>
        <div class="flow-card">
          <div class="flow-header">
            <span class="flow-icon">‚õ©Ô∏è</span>
            <span class="flow-title">Ëë¨ÂÑÄ„ÉªÂëäÂà•Âºè„ÉªÁÅ´Ëë¨</span>
            <span class="flow-timing">„ÅäÈÄöÂ§úÁøåÊó•</span>
          </div>
          <div class="flow-desc">
            ÂëäÂà•ÂºèÔºàÁ¥Ñ1ÊôÇÈñìÔºâ‚Üí „ÅäÂà•„Çå„ÅÆÂÑÄ ‚Üí Âá∫Ê£∫ ‚Üí ÁÅ´Ëë¨Â†¥„Å∏„ÄÇ„Çπ„Çø„ÉÉ„Éï„ÅåÁÅ´Ëë¨Â†¥„Åæ„ÅßÂêåË°å„Åó„Åæ„Åô„ÄÇÁÅ´Ëë¨Âæå„ÅØ„ÅäÈ™®‰∏ä„Åí„ÄÇ
            <div class="flow-note">‚è±Ô∏è ÂëäÂà•ÂºèÔºöÁ¥Ñ1ÊôÇÈñì / ÁÅ´Ëë¨ÔºöÁ¥Ñ1ÊôÇÈñì15„Äú30ÂàÜ</div>
          </div>
        </div>
      </div>

      <div class="flow-item">
        <div class="flow-badge"><span>STEP</span><span class="badge-num">6</span></div>
        <div class="flow-card">
          <div class="flow-header">
            <span class="flow-icon">üôè</span>
            <span class="flow-title">Âàù‰∏ÉÊó•Ê≥ïË¶Å„ÉªÁ≤æÈÄ≤ËêΩ„Å®„Åó</span>
            <span class="flow-timing">Ëë¨ÂÑÄÂΩìÊó• ÂçàÂæå</span>
          </div>
          <div class="flow-desc">
            „ÅîÂ∏∞ÂÆÖÂæå„ÄÅÂàù‰∏ÉÊó•Ê≥ïË¶Å„ÇíÂü∑„ÇäË°å„ÅÑ„ÄÅÁ≤æÈÄ≤ËêΩ„Å®„ÅóÔºà‰ºöÂ∏≠Ôºâ„Åß„ÅîÊï£‰ºö„ÄÇ„ÅäÁ§º„ÅÆ„ÅîÊå®Êã∂„Å®Âä¥„ÅÑ„ÅÆÂ†¥„Å®„Å™„Çä„Åæ„Åô„ÄÇ
          </div>
        </div>
      </div>

    </div><!-- /flow-timeline Ëë¨ÂÑÄÂΩìÊó•ÔºàÂëäÂà•Âºè„ÉªÁÅ´Ëë¨Ôºâ -->

    <!-- „Éï„Çß„Éº„Ç∫4: Ëë¨ÂÑÄÂæå„Çµ„Éù„Éº„Éà -->
    <div class="flow-phase-label">
      <span class="flow-phase-badge">ü§ù Ëë¨ÂÑÄÂæå„Çµ„Éù„Éº„Éà</span>
      <span class="flow-phase-line"></span>
    </div>
    <div class="flow-timeline">
      <div class="flow-item">
        <div class="flow-badge"><span>STEP</span><span class="badge-num">7</span></div>
        <div class="flow-card">
          <div class="flow-header">
            <span class="flow-icon">ü§ù</span>
            <span class="flow-title">Ëë¨ÂÑÄÂæå„Çµ„Éù„Éº„Éà</span>
            <span class="flow-timing">Ëë¨ÂÑÄÂæå„Äú</span>
          </div>
          <div class="flow-desc">
            Â∞Ç‰ªª„Çπ„Çø„ÉÉ„Éï„ÅåÁÑ°Êñô„Åß„Ç¢„Éâ„Éê„Ç§„Çπ„ÄÇÂõõÂçÅ‰πùÊó•„ÉªÂπ¥ÂøåÊ≥ïË¶Å„Åæ„ÅßÁ∂ôÁ∂ö„Åó„Å¶„Çµ„Éù„Éº„Éà„Åó„Åæ„Åô„ÄÇ
          </div>
        </div>
      </div>
    </div>

    <!-- Ëë¨ÂÑÄÂæå„Å´ÂøÖË¶Å„Å™„Åì„Å® -->
    <div class="flow-after-section">
      <div class="after-title">üìù Ëë¨ÂÑÄÂæå„Å´ÂøÖË¶Å„Å™„Åì„Å®ÔºàÂÖ®„Å¶ÁÑ°Êñô„Çµ„Éù„Éº„ÉàÔºâ</div>
      <div class="flow-after-items">
        <span class="flow-after-tag">„ÅäÂØ∫Êßò„Å∏„ÅÆ„ÅäÁ§º</span>
        <span class="flow-after-tag">È¶ôÂÖ∏Ëøî„Åó„ÅÆÊâãÈÖç</span>
        <span class="flow-after-tag">„Åä‰ΩçÁâå„Éª‰ªèÂ£á„ÅÆÊ∫ñÂÇô</span>
        <span class="flow-after-tag">Á¥çÈ™®„Éª„ÅäÂ¢ì„ÅÆÊ∫ñÂÇô</span>
        <span class="flow-after-tag">ÂΩπÊâÄ„Å∏„ÅÆÂêÑÁ®ÆÂ±äÂá∫</span>
        <span class="flow-after-tag">ÂõõÂçÅ‰πùÊó•Ê≥ïË¶Å„ÅÆ„ÅîÊ°àÂÜÖ</span>
        <span class="flow-after-tag">Âπ¥ÂøåÊ≥ïË¶Å„ÅÆ„ÅîÁõ∏Ë´á</span>
      </div>
    </div>

    <!-- CTAÈõªË©± -->
    <div class="flow-phone-cta">
      <div class="cta-text">üïê 24ÊôÇÈñì365Êó•„Éª„ÅîÁõ∏Ë´á„Éª„Åî‰æùÈ†º„ÅØ„ÅÑ„Å§„Åß„ÇÇ</div>
      <a href="tel:0120315312">üìû 0120-315-312</a>
      <div class="cta-sub">‚öò „Åï„ÅÑ„ÅçËë¨Á•≠„Çπ„Çø„ÉÉ„Éï‰∏ÄÂêå</div>
    </div>

  </div>
  <!-- ===== /Ëë¨ÂÑÄ„ÅÆÊµÅ„Çå „Çø„Ç§„É†„É©„Ç§„É≥ ===== -->

<script>
// ========== „Éá„Éº„ÇøÂÆöÁæ© ==========

const IMG = {
  ai:   'https://sspark.genspark.ai/cfimages?u1=nT5quTOKQ7O6dN7%2FNZqDTumLphmArsXpAg%2FidVQwm9xnCQhDF9nD0K5Vj%2B3Ic9IiPSrjpsjx5xXkgq4y7DwnkHLTh%2Ba6HyQEHwJEx25n0YltONjDzioxzvWXdJ6ZCtqrTZRiCeC0F%2BrZHUMHJA2F9LMQWEXKwTA7ig%3D%3D&u2=GPKZhykKgNRdFIQs&width=1024',
  hana: 'https://sspark.genspark.ai/cfimages?u1=FWRGlMdJPTl3PkI6X3H4m9beWqR1IwPAuodXFneVtcj77uRI1lhaGtGnjkW60XPe%2B50mc6%2B2l%2F8QCfmWlTTO6oGZq%2B%2BIRz9XcYLwpk2aH7tTksxRmwNH2RZqTOFP%2FBIs6675Ze1Wg4ofi%2BGsbq9GQsi1Q8MI02Pl2jnd&u2=UR%2Bcdja2fICIA7bS&width=1024',
  kaori:'https://sspark.genspark.ai/cfimages?u1=8S5IE1Ne3ZILlI47bWm6xsbrfU4k54OwY7DeUh57bak1y4x4uiVhjYgl4oU6NVAYfK53x4d6K4aoLL2OeJyXli1wT%2Bj7OZ8Y0Gh9yCDdZJD%2F1lL65odcpj1IB%2BPf4wCFI5ewgDC5%2BVU3oRgMKtvf27wgSB0R1wkpRDdgRg%3D%3D&u2=p0bJTs%2FGuJ5EKbF%2B&width=1024',
  kaga: 'https://sspark.genspark.ai/cfimages?u1=eLpG%2FgY9JBLEumdLrEdSh26WP5dQREM%2FhDIjvZj9XQcar2XLClGcgSrEoQDPOTNlQwfMWS594Z5XHefZjloMLGCPSG3FPAxsSTKMCYzvfQAs1ExspKqYbTqBBsb8SCr%2FuvUvIsxfixxGMmwpWDG7oW0V%2Bo9juresvwScK%2BDl5Q%3D%3D&u2=T6urtJBYLpuVuwF8&width=1024',
  // „É™„Éì„É≥„Ç∞„Ç≥„Éº„ÇπÂ∞ÇÁî®Á•≠Â£á
  living_ai:   'https://sspark.genspark.ai/cfimages?u1=pQpKKeEit3T9d7xBH4%2FbkbxeT%2Bwy9%2BUb0jw%2BCfOiUELGvqH%2FTHjd7IpASiGd9m83Yuc34Z3VKf021c6SMgRkAMU5dC08CnBU5ZdDrNrfwyRryR6flCHsN9qjTULqPAGXIHCY5mSFQzy3QHEWy%2FRjBepfsCSlfpZGX95SOukidbNnkQ%3D%3D&u2=iFIWuiLz%2Bzm21Ze9&width=1024',
  living_hana: 'https://sspark.genspark.ai/cfimages?u1=cU2vptQ%2FUqgCGxAKelTq72ns9gQVLQrr7wLhjskjn6vEOR641G7HRRDjdmy4XgnZVlWDmckp6F6pqE2G8V185ViXlNLPjAieO%2B8BEHeVhefCBgKtQo65nKzKWEQLRNCxMXWzTYHDb3q7KJdI0Vkl9zqEanElyc2i1RpqcWroUOB%2B%2BhYP&u2=xCwpakZRKWanbsIT&width=1024',
  living_kaori:'https://sspark.genspark.ai/cfimages?u1=KUY6g73bfffIgq6C1jLH%2BNXDFuxm659dFSL8N%2Fzwu2PkpOT93sV9ne0x8iUh%2BxUsgtF8c3EW6%2BKo8cD6xfN1%2Bqj%2BnZhqeqdFL1gnnGU%2BgICZvbo5Z5Sv75Q6pdXVo%2FvJP9RRHzwzgLTECBF9X8Yb378VC5qho5JSFC%2BZvkcFJpjT46Rauw%3D%3D&u2=Ve6n9dmTfkAK1ghM&width=1024',
  living_kaga: 'https://sspark.genspark.ai/cfimages?u1=AMAkgqbTLhc7%2FogDXeBRWO1e78FQWv7SBbnyBKZkl%2BYbvezlMwzmWA8QvM506lg%2FoE7tPal9S1SP43kpOy%2FNcz7q8UigB3GNcFd%2BnHEZmIpa2Dfs6jZ%2BSCqj0dFfZGQhq7tAdPuUZ56qIgKSjLkuC4mzSzPmngZOzlcS3r7ciVLqCBl2wqzrmQ%3D%3D&u2=YJiuuTwO0gdaMBeM&width=1024',
  // „Åµ„Å§„ÅÜ„ÅÆ„ÅäËë¨ÂºèÔºà‰∏ÄËà¨Ëë¨„ÉªÁ§æËë¨ÔºâÁî®Á•≠Â£á„Ç≥„Éº„ÇπÁîªÂÉè
  normal_ai:   'https://sspark.genspark.ai/cfimages?u1=uMRcdm1xpP9GYchwtMAz%2BRAbf51Y3kI8JgeTOwoBpd9koXXX7hPqLXqDgQE1%2F3PaVAg4YncJ8k8G72PUiKzE9HaKZ5BlhsWBiECb7MhB%2FVxtfAWyveRLqdqbhYiBTvwGo0uM9iDewHUXWGqdjElStx74Ndg5Tcg%2Flg%3D%3D&u2=ISZiChn%2FHVtCqTYG&width=1024',
  normal_hana: 'https://sspark.genspark.ai/cfimages?u1=etYilXsc3vfgPm%2B8f7fiKpLNqHZwwgJKvLOOD7QdCRDLymkDTKhBF0PgdTlcBPjLOBNGebzg6d0J4DeoW4mYwIq8mcUDV8IYNgnlFg88TrTIAQwkHc3aPmETDdEhvpXAWNuka4kcwp2TFFEEu9eyWHyW6qlbTj8HBWBO&u2=4l0f%2FXeCgDBIMUk2&width=1024',
  normal_kaori:'https://sspark.genspark.ai/cfimages?u1=jOfhCOa1OBQ4eWdSgOliHfIikh99Tr9D9PWHof1pWOWAqVUYokBp0nkTCL8DB3r4gJmKY3%2BFp0mwHTTIPL%2F7KTbqf2Wwuy7Lgtfi9%2BLcgiYU6MJVz%2Bxqecy%2FBhIbMSKtmeMuiiuVFLGldiCaSPMXPigprq1WpKGJskmbzg%3D%3D&u2=UXKKjApTHPoFU0Aw&width=1024',
  normal_kaga: 'https://sspark.genspark.ai/cfimages?u1=qBuQPaqQAofp%2BODq2Bae%2BCP%2BZhhDJ2ogcLNjXxH%2FI67HNSCmJFKWnDN%2BYONmbXMves8QF8JWcbcAJaX1O6q%2B1214%2BXd9VLILrqvp%2BAh%2Fx8Ap70MMHAyIjdcz%2B8m69gqylvfOvHJ45gFoUY8l8oOSajZZnVIwfKKGyCmMfnvzdA%3D%3D&u2=mLMLU1UrxzAkoGkL&width=1024',
  // „Éõ„Éº„É´Â§ñË¶≥
  hall_forest:  'https://sspark.genspark.ai/cfimages?u1=ZxNYfsT0wXO2oedmP7dwJF6PmvAgl7isNVyCT41opAVERCNiFv0VRue21cC280CRvzmH4UASNkAi2zopOpI%2FcLmbcJ%2FitYNdQbWqx0xCLSdljxTsLdpN0uE%2FvwUwv1iiDlKHPbHYAJULpklqq3nGIT%2F3gZtyBhiU&u2=IFTFT7L6ttpDl6kq&width=1024',
  hall_yasuragi:'https://sspark.genspark.ai/cfimages?u1=JD3sdHwCd9UguUNbtp83krdMZtBaCLQtAfw9S7P3EiwqC6W1Tw5swfUwQLlSJLO3iyqd8g5qY1Nqto15akUMjHfikrZzXs5uX4IjHMZ7UJ3Rx%2BoklWi%2FQqio0ZCscMydTANKjbqMemP6vgShBwrZpp%2Ff4wpeNbOrmJI%3D&u2=0QUHL4SigXbXR1nY&width=1024',
  hall_tsutsuji:'https://sspark.genspark.ai/cfimages?u1=7rrDkyC3hIroxC2fluFwHEeksJ0bUNtUcN4C%2Fsg2zXlQ0K9nImnPv%2F0M37bIIXoUPJoNL0OdAoTzljUC6fBdMRkhF3Xe8uTq1u46I%2F6sNDVXpHh03akakvF1JJshqzXwAvUlxD%2BlZL9wdwNU%2BJ%2Bb18cyoYIDaJi6ZbJu3Ns3qNowtw%3D%3D&u2=Y1v%2B37q6FHQe%2Fial&width=1024',
  hall_yasuura: 'https://sspark.genspark.ai/cfimages?u1=CafYEXSmhhbBOLttGKfJ4vF5JW0t6qd5VAxckRtblge0jogyp8%2BwLD6RlFm4%2FGCZhfJ7OMQ%2FyHjC7OUGt%2BJ9qZjIQddTCdZ4cahjsugE%2FL36XjkCAtGwpVxZlvZSGc62lyceTJrh7piUj38ooHFX6EMiSDfIC3x1J3gMaNRQS88Fb%2B0%3D&u2=Twb2gJDsaPErZw3A&width=1024',
  hall_shion:   'https://sspark.genspark.ai/cfimages?u1=PXRKn%2BQzvKjS03FE5kPb5tMyTxdDU9zeSeuyCeMczzxWaDghQv%2BtjUxgCzytV5YZiegOcjOw%2FfO3ZIce5U267jm5kkrwRnxdAaYY0YYHPWR4f0j4%2FU1Nv6mJfoP%2FRvLHGP0nrSaK92WZMkjiAdGo0IOuLJa0ELebSEjbsXZIAA%3D%3D&u2=oaG1F%2FmyUvzfUzOP&width=1024',
  hall_living:  'https://sspark.genspark.ai/cfimages?u1=pQpKKeEit3T9d7xBH4%2FbkbxeT%2Bwy9%2BUb0jw%2BCfOiUELGvqH%2FTHjd7IpASiGd9m83Yuc34Z3VKf021c6SMgRkAMU5dC08CnBU5ZdDrNrfwyRryR6flCHsN9qjTULqPAGXIHCY5mSFQzy3QHEWy%2FRjBepfsCSlfpZGX95SOukidbNnkQ%3D%3D&u2=iFIWuiLz%2Bzm21Ze9&width=1024',
  hall_ai_chokuso: 'https://saiki-sousai.com/wp-content/themes/tsuqrea-child/assets/img/plan/ai-kaso/lead_pic.jpg',
};

// „Éó„É©„Ç§„Ç∑„É≥„Ç∞Ôºà‰ºöÂì°‰æ°Ê†º„Éª‰∏ÄËà¨‰æ°Ê†ºÔºâ
const PRICING = {
  compact: { ai:[393800,573800], hana:[471800,651800], kaori:[602800,782800], kaga:[767800,947800] },
  living:  { ai:[547800,727800], hana:[625800,805800], kaori:[756800,936800], kaga:[921800,1101800] },
  family:  { ai:[712800,992800], hana:[800800,1080800], kaori:[931800,1211800], kaga:[1096800,1376800] },
  normal:  { ai:[877800,1157800], hana:[987800,1267800], kaori:[1140800,1420800], kaga:[1327800,1607800] },
  chokuso: { single:[198000,248000] },  // Áõ¥Ëë¨„ÉªÁÅ´Ëë¨ÂºèÔºà„Ç≥„Éº„ÇπÈÅ∏Êäû„Å™„ÅóÔºâ
  kasou:   { single:[148000,198000] }   // ÁÅ´Ëë¨„ÅÆ„ÅøÔºàÊúÄÂ∞èÈôêÔºâ
};

// „Éõ„Éº„É´„Éá„Éº„Çø
const HALLS = {
  tsutsuji: {
    id:'tsutsuji', name:'„Ç¢„Ç§„Éï„Ç£„ÉÉ„Éà„Éõ„Éº„É´„Å§„Å§„Åò', short:'„Å§„Å§„Åò',
    address:'„Äí739-0006 Êù±Â∫ÉÂ≥∂Â∏ÇË•øÊù°‰∏äÂ∏ÇÁî∫10-11',
    access:'JRË•øÊù°ÈßÖ„Åã„Çâ„Çø„ÇØ„Ç∑„Éº4ÂàÜ', capacity:'ÂÆ∂ÊóèËë¨Â∞ÇÁî®„Éõ„Éº„É´Ôºà„Äú15ÂêçÔºâ',
    image: IMG.hall_tsutsuji, pricingType:'compact',
    url:'https://saiki-sousai.com/plan/premium-compact-funeral/access#itfit-tsutsuji',
    maxPeople:15, planLabel:'„Éó„É¨„Éü„Ç¢„É†„Ç≥„É≥„Éë„ÇØ„ÉàÂÆ∂ÊóèËë¨',
    badge:'Â∞èË¶èÊ®°Âêë„Åç', special:''
  },
  yasuura: {
    id:'yasuura', name:'„Éï„Ç°„Éü„É™„Éº„Éõ„Éº„É´ÂÆâÊµ¶', short:'ÂÆâÊµ¶',
    address:'„Äí737-2516 ÂëâÂ∏ÇÂÆâÊµ¶Áî∫‰∏≠Â§Æ5‰∏ÅÁõÆ3-5',
    access:'JRÂÆâÊµ¶ÈßÖ„Åã„Çâ„Çø„ÇØ„Ç∑„Éº2ÂàÜÔºàÂæíÊ≠©3ÂàÜÔºâ', capacity:'ÂÆ∂ÊóèËë¨Â∞ÇÁî®„Éõ„Éº„É´Ôºà„Äú10ÂêçÔºâ',
    image: IMG.hall_yasuura, pricingType:'compact',
    url:'https://saiki-sousai.com/plan/premium-compact-funeral/access#family-yasuura',
    maxPeople:10, planLabel:'„Éó„É¨„Éü„Ç¢„É†„Ç≥„É≥„Éë„ÇØ„ÉàÂÆ∂ÊóèËë¨',
    badge:'', special:''
  },
  living: {
    id:'living', name:'„ÇÑ„Åô„Çâ„Åé„É™„Éì„É≥„Ç∞', short:'„É™„Éì„É≥„Ç∞',
    address:'„Äí739-0041 Êù±Â∫ÉÂ≥∂Â∏ÇË•øÊù°Áî∫ÂØ∫ÂÆ∂6282Ôºà„ÇÑ„Åô„Çâ„Åé‰ºöÈ§®ÂÜÖÔºâ',
    access:'JRË•øÊù°ÈßÖ„Åã„Çâ„Çø„ÇØ„Ç∑„Éº3ÂàÜ', capacity:'1ÁµÑÈôêÂÆö„ÉªÊúÄÂ§ß20Âêç',
    image: IMG.hall_living, pricingType:'living',
    url:'https://saiki-sousai.com/yasuragi-living',
    maxPeople:20, planLabel:'„ÇÑ„Åô„Çâ„Åé„É™„Éì„É≥„Ç∞Ëë¨',
    badge:'1Êó•1ÁµÑÈôêÂÆö', special:'living'
  },
  yasuragi: {
    id:'yasuragi', name:'„ÇÑ„Åô„Çâ„Åé‰ºöÈ§®', short:'„ÇÑ„Åô„Çâ„Åé',
    address:'„Äí739-0041 Êù±Â∫ÉÂ≥∂Â∏ÇË•øÊù°Áî∫ÂØ∫ÂÆ∂6282',
    access:'JRË•øÊù°ÈßÖ„Åã„Çâ„Çø„ÇØ„Ç∑„Éº3ÂàÜ', capacity:'‰∏≠„ÉªÂ§ß„Éõ„Éº„É´Ôºà„Äú300ÂêçÔºâ„ÄÅÂ∞è„Éõ„Éº„É´Ôºà„Äú50ÂêçÔºâ',
    image: IMG.hall_yasuragi, pricingType:'family',
    url:'https://saiki-sousai.com/yasuragi',
    maxPeople:300, planLabel:'ÂÆ∂ÊóèËë¨ÁöÑ„Å™„ÅäËë¨ÂºèÔºèÊôÆÈÄö„ÅÆ„ÅäËë¨Âºè',
    badge:'Â§ßË¶èÊ®°ÂØæÂøúÂèØ', special:''
  },
  forest: {
    id:'forest', name:'„Éï„Ç©„É¨„Çπ„Éà„Éõ„Éº„É´', short:'„Éï„Ç©„É¨„Çπ„Éà',
    address:'„Äí739-0042 Êù±Â∫ÉÂ≥∂Â∏ÇË•øÊù°Áî∫Ë•øÊù°Êù±1050',
    access:'JRË•øÊù°ÈßÖ„Åã„ÇâÂæíÊ≠©10ÂàÜ', capacity:'Â§ß„Éõ„Éº„É´Ôºà200Âêç‰ª•‰∏äÔºâ„ÄÅ‰∏≠„Éõ„Éº„É´Ôºà„Äú150ÂêçÔºâ„ÄÅÂ∞è„Éõ„Éº„É´Ôºà„Äú50ÂêçÔºâ',
    image: IMG.hall_forest, pricingType:'family',
    url:'https://saiki-sousai.com/forest-hall',
    maxPeople:300, planLabel:'ÂÆ∂ÊóèËë¨ÁöÑ„Å™„ÅäËë¨ÂºèÔºèÊôÆÈÄö„ÅÆ„ÅäËë¨Âºè',
    badge:'Â§ßË¶èÊ®°ÂØæÂøúÂèØ', special:''
  },
  shion: {
    id:'shion', name:'Aifit„Çª„É¨„É¢„Éã„Éº„Éõ„Éº„É´Á¥´Ëãë', short:'Á¥´Ëãë',
    address:'„Äí723-0052 Â∫ÉÂ≥∂Áúå‰∏âÂéüÂ∏ÇÁöÜÂÆü2‰∏ÅÁõÆ1-16',
    access:'JR‰∏âÂéüÈßÖ„Åã„Çâ„Çø„ÇØ„Ç∑„Éº6ÂàÜ', capacity:'‰∏≠„Éõ„Éº„É´Ôºà„Äú80ÂêçÔºâÂÆ∂ÊóèËë¨ÂèØ',
    image: IMG.hall_shion, pricingType:'normal',
    url:'https://saiki-sousai.com/plan/normal/access#ifit-shion',
    maxPeople:80, planLabel:'ÊôÆÈÄö„ÅÆ„ÅäËë¨ÂºèÔºèË¶™ÊóèËë¨',
    badge:'‰∏âÂéü„Ç®„É™„Ç¢', special:''
  },
  ai_chokuso: {
    id:'ai_chokuso', name:'„ÅÇ„ÅÑÁõ¥Ëë¨„Éõ„Éº„É´', short:'„ÅÇ„ÅÑÁõ¥Ëë¨',
    address:'„Äí739-0041 Â∫ÉÂ≥∂ÁúåÊù±Â∫ÉÂ≥∂Â∏ÇË•øÊù°Áî∫ÂØ∫ÂÆ∂6288',
    access:'üìû 0120-315-312ÔºàÁÑ°ÊñôÔºâ', capacity:'Áõ¥Ëë¨„ÉªÁÅ´Ëë¨ÂºèÂ∞ÇÁî®Ôºà„Äú10ÂêçÔºâ',
    image: IMG.hall_ai_chokuso, pricingType:'chokuso',
    url:'https://saiki-sousai.com/plan/ai-kaso/',
    maxPeople:10, planLabel:'Áõ¥Ëë¨„ÉªÁÅ´Ëë¨ÂºèÂ∞ÇÁî®„Éõ„Éº„É´',
    badge:'Áõ¥Ëë¨Â∞ÇÁî®', special:'chokuso'
  }
};

// „Ç≥„Éº„ÇπÊÉÖÂ†±
const COURSES = {
  ai:    { name:'ÊÑõ„Ç≥„Éº„Çπ', kanji:'ÊÑõ', desc:'„Ç∑„É≥„Éó„É´„ÅßÊ∏©„Åã„Åø„ÅÆ„ÅÇ„ÇãÁ•≠Â£á„ÄÇËêΩ„Å°ÁùÄ„ÅÑ„ÅüÈõ∞Âõ≤Ê∞ó„Åß„ÅäË¶ãÈÄÅ„Çä„ÄÇ', color:'#e8f4f8' },
  hana:  { name:'Ëä±„Ç≥„Éº„Çπ', kanji:'Ëä±', desc:'Áæé„Åó„ÅÑËä±„Çí„Åµ„Çì„Å†„Çì„Å´‰Ωø„Å£„Åü„ÄÅËèØ„ÇÑ„Åã„ÅßÊòé„Çã„ÅÑÁ•≠Â£á„ÄÇ', color:'#fce8f0' },
  kaori: { name:'È¶ô„Ç≥„Éº„Çπ', kanji:'È¶ô', desc:'ÂìÅÊ†º„ÅÇ„Çã‰Ωá„Åæ„ÅÑ„ÅÆÁ•≠Â£á„ÄÇÊïÖ‰∫∫„ÅÆÂ∞äÂé≥„ÇíË°®Áèæ„Åó„Åü„Ç∞„É¨„Éº„Éâ„Ç¢„ÉÉ„Éó„Éó„É©„É≥„ÄÇ', color:'#f0f4e8' },
  kaga:  { name:'Ëºù„Ç≥„Éº„Çπ', kanji:'Ëºù', desc:'ÊúÄÈ´ò„Ç∞„É¨„Éº„Éâ„ÅÆË±™ËèØ„Å™Á•≠Â£á„ÄÇÂ§ßÂàá„Å™Êñπ„Å∏„ÅÆÊúÄ‰∏ä„ÅÆ„ÅäÂà•„Çå„Çí„ÄÇ', color:'#f8f4e0' }
};

// „Éó„É©„É≥ÂÆöÁæ©Ôºà3„Éó„É©„É≥Ôºâ
function getPlans(attendance, funeralType) {
  const plans = [];
  
  if(attendance === 'under5') {
    plans.push({
      id:'nano', label:'small', name:'„Çπ„Éû„Éº„Éà„Éó„É©„É≥', icon:'üåø',
      desc:'„Åî„ÅèË∫´Ëøë„Å™„ÅîÂÆ∂Êóè5Âêç‰ª•‰∏ã„ÅÆ„Ç∑„É≥„Éó„É´„Å™„ÅäË¶ãÈÄÅ„Çä„ÄÇÊúÄÂ∞èÈôê„ÅÆË≤ªÁî®„ÅßÂøÉ„ÅÆ„Åì„ÇÇ„Å£„Åü„ÅäËë¨Âºè„ÄÇ',
      halls:['yasuura','tsutsuji'], priceType:'compact', sizeTag:'„Ç≥„É≥„Éë„ÇØ„Éà'
    });
    plans.push({
      id:'compact', label:'rec', name:'„Éó„É¨„Éü„Ç¢„É†„Ç≥„É≥„Éë„ÇØ„ÉàÂÆ∂ÊóèËë¨', icon:'üå∏',
      desc:'Â∞ë‰∫∫Êï∞„Åß„ÇÇÂÖÖÂÆü„Åó„ÅüÂÜÖÂÆπ„ÅÆÂÆ∂ÊóèËë¨„ÄÇ1Êó•1ÁµÑ„ÅÆ„Éó„É©„Ç§„Éô„Éº„Éà„Å™Âºè„ÇÇ„ÅîÁî®ÊÑè„ÄÇ',
      halls:['tsutsuji','living'], priceType:'compact', sizeTag:'Êé®Â•®'
    });
    plans.push({
      id:'living', label:'large', name:'„ÇÑ„Åô„Çâ„Åé„É™„Éì„É≥„Ç∞Ëë¨', icon:'üè°',
      desc:'„Éõ„Éº„É†„É©„Ç§„ÇØ„Å™Á©∫Èñì„ÅßÊúÄÂ§ß20Âêç„Åæ„Åß„ÅäË¶ãÈÄÅ„Çä„ÄÇ1Êó•1ÁµÑ„ÅÆÂÆåÂÖ®„Éó„É©„Ç§„Éô„Éº„ÉàÁ©∫Èñì„ÄÇ',
      halls:['living'], priceType:'living', sizeTag:'„ÇÜ„Å®„Çä'
    });
  } else if(attendance === 'under15') {
    plans.push({
      id:'compact', label:'small', name:'„Éó„É¨„Éü„Ç¢„É†„Ç≥„É≥„Éë„ÇØ„ÉàÂÆ∂ÊóèËë¨', icon:'üå∏',
      desc:'ÂÆ∂ÊóèËë¨Â∞ÇÁî®„Éõ„Éº„É´„Åß15Âêç‰ª•‰∏ã„ÅÆ„ÅîËë¨ÂÑÄ„ÄÇÊâãÈ†É„Å™Ë≤ªÁî®„ÅßÂÖÖÂÆü„Åó„ÅüÂÜÖÂÆπ„ÄÇ',
      halls:['tsutsuji','yasuura'], priceType:'compact', sizeTag:'„Ç≥„É≥„Éë„ÇØ„Éà'
    });
    plans.push({
      id:'living', label:'rec', name:'„ÇÑ„Åô„Çâ„Åé„É™„Éì„É≥„Ç∞Ëë¨', icon:'üè°',
      desc:'1Êó•1ÁµÑ„ÉªÊúÄÂ§ß20Âêç„ÄÇ„Éõ„Éº„É†„É©„Ç§„ÇØ„Å™„É™„Éì„É≥„Ç∞Á©∫Èñì„Åß„ÇÜ„Å£„Åü„Çä„ÅäË¶ãÈÄÅ„Çä„ÄÇ',
      halls:['living'], priceType:'living', sizeTag:'Êé®Â•®'
    });
    plans.push({
      id:'family', label:'large', name:'ÂÆ∂ÊóèËë¨ÁöÑ„Å™„ÅäËë¨Âºè', icon:'üåø',
      desc:'Â§ßÂûã„Éõ„Éº„É´„ÅÆÂ∞è„Éõ„Éº„É´„Çí‰ΩøÁî®„ÄÇÂ∞ÜÊù•„ÅÆ‰∫∫Êï∞Â¢óÂä†„Å´„ÇÇÂØæÂøúÂèØËÉΩ„Å™„ÇÜ„Å®„Çä„ÅÆ„Éó„É©„É≥„ÄÇ',
      halls:['yasuragi','forest'], priceType:'family', sizeTag:'„ÇÜ„Å®„Çä'
    });
  } else if(attendance === '15to30') {
    plans.push({
      id:'living', label:'small', name:'„ÇÑ„Åô„Çâ„Åé„É™„Éì„É≥„Ç∞Ëë¨', icon:'üè°',
      desc:'ÊúÄÂ§ß20Âêç„ÅÆ„É™„Éì„É≥„Ç∞Ëë¨„ÄÇ20Âêç„ÇíË∂Ö„Åà„ÇãÂ†¥Âêà„ÅØ‰ªñ„Éõ„Éº„É´„Å∏„ÅÆÂ§âÊõ¥„Çí„ÅîÊ§úË®é„Åè„Å†„Åï„ÅÑ„ÄÇ',
      halls:['living'], priceType:'living', sizeTag:'Â∞èË¶èÊ®°'
    });
    plans.push({
      id:'family', label:'rec', name:'ÂÆ∂ÊóèËë¨ÁöÑ„Å™„ÅäËë¨Âºè', icon:'üå∏',
      desc:'30ÂêçÁ®ãÂ∫¶„Åæ„ÅßÂØæÂøú„ÅÆÂÆ∂ÊóèËë¨ÁöÑ„Å™Âºè„ÄÇ„ÇÑ„Åô„Çâ„Åé‰ºöÈ§®„Éª„Éï„Ç©„É¨„Çπ„Éà„Éõ„Éº„É´„ÅßÊâø„Çä„Åæ„Åô„ÄÇ',
      halls:['yasuragi','forest'], priceType:'family', sizeTag:'Êé®Â•®'
    });
    plans.push({
      id:'normal', label:'large', name:'„Åµ„Å§„ÅÜ„ÅÆ„ÅäËë¨Âºè', icon:'üåø',
      desc:'‰∏ÄËà¨Ëë¨„Çπ„Çø„Ç§„É´„ÄÇÁü•‰∫∫„ÉªÂèã‰∫∫„ÅÆÊñπ„ÄÖ„ÇÇÂ∫É„Åè„ÅäÊãõ„Åç„Åß„Åç„ÇãÂÖÖÂÆü„ÅÆÂÜÖÂÆπ„ÄÇ',
      halls:['yasuragi','forest','shion'], priceType:'normal', sizeTag:'„ÇÜ„Å®„Çä'
    });
  } else if(attendance === '30to50') {
    plans.push({
      id:'family', label:'small', name:'ÂÆ∂ÊóèËë¨ÁöÑ„Å™„ÅäËë¨Âºè', icon:'üå∏',
      desc:'Ë≤ªÁî®„ÇíÊäë„Åà„Å™„Åå„Çâ„ÇÇ30„Äú50Âêç„Å´ÂØæÂøú„ÄÇ„Ç¢„ÉÉ„Éà„Éõ„Éº„É†„Å™Èõ∞Âõ≤Ê∞ó„Åß„ÅäË¶ãÈÄÅ„Çä„ÄÇ',
      halls:['yasuragi','forest','shion'], priceType:'family', sizeTag:'„Ç≥„É≥„Éë„ÇØ„Éà'
    });
    plans.push({
      id:'normal', label:'rec', name:'„Åµ„Å§„ÅÜ„ÅÆ„ÅäËë¨Âºè', icon:'üåø',
      desc:'50ÂêçË¶èÊ®°„Å´ÊúÄÈÅ©„Å™‰∏ÄËà¨Ëë¨„ÄÇÈÄöÂ§ú„ÉªÂëäÂà•Âºè„Çí„Åó„Å£„Åã„ÇäÂü∑„ÇäË°å„ÅÑ„Åæ„Åô„ÄÇ',
      halls:['yasuragi','forest','shion'], priceType:'normal', sizeTag:'Êé®Â•®'
    });
    plans.push({
      id:'grand', label:'large', name:'Á§æËë¨„ÉªÂ§ßÂûãËë¨', icon:'üèõÔ∏è',
      desc:'‰ºöÁ§æ„ÉªÂõ£‰ΩìÈñ¢‰øÇ„ÇÇÂ§ö„ÅÑÂ§ßË¶èÊ®°Ëë¨ÂÑÄ„ÄÇÂ∞Ç‰ªª„Çπ„Çø„ÉÉ„Éï„Åå‰∏áÂÖ®„ÅÆ‰ΩìÂà∂„Åß„Çµ„Éù„Éº„Éà„ÄÇ',
      halls:['yasuragi','forest'], priceType:'normal', sizeTag:'Â§ßË¶èÊ®°'
    });
  } else { // over50
    plans.push({
      id:'normal', label:'small', name:'„Åµ„Å§„ÅÜ„ÅÆ„ÅäËë¨Âºè', icon:'üåø',
      desc:'50„Äú100ÂêçË¶èÊ®°„ÅÆ‰∏ÄËà¨Ëë¨„ÄÇÂ§ßÂûã„Éõ„Éº„É´„ÅßÂ∫É„Åè„ÅäÊãõ„Åç„Åß„Åç„Åæ„Åô„ÄÇ',
      halls:['yasuragi','forest','shion'], priceType:'normal', sizeTag:'Ê®ôÊ∫ñ'
    });
    plans.push({
      id:'large', label:'rec', name:'Â§ßÂûã‰∏ÄËà¨Ëë¨', icon:'üèõÔ∏è',
      desc:'100Âêç‰ª•‰∏ä„ÅÆÂ§ßË¶èÊ®°Ëë¨ÂÑÄ„ÄÇÂú∞Âüü„ÅÆÊñπ„ÄÖ„Éª‰ºöÁ§æÈñ¢‰øÇËÄÖ„ÇÇÂê´„ÇÅ„ÅüÂ§ßË¶èÊ®°Ëë¨„ÄÇ',
      halls:['yasuragi','forest'], priceType:'normal', sizeTag:'Êé®Â•®'
    });
    plans.push({
      id:'corp', label:'large', name:'Á§æËë¨„ÉªÂõ£‰ΩìËë¨', icon:'üè¢',
      desc:'‰ºöÁ§æ„ÉªÂõ£‰Ωì‰∏ªÂÇ¨„ÅÆËë¨ÂÑÄ„ÄÇÂ∞Ç‰ªª„ÉÅ„Éº„É†„Åå‰ºÅÁîª„Åã„ÇâÈÅãÂñ∂„Åæ„ÅßÂÖ®Èù¢„Çµ„Éù„Éº„Éà„ÄÇ',
      halls:['yasuragi','forest'], priceType:'normal', sizeTag:'Â§ßË¶èÊ®°'
    });
  }
  // Áõ¥Ëë¨„ÉªÁÅ´Ëë¨Âºè„ÅÆÂ†¥Âêà„ÅØÂ∞ÇÁî®„Éó„É©„É≥„ÇíÂ∑Æ„ÅóËæº„ÇÄ
  if(funeralType === 'chokuso') {
    return [
      {
        id:'chokuso_standard', label:'rec', name:'Áõ¥Ëë¨„ÉªÁÅ´Ëë¨Âºè„Éó„É©„É≥', icon:'üïäÔ∏è',
        desc:'ÈÄöÂ§ú„ÉªÂëäÂà•Âºè„ÇíË°å„Çè„Åö„ÄÅÁÅ´Ëë¨Â†¥„Åß„ÅÆ„ÅäÂà•„Çå„ÅÆ„Åø„ÄÇ„Ç∑„É≥„Éó„É´„Å™„Åå„ÇâÂøÉ„ÅÆ„Åì„ÇÇ„Å£„Åü„ÅäË¶ãÈÄÅ„Çä„ÄÇ',
        halls:['ai_chokuso','tsutsuji','yasuura'], priceType:'chokuso', sizeTag:'Áõ¥Ëë¨',
        isSimplePlan: true
      },
      {
        id:'chokuso_with_farewell', label:'large', name:'Áõ¥Ëë¨Ôºã„ÅäÂà•„Çå„ÅÆÊôÇÈñì„ÅÇ„Çä', icon:'üå∏',
        desc:'ÁÅ´Ëë¨Ââç„Å´Â∞ë„Åó„Å†„Åë„ÅäÂà•„Çå„ÅÆÊôÇÈñì„ÇíË®≠„Åë„Çã„Éó„É©„É≥„ÄÇ„ÅîÂÆ∂Êóè„Åå„ÇÜ„Å£„Åè„Çä„ÅäË¶ãÈÄÅ„Çä„Åß„Åç„Åæ„Åô„ÄÇ',
        halls:['ai_chokuso','tsutsuji','living'], priceType:'chokuso', sizeTag:'Áõ¥Ëë¨+„ÅäÂà•„Çå',
        isSimplePlan: true
      }
    ];
  }
  if(funeralType === 'kasouonly') {
    return [
      {
        id:'kasou_only', label:'rec', name:'ÁÅ´Ëë¨„ÅÆ„Åø„Éó„É©„É≥', icon:'‚õ©Ô∏è',
        desc:'ÊúÄ„ÇÇ„Ç∑„É≥„Éó„É´„Å™ÂΩ¢Âºè„ÄÇ„ÅîÈÅ∫‰Ωì„ÅÆÊê¨ÈÄÅ„ÉªÂÆâÁΩÆ„ÉªÁÅ´Ëë¨„ÅÆ„Åø„ÇíË°å„ÅÑ„Åæ„Åô„ÄÇË≤ªÁî®„ÇíÊúÄÂ∞èÈôê„Å´Êäë„Åà„Åü„ÅÑÊñπ„Å´„ÄÇ',
        halls:['ai_chokuso','tsutsuji','yasuura'], priceType:'kasou', sizeTag:'ÁÅ´Ëë¨„ÅÆ„Åø',
        isSimplePlan: true
      }
    ];
  }
  return plans;
}

// „Éõ„Éº„É´„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
function getRecommendedHalls(attendance, funeralType, selectedPlan) {
  const allHallIds = ['tsutsuji','yasuura','living','yasuragi','forest','shion'];
  
  if(!selectedPlan) return allHallIds;
  
  // ÈÅ∏Êäû„Åó„Åü„Éó„É©„É≥„ÅÆÂØæÂøú„Éõ„Éº„É´„ÇíÂÑ™ÂÖà
  const planHalls = selectedPlan.halls || allHallIds;
  
  // ËøΩÂä†„ÅßË°®Á§∫„Åô„ÇãÂèØËÉΩÊÄß„ÅÆ„ÅÇ„Çã„Éõ„Éº„É´
  let recommended = [...planHalls];
  let others = allHallIds.filter(h => !recommended.includes(h));
  
  return { recommended, others };
}

// ========== Áä∂ÊÖãÁÆ°ÁêÜ ==========
let state = {
  currentStep: 1,
  moshuName: '', deceasedName: '', relation: '', phone: '',
  attendance: '', funeralType: '',
  selectedPlan: null, selectedHall: null, selectedCourse: null,
  wishes: '', concerns: '', chatLog: [], isMember: null,
  showingAllHalls: false,
  // ÂÆóÊïô„ÉªËè©ÊèêÂØ∫Èñ¢ÈÄ£
  religion: '', templeInfo: ''
};

// ========== FAQ „Çà„Åè„ÅÇ„ÇãË≥™Âïè ==========

// FAQÂõûÁ≠î„Éá„Éº„Çø„Éô„Éº„Çπ
const FAQ_ANSWERS = {
  'Ë≤ªÁî®„Å´„Å§„ÅÑ„Å¶Êïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ': {
    badge: 'üí∞ Ë≤ªÁî®',
    text: `„Åï„ÅÑ„ÅçËë¨Á•≠„Åß„ÅØ„ÄÅËë¨ÂÑÄË≤ªÁî®„ÅØÂ§ß„Åç„Åè3„Å§„Å´ÂàÜ„Åã„Çå„Åæ„Åô„ÄÇ\n\n‚ë† <strong>Âü∫Êú¨Ëë¨ÂÑÄ„Çª„ÉÉ„Éà</strong>ÔºàÁ•≠Â£á„ÉªÊ£∫„ÉªÊê¨ÈÄÅ„ÉªÈÅ∫ÂΩ±„Å™„Å©Ôºâ\n‚ë° <strong>„Åä„ÇÇ„Å¶„Å™„ÅóË≤ªÁî®</strong>Ôºà‰ºöËë¨Âæ°Á§ºÂìÅ„ÉªÈ£ü‰∫ã„Éª‰ºöÈ§®‰ΩøÁî®Êñô„Å™„Å©Ôºâ\n‚ë¢ <strong>„Çà„Åè„ÅÇ„Çã„Ç™„Éó„Ç∑„Éß„É≥</strong>ÔºàÁîüËä±„ÉªÊñôÁêÜ„ÉªÂ∏ÇÁ≠â„ÅÆ„ÅîÂ∏åÊúõÔºâ\n\n<strong>ÊòéÊúó‰ºöË®à</strong>„ÅÆ„ÅäÁ¥ÑÊùü„Å®„Åó„Å¶„ÄÅ‰∫ãÂâç„ÅäË¶ãÁ©ç„ÇÇ„Çä‰ª•Â§ñ„ÅÆËøΩÂä†Ë´ãÊ±Ç„ÅØ‰∏ÄÂàá„Åî„Åñ„ÅÑ„Åæ„Åõ„Çì„ÄÇ`
  },
  'ËøΩÂä†Ë≤ªÁî®„ÅØ„Åã„Åã„Çä„Åæ„Åô„ÅãÔºü': {
    badge: 'üí∞ Ë≤ªÁî®',
    text: `‰∫ãÂâç„Å´„ÅäË¶ãÁ©ç„ÇÇ„Çä„Åó„ÅüÈáëÈ°ç‰ª•Â§ñ„ÅÆËøΩÂä†Ë´ãÊ±Ç„ÅØ‰∏ÄÂàá„Åî„Åñ„ÅÑ„Åæ„Åõ„Çì üôè\n\n‰∫∫Êï∞Â¢óÊ∏õ„Å™„Å©Â§âÊõ¥„ÅåÁîü„Åò„ÅüÂ†¥Âêà„ÅØ„ÄÅÂøÖ„Åö„ÅîÂñ™‰∏ªÊßò„Å´„ÅîÁ¢∫Ë™ç„ÅÆ‰∏ä„ÅßÂØæÂøú„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ„ÅîÂÆâÂøÉ„Åè„Å†„Åï„ÅÑ„ÄÇ`
  },
  'ÂàÜÂâ≤Êâï„ÅÑ„ÅØÂèØËÉΩ„Åß„Åô„ÅãÔºü': {
    badge: 'üí∞ „ÅäÊîØÊâï„ÅÑ',
    text: `„ÅØ„ÅÑ„ÄÅÂêÑÁ®Æ„ÅäÊîØÊâï„ÅÑÊñπÊ≥ï„Çí„ÅîÁî®ÊÑè„Åó„Å¶„Åä„Çä„Åæ„Åô„ÄÇ\n\n„ÉªÁèæÈáëÊâï„ÅÑ\n„Éª„ÇØ„É¨„Ç∏„ÉÉ„Éà„Ç´„Éº„ÉâÊâï„ÅÑ\n„Éª„É≠„Éº„É≥„ÉªÂàÜÂâ≤Êâï„ÅÑÔºà„ÅîÁõ∏Ë´á„Åè„Å†„Åï„ÅÑÔºâ\n\nË©≥Á¥∞„ÅØÊãÖÂΩìËÄÖ„Å´„ÅäÊ∞óËªΩ„Å´„ÅîÁõ∏Ë´á„Åè„Å†„Åï„ÅÑ üòä`
  },
  '‰ºöÂì°Ââ≤Âºï„ÅÆË©≥Á¥∞„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ': {
    badge: 'üí≥ ‰ºöÂì°',
    text: `„ÇÑ„Åô„Çâ„Åé‰ºöÂì°„Å´„ÅîÂÖ•‰ºö„ÅÑ„Åü„Å†„Åè„Å®„ÄÅËë¨ÂÑÄË≤ªÁî®„Åå<strong>35%Ââ≤Âºï</strong>„Å®„Å™„Çä„Åæ„Åô„ÄÇ\n\nÂΩìÊó•„ÅîÂÖ•‰ºö„ÅÆÂ†¥Âêà„Åß„ÇÇ<strong>30%Ââ≤Âºï</strong>„ÅåÈÅ©Áî®„Åï„Çå„Åæ„Åô„ÄÇ\n\nË©≥Á¥∞„ÅØÊãÖÂΩìËÄÖ„Åæ„Åß„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ\nüìû 0120-315-312`
  },
  'Ëë¨Á•≠Ë≤ªË£úÂä©Èáë„ÉªÈ¶ôÂÖ∏Ëøî„Åó„Å´„Å§„ÅÑ„Å¶': {
    badge: 'üí∞ Ë£úÂä©Èáë',
    text: `ÂõΩÊ∞ëÂÅ•Â∫∑‰øùÈô∫„ÉªÂæåÊúüÈ´òÈΩ¢ËÄÖÂåªÁôÇ‰øùÈô∫„ÅÆË¢´‰øùÈô∫ËÄÖ„Åå‰∫°„Åè„Å™„Çâ„Çå„ÅüÂ†¥Âêà„ÄÅ<strong>Ëë¨Á•≠Ë≤ªÔºàË£úÂä©ÈáëÔºâ</strong>„ÅåÂ∏ÇÂå∫Áî∫Êùë„Åã„ÇâÊîØÁµ¶„Åï„Çå„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„ÅôÔºàÁõÆÂÆâÔºö3„Äú7‰∏áÂÜÜÔºâ„ÄÇ\n\nÊâãÁ∂ö„Åç„ÅØÊãÖÂΩìËÄÖ„Åå„Çµ„Éù„Éº„Éà„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇÈ¶ôÂÖ∏Ëøî„Åó„ÅÆ„ÅîÁõ∏Ë´á„ÇÇÊâø„Å£„Å¶„Åä„Çä„Åæ„Åô„ÄÇ`
  },
  'Ëë¨Âºè„ÅÆÊµÅ„Çå„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ': {
    badge: 'üìã ÊµÅ„Çå',
    text: `‰∏ÄËà¨ÁöÑ„Å™Ëë¨ÂÑÄ„ÅÆÊµÅ„Çå„Åß„ÅôÔºö\n\n1Ô∏è‚É£ „ÅîÈÄùÂéª„Éª„ÅîÈÄ£Áµ°Ôºà24ÊôÇÈñìÂèó‰ªòÔºâ\n2Ô∏è‚É£ Êê¨ÈÄÅ„ÉªÂÆâÁΩÆ\n3Ô∏è‚É£ Êâì„Å°Âêà„Çè„Åõ„Éª„ÅäË¶ãÁ©ç„ÇÇ„Çä\n4Ô∏è‚É£ ÈÄöÂ§úÂºè\n5Ô∏è‚É£ ÂëäÂà•Âºè„ÉªÂá∫Ê£∫\n6Ô∏è‚É£ ÁÅ´Ëë¨„ÉªÈ™®‰∏ä„Åí\n7Ô∏è‚É£ Âàù‰∏ÉÊó•Ê≥ïË¶Å\n\nÊãÖÂΩìËÄÖ„ÅåÂÖ®„Å¶„ÅÆÊµÅ„Çå„Çí„Çµ„Éù„Éº„Éà„ÅÑ„Åü„Åó„Åæ„Åô üôè`
  },
  'Ê≠ª‰∫°Âæå„ÅÆÂΩπÊâÄÊâãÁ∂ö„Åç„ÅØÔºü': {
    badge: 'üìã ÊâãÁ∂ö„Åç',
    text: `‰∏ª„Å™ÂΩπÊâÄÊâãÁ∂ö„Åç„ÅØ‰ª•‰∏ã„ÅÆÈÄö„Çä„Åß„ÅôÔºö\n\n„Éª<strong>Ê≠ª‰∫°Â±ä„ÅÆÊèêÂá∫</strong>Ôºà7Êó•‰ª•ÂÜÖÔºâ\n„ÉªÁÅ´Ëë¨Ë®±ÂèØË®º„ÅÆÂèñÂæó\n„ÉªÂÅ•Â∫∑‰øùÈô∫„ÉªÂπ¥Èáë„ÅÆË≥áÊ†ºÂñ™Â§±Â±ä\n„Éª‰∏ñÂ∏Ø‰∏ªÂ§âÊõ¥Â±äÔºàÂøÖË¶Å„Å™Â†¥ÂêàÔºâ\n\n„Åï„ÅÑ„ÅçËë¨Á•≠„Åß„ÅØ<strong>ÂΩπÊâÄÊâãÁ∂ö„Åç‰ª£Ë°å</strong>„ÇÇÊâø„Å£„Å¶„Åä„Çä„Åæ„Åô„ÄÇ„ÅäÊ∞óËªΩ„Å´„ÅîÁõ∏Ë´á„Åè„Å†„Åï„ÅÑ„ÄÇ`
  },
  'Ê≠ª‰∫°Ë®∫Êñ≠Êõ∏„Å´„Å§„ÅÑ„Å¶Êïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ': {
    badge: 'üìã Êõ∏È°û',
    text: `Ê≠ª‰∫°Ë®∫Êñ≠Êõ∏„ÅØ„ÄÅÂåªÂ∏´„ÅåÁô∫Ë°å„Åô„ÇãÂÖ¨ÂºèÊõ∏È°û„Åß„Åô„ÄÇ\n\n„ÉªÁóÖÈô¢„Åß‰∫°„Åè„Å™„Å£„ÅüÂ†¥ÂêàÔºöÊãÖÂΩìÂåª„ÅåÁô∫Ë°å\n„ÉªËá™ÂÆÖ„Åß‰∫°„Åè„Å™„Å£„ÅüÂ†¥ÂêàÔºö„Åã„Åã„Çä„Å§„ÅëÂåª„Åæ„Åü„ÅØÊïëÊÄ•Âåª„ÅåÁô∫Ë°å\n\nÊ≠ª‰∫°Â±ä„ÅÆÊèêÂá∫„Å´ÂøÖË¶Å„Å®„Å™„Çä„Åæ„Åô„ÄÇÊãÖÂΩìËÄÖ„Åå„ÅîÊ°àÂÜÖ„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ`
  },
  'ÈÄ£Áµ°„Åô„ÇãÁØÑÂõ≤„ÅØÔºü': {
    badge: 'üìã ÈÄ£Áµ°',
    text: `„ÅîÈÄùÂéªÂæå„ÅÆÈÄ£Áµ°È†ÜÂ∫è„ÅÆÁõÆÂÆâ„Åß„ÅôÔºö\n\n1Ô∏è‚É£ Áõ¥Á≥ªÂÆ∂Êóè„ÉªËøëË¶™ËÄÖ\n2Ô∏è‚É£ Ë¶™Êóè„ÉªÂÖÑÂºüÂßâÂ¶π\n3Ô∏è‚É£ ÊïÖ‰∫∫„ÅÆÂèã‰∫∫„ÉªÁü•‰∫∫ÔºàÂÆ∂ÊóèËë¨„ÅÆÂ†¥Âêà„ÅØ‰ªªÊÑèÔºâ\n4Ô∏è‚É£ ËÅ∑Â†¥„Éª‰ºöÁ§æÈñ¢‰øÇÔºàÂøÖË¶Å„Å´Âøú„Åò„Å¶Ôºâ\n\nÂÆ∂ÊóèËë¨„ÅÆÂ†¥Âêà„ÅØ„ÄÅËë¨ÂÑÄÂæå„Å´„ÅîÈÄ£Áµ°„Åô„Çã„Ç±„Éº„Çπ„ÇÇÂ§ö„Åè„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ`
  },
  'ÈÄöÂ§ú„ÉªÂëäÂà•Âºè„ÅÆÈÅï„ÅÑ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ': {
    badge: 'üìã ÂºèÊ¨°Á¨¨',
    text: `<strong>ÈÄöÂ§ú</strong>Ôºö„ÅîÈÄùÂéªÁøåÊó•„ÅÆÂ§ïÊñπ„Å´Ë°å„ÅÜÂÑÄÂºè„ÄÇÊïÖ‰∫∫„Å®ÊúÄÂæå„ÅÆÂ§ú„Çí„Å®„ÇÇ„Å´„Åô„ÇãÊôÇÈñì„Åß„Åô„ÄÇ\n\n<strong>ÂëäÂà•ÂºèÔºàËë¨ÂÑÄÔºâ</strong>ÔºöÁøåÊó•„ÅÆÂçàÂâç‰∏≠„Å´Ë°å„ÅÜÊú¨Âºè„ÄÇÂèÇÂàóËÄÖ„ÅåÊúÄÂæå„ÅÆ„ÅäÂà•„Çå„Çí„Åô„ÇãÂºèÂÖ∏„Åß„Åô„ÄÇ\n\nÂÆ∂ÊóèËë¨„Åß„ÅØÈÄöÂ§ú„ÇíÁúÅÁï•„Åó„Åü„Äå‰∏ÄÊó•Ëë¨„Äç„ÇÇ‰∫∫Ê∞ó„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ`
  },
  '„ÅäÂ∏ÉÊñΩ„ÅÆÁõÆÂÆâ„ÅØÔºü': {
    badge: 'üè∑Ô∏è „ÅäÂ∏ÉÊñΩ',
    text: `„ÅäÂ∏ÉÊñΩ„ÅØÂÆóÊó®„ÉªÂÆóÊ¥æ„ÉªÂú∞Âüü„Å´„Çà„Å£„Å¶Áï∞„Å™„Çä„Åæ„Åô„ÄÇ‰∏ÄËà¨ÁöÑ„Å™ÁõÆÂÆâ„ÅØ‰ª•‰∏ã„ÅÆÈÄö„Çä„Åß„ÅôÔºö\n\n„Éª‰ªèÂºèÔºö10„Äú30‰∏áÂÜÜÁ®ãÂ∫¶\n„ÉªÁ•ûÂºèÔºö10„Äú30‰∏áÂÜÜÁ®ãÂ∫¶\n„Éª„Ç≠„É™„Çπ„ÉàÊïôÔºö5„Äú20‰∏áÂÜÜÁ®ãÂ∫¶\n\n‚Äª„ÅäÂ∏ÉÊñΩ„ÅØ„Äå„ÅäÊ∞óÊåÅ„Å°„Äç„Åß„Åô„ÅÆ„Åß„ÄÅË©≥„Åó„Åè„ÅØËè©ÊèêÂØ∫„ÇÑÊãÖÂΩìËÄÖ„Å´„ÅîÁõ∏Ë´á„Åè„Å†„Åï„ÅÑ„ÄÇ`
  },
  'ÁÑ°ÂÆóÊïô„ÉªÁÑ°ÂÆóÊ¥æ„Åß„ÇÇ„Åß„Åç„Åæ„Åô„ÅãÔºü': {
    badge: 'üè∑Ô∏è ÂÆóÊïô',
    text: `„ÅØ„ÅÑ„ÄÅ„ÇÇ„Å°„Çç„ÇìÂØæÂøú„Åó„Å¶„Åä„Çä„Åæ„Åô üòä\n\nÁÑ°ÂÆóÊïô„ÅÆ„ÄåËá™Áî±Ëë¨„Äç„ÇÑ„ÄåÈü≥Ê•ΩËë¨„Äç„Å™„Å©„ÇÇÊâø„Å£„Å¶„Åä„Çä„Åæ„Åô„ÄÇÊïÖ‰∫∫Êßò„ÅÆÁîüÂâç„ÅÆ„ÅîÊÑèÂêë„ÇÑ„ÄÅ„ÅîÂÆ∂ÊóèÊßò„ÅÆ„ÅîÂ∏åÊúõ„Å´Âêà„Çè„Åõ„Å¶„Ç™„É™„Ç∏„Éä„É´„ÅÆ„ÅäÂà•„Çå„ÅÆÂºè„Çí„ÅîÊèêÊ°à„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ`
  },
  '‰ªñÂÆóÊ¥æ„Åß„ÇÇÂØæÂøú„Åß„Åç„Åæ„Åô„ÅãÔºü': {
    badge: 'üè∑Ô∏è ÂÆóÊ¥æ',
    text: `„ÅØ„ÅÑ„ÄÅÂêÑÂÆóÊ¥æ„ÉªÂÆóÊïô„Å´ÂØæÂøú„Åó„Å¶„Åä„Çä„Åæ„Åô„ÄÇ\n\n„Éª‰ªèÂºèÔºàÊµÑÂúüÂÆó„ÉªÊµÑÂúüÁúüÂÆó„ÉªËá®Ê∏àÂÆó„ÉªÊõπÊ¥ûÂÆó„Å™„Å©Ôºâ\n„ÉªÁ•ûÂºè\n„Éª„Ç≠„É™„Çπ„ÉàÊïôÔºà„Ç´„Éà„É™„ÉÉ„ÇØ„Éª„Éó„É≠„ÉÜ„Çπ„Çø„É≥„ÉàÔºâ\n„Éª„Åù„ÅÆ‰ªñÂÆóÊïô\n\nËè©ÊèêÂØ∫„Åå„Å™„ÅÑÂ†¥Âêà„ÇÇ„ÄÅÊèêÊê∫„ÅÆÂØ∫Èô¢„Çí„ÅîÁ¥π‰ªã„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ`
  },
  '„ÅØ„Å™Á≠í„ÉªÁßòÂå£„ÅÆÈÅï„ÅÑ„ÅØÔºü': {
    badge: 'üè∑Ô∏è È™®Â£∑',
    text: `<strong>„ÅØ„Å™Á≠í</strong>ÔºöËä±„Çí„É¢„ÉÅ„Éº„Éï„Å´„Åó„Åü„Éá„Ç∂„Ç§„É≥„ÅÆÈ™®Â£∑„ÄÇËèØ„ÇÑ„Åã„ÅßÊ∏©„Åã„Åø„ÅÆ„ÅÇ„ÇãÂç∞Ë±°„Åß„Åô„ÄÇ\n\n<strong>ÁßòÂå£Ôºà„Å≤„ÅîÔºâ</strong>Ôºö‰ºùÁµ±ÁöÑ„Å™„Éá„Ç∂„Ç§„É≥„ÅÆÈ™®Â£∑„ÄÇÊ†ºÂºè„Åå„ÅÇ„ÇäËêΩ„Å°ÁùÄ„ÅÑ„ÅüÂç∞Ë±°„Åß„Åô„ÄÇ\n\n„Å©„Å°„Çâ„ÇÇÊïÖ‰∫∫„ÇíÂÅ≤„Å∂Â§ßÂàá„Å™Âô®„Åß„Åô„ÄÇÊãÖÂΩìËÄÖ„Åå„ÅîË™¨Êòé„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ`
  },
  'Â∞è„Åï„Å™Â≠ê„Å©„ÇÇ„ÇÇÂèÇÂàó„Åß„Åç„Åæ„Åô„ÅãÔºü': {
    badge: 'üë∂ „ÅäÂ≠êÊßò',
    text: `„ÅØ„ÅÑ„ÄÅ„ÇÇ„Å°„Çç„Çì„Åß„Åô üòä\n\nÂ∞è„Åï„Å™„ÅäÂ≠êÊßò„Åß„ÇÇÂÆâÂøÉ„Åó„Å¶„ÅîÂèÇÂàó„ÅÑ„Åü„Å†„Åë„Åæ„Åô„ÄÇÂêÑ„Éõ„Éº„É´„Å´„ÅØ<strong>„Ç≠„ÉÉ„Ç∫„Çπ„Éö„Éº„Çπ</strong>„ÇíÂÆåÂÇô„Åó„Å¶„Åä„Çä„ÄÅ„ÅäÂ≠êÊßò„ÅåÂÆâÂøÉ„Åó„Å¶ÈÅé„Åî„Åõ„ÇãÁí∞Â¢É„ÇíÊï¥„Åà„Å¶„Åä„Çä„Åæ„Åô„ÄÇ`
  },
  '„Ç≠„ÉÉ„Ç∫„Çπ„Éö„Éº„Çπ„ÅØ„ÅÇ„Çä„Åæ„Åô„ÅãÔºü': {
    badge: 'üë∂ Ë®≠ÂÇô',
    text: `„ÅØ„ÅÑ„ÄÅ‰ª•‰∏ã„ÅÆ„Éõ„Éº„É´„Å´„Ç≠„ÉÉ„Ç∫„Çπ„Éö„Éº„Çπ„ÇíÂÆåÂÇô„Åó„Å¶„Åä„Çä„Åæ„ÅôÔºö\n\nüèõÔ∏è „ÇÑ„Åô„Çâ„Åé‰ºöÈ§®\nüå≤ „Éï„Ç©„É¨„Çπ„Éà„Éõ„Éº„É´\nüå∫ „Ç¢„Ç§„Éï„Ç£„ÉÉ„Éà„Éõ„Éº„É´„Å§„Å§„Åò\n\n„ÅäÂ≠êÊßòÈÄ£„Çå„ÅÆ„ÅîÂÆ∂Êóè„ÇÇÂÆâÂøÉ„Åó„Å¶„ÅîÂèÇÂàó„ÅÑ„Åü„Å†„Åë„Åæ„Åô„ÄÇ`
  },
  'Êéà‰π≥ÂÆ§„Éª„Åä„ÇÄ„Å§‰∫§Êèõ„ÅØ„Åß„Åç„Åæ„Åô„ÅãÔºü': {
    badge: 'üë∂ Êéà‰π≥ÂÆ§',
    text: `Êéà‰π≥„Çπ„Éö„Éº„Çπ„ÇÑ„Åä„ÇÄ„Å§‰∫§ÊèõÂè∞„Çí„ÅîÁî®ÊÑè„Åó„Å¶„Åä„Çä„Åæ„Åô„ÄÇ\n\n‰∫ãÂâç„Å´„ÅäÁî≥„Åó‰ªò„Åë„ÅÑ„Åü„Å†„Åë„Çå„Å∞„ÄÅ„Çπ„Çø„ÉÉ„Éï„ÅåÂØæÂøú„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ„ÅäÊ∞óËªΩ„Å´„ÅäÁî≥„Åó‰ªò„Åë„Åè„Å†„Åï„ÅÑ üòä`
  },
  '„ÅäËä±„Çí„Åü„Åè„Åï„ÇìÈ£æ„Çä„Åü„ÅÑ„Åß„Åô': {
    badge: 'üå∏ ÊºîÂá∫',
    text: `„ÇÇ„Å°„Çç„Çì„ÅîÂØæÂøú„Åß„Åç„Åæ„Åô üå∏\n\n„ÄåËä±„Ç≥„Éº„Çπ„Äç„ÄåÈ¶ô„Ç≥„Éº„Çπ„Äç„ÄåËºù„Ç≥„Éº„Çπ„Äç„Åß„ÅØ„ÅäËä±„ÇíË±™ËèØ„Å´„ÅÇ„Åó„Çâ„Å£„ÅüÁ•≠Â£á„Çí„ÅîÁî®ÊÑè„Åó„Å¶„Åä„Çä„Åæ„Åô„ÄÇ\n\n„Åæ„Åü„ÄÅ„Éï„É©„ÉØ„Éº„Ç¢„É¨„É≥„Ç∏„É°„É≥„Éà„ÅÆËøΩÂä†„ÇÑÊ£∫„ÅÆ‰∏≠„Å´„ÅäËä±„Çí„ÅÑ„Å£„Å±„ÅÑÂÖ•„Çå„Çã„ÄåËä±„ÅÑ„Å£„Å±„ÅÑËë¨„Äç„ÇÇÊâø„Å£„Å¶„Åä„Çä„Åæ„Åô„ÄÇÊãÖÂΩìËÄÖ„Å´„ÅîÁõ∏Ë´á„Åè„Å†„Åï„ÅÑ„ÄÇ`
  },
  'Èü≥Ê•Ω„ÇÑÊò†ÂÉè„ÇíÊµÅ„Åó„Åü„ÅÑ„Åß„Åô': {
    badge: 'üéµ ÊºîÂá∫',
    text: `„ÅØ„ÅÑ„ÄÅÊâø„Å£„Å¶„Åä„Çä„Åæ„Åô üéµ\n\n„ÉªÊïÖ‰∫∫Êßò„ÅÆ„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆÈü≥Ê•Ω„ÇíÂºè‰∏≠„Å´ÊµÅ„Åô\n„ÉªÊÄù„ÅÑÂá∫„ÅÆÂÜôÁúü„ÉªÊò†ÂÉè„Çí„Çπ„É©„Ç§„Éâ„Ç∑„Éß„Éº„Åß‰∏äÊò†„Åô„Çã\n„Éª„É°„É¢„É™„Ç¢„É´DVD„ÅÆÂà∂‰Ωú\n\n„ÅÑ„Åö„Çå„ÇÇÂØæÂøúÂèØËÉΩ„Åß„Åô„ÄÇË©≥Á¥∞„ÅØÊãÖÂΩìËÄÖ„Å´„ÅîÁõ∏Ë´á„Åè„Å†„Åï„ÅÑ„ÄÇ`
  },
  '„Éö„ÉÉ„Éà„ÇÇ‰∏ÄÁ∑í„Å´„ÅäÂà•„Çå„Åó„Åü„ÅÑ„Åß„Åô': {
    badge: 'üêæ „Éö„ÉÉ„Éà',
    text: `ÊïÖ‰∫∫Êßò„Å®ÊÑõ„Åô„Çã„Éö„ÉÉ„Éà„ÅÆ„ÅäÂà•„Çå„Å´„Å§„ÅÑ„Å¶„ÇÇÊâø„Å£„Å¶„Åä„Çä„Åæ„Åô üêæ\n\n„Éö„ÉÉ„Éà„ÇíÈÄ£„Çå„Å¶„ÅÆÂèÇÂàó„ÇÑ„ÄÅÊ£∫„Å´„Éö„ÉÉ„Éà„ÅÆÂÜôÁúü„ÇÑÈ¶ñËº™„ÇíÂÖ•„Çå„Çã„Åì„Å®„ÇÇÂèØËÉΩ„Åß„Åô„ÄÇ„ÅîÂ∏åÊúõ„ÅÆÂÜÖÂÆπ„Çí„ÅäÊ∞óËªΩ„Å´„ÅîÁõ∏Ë´á„Åè„Å†„Åï„ÅÑ„ÄÇ`
  },
  'ÂÜôÁúüÂÖ•„Çä„ÅÆ‰ΩçÁâå„Çí‰Ωú„Çä„Åü„ÅÑ„Åß„Åô': {
    badge: 'üéã ‰ΩçÁâå',
    text: `„ÅØ„ÅÑ„ÄÅÂØæÂøú„Åó„Å¶„Åä„Çä„Åæ„Åô üì∏\n\nÊïÖ‰∫∫Êßò„ÅÆ„ÅäÂÜôÁúüÂÖ•„Çä„ÅÆ‰ΩçÁâå„ÇÑ„ÄÅ„É°„É¢„É™„Ç¢„É´„Éë„Éç„É´„ÅÆ„ÅîÁî®ÊÑè„ÇÇÊâø„Å£„Å¶„Åä„Çä„Åæ„Åô„ÄÇ\n\n„ÄåÈ¶ô„Ç≥„Éº„Çπ„Äç„ÄåËºù„Ç≥„Éº„Çπ„Äç„Å´„ÅØ„É°„É¢„É™„Ç¢„É´„Éë„Éç„É´„ÅåÊ®ôÊ∫ñ„ÅßÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ`
  },
  'ÊÑüÊüìÁóá„Åß‰∫°„Åè„Å™„Å£„ÅüÂ†¥Âêà„ÅÆÂØæÂøú„ÅØÔºü': {
    badge: 'üò∑ ÊÑüÊüìÁóá',
    text: `ÊÑüÊüìÁóá„Åß„Åä‰∫°„Åè„Å™„Çä„Å´„Å™„Å£„ÅüÂ†¥Âêà„ÇÇ„ÄÅÂÆâÂøÉ„Åó„Å¶„ÅîÁõ∏Ë´á„Åè„Å†„Åï„ÅÑ„ÄÇ\n\n„ÉªÂ∞ÇÈñÄ„Çπ„Çø„ÉÉ„Éï„Å´„Çà„ÇãÈÅ©Âàá„Å™Âá¶ÁΩÆ\n„ÉªÊÑüÊüìÂØæÁ≠ñ„ÇíÊñΩ„Åó„ÅüÂÆâÁΩÆ„ÉªÊê¨ÈÄÅ\n„ÉªÂèÇÂàóËÄÖ„Å∏„ÅÆÊÑüÊüìÂØæÁ≠ñÔºàÊ∂àÊØí„Éª„Éû„Çπ„ÇØ„ÉªÊèõÊ∞óÁ≠âÔºâ\n\n„ÅîÈÅ∫Êóè„ÅÆÂÆâÂÖ®„ÇíÊúÄÂÑ™ÂÖà„Å´„ÄÅ‰∏ÅÂØß„Å´ÂØæÂøú„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇüìû 0120-315-312`
  },
  'ÂèÇÂàóËÄÖÊï∞„ÇíÂà∂Èôê„Åó„Åü„ÅÑÂ†¥Âêà„ÅØÔºü': {
    badge: 'üò∑ Âà∂Èôê',
    text: `ÂèÇÂàóËÄÖ„ÇíÈôêÂÆö„Åó„Åü„ÅÑÂ†¥Âêà„ÇÇÂØæÂøú„Åó„Å¶„Åä„Çä„Åæ„Åô„ÄÇ\n\n„Éª<strong>ÂÆ∂ÊóèËë¨„Éª1Êó•Ëë¨</strong>„ÅßÂ∞ë‰∫∫Êï∞„ÅÆ„ÅäË¶ãÈÄÅ„Çä\n„ÉªÂÖ•Â†¥‰∫∫Êï∞„ÅÆÂà∂Èôê„ÉªÊôÇÈñìÂàÜÊï£\n„Éª„Ç™„É≥„É©„Ç§„É≥ÂèÇÂàóÔºà„É™„É¢„Éº„ÉàËë¨Ôºâ„ÅÆ„ÅîÊ°àÂÜÖ\n\n„ÅîÂ∏åÊúõ„Å´Âêà„Çè„Åõ„Å¶ÊüîËªü„Å´ÂØæÂøú„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ`
  }
};

// FAQ‰ΩøÁî®Ê∏à„Åø„Çª„ÉÉ„Éà
const faqUsedSet = new Set();

// FAQ„Éë„Éç„É´ÈñãÈñâ
function toggleFaq() {
  const body = document.getElementById('faqBody');
  const icon = document.getElementById('faqToggleIcon');
  const isOpen = body.classList.contains('open');
  if (isOpen) {
    body.classList.remove('open');
    icon.classList.remove('open');
  } else {
    body.classList.add('open');
    icon.classList.add('open');
  }
}

// FAQ„Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ
function faqClick(btn, question) {
  if (btn.classList.contains('used')) return; // Êó¢„Å´‰ΩøÁî®Ê∏à„Åø

  // ‰ΩøÁî®Ê∏à„Åø„Å´„Åô„Çã
  btn.classList.add('used');
  btn.innerHTML = '<span class="faq-icon">‚úÖ</span>' + btn.textContent.trim();
  faqUsedSet.add(question);

  // ‰ΩøÁî®‰ª∂Êï∞„Éê„ÉÉ„Ç∏Êõ¥Êñ∞
  const badge = document.getElementById('faqUsedCount');
  badge.style.display = 'inline-block';
  badge.textContent = faqUsedSet.size + '‰ª∂Áô∫Ë®ÄÊ∏à';

  // „ÉÅ„É£„ÉÉ„ÉàÁîªÈù¢„ÅåÈñã„ÅÑ„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÇÇ„ÉÅ„É£„ÉÉ„Éà„Å´ÈÄÅ„Çã
  // FAQ„Éë„Éç„É´„Çí‰∏ÄÂ∫¶Èñâ„Åò„Çã
  const body = document.getElementById('faqBody');
  const icon = document.getElementById('faqToggleIcon');
  body.classList.remove('open');
  icon.classList.remove('open');

  // „ÉÅ„É£„ÉÉ„Éà„Å´„É¶„Éº„Ç∂„Éº„É°„ÉÉ„Çª„Éº„Ç∏„Å®„Åó„Å¶ÈÄÅ„Çã
  sendFaqToChat(question);
}

// FAQ„Çí„ÉÅ„É£„ÉÉ„Éà„Å´ÈÄÅ‰ø°
function sendFaqToChat(question) {
  if (chatState.isDone) {
    // „ÉÅ„É£„ÉÉ„ÉàÂÆå‰∫ÜÂæå„Åß„ÇÇËøΩË®ò
    addUserMsg(question);
    chatState.log.push({ role: 'user', msg: question });
    state.chatLog = chatState.log.slice();
    // FAQÂõûÁ≠î„ÇíË°®Á§∫
    setTimeout(() => showFaqAnswer(question), 700);
    return;
  }

  // „ÉÅ„É£„ÉÉ„ÉàÂÖ•Âäõ‰∏≠Êñ≠„Åó„Å¶FAQÈÄÅ‰ø°
  const input = document.getElementById('chatInput');
  if(input) input.value = '';
  document.getElementById('quickReplies').style.display = 'none';
  document.getElementById('quickReplies').innerHTML = '';

  addUserMsg(question);
  chatState.log.push({ role: 'user', msg: question });
  state.chatLog = chatState.log.slice();

  // FAQÂ∞ÇÁî®ÂõûÁ≠î„ÇíËøî„Åô
  setTimeout(() => showFaqAnswer(question), 700);
}

// FAQÂ∞ÇÁî®ÂõûÁ≠î„Éê„Éñ„É´„ÇíË°®Á§∫
function showFaqAnswer(question) {
  const msgs = document.getElementById('chatMessages');
  const answer = FAQ_ANSWERS[question];

  // „Çø„Ç§„Éî„É≥„Ç∞Ë°®Á§∫
  const typing = document.createElement('div');
  typing.className = 'chat-msg bot';
  typing.id = 'faqTypingMsg';
  typing.innerHTML = `<div class="msg-avatar">ü§ù</div><div class="msg-bubble" style="background:#eee; color:#999;"><span class="typing-dots"><span></span><span></span><span></span></span> ÂõûÁ≠î„ÇíÊ∫ñÂÇô‰∏≠...</div>`;
  msgs.appendChild(typing);
  msgs.scrollTop = msgs.scrollHeight;

  setTimeout(() => {
    const old = document.getElementById('faqTypingMsg');
    if(old) old.remove();

    if (answer) {
      // FAQÂ∞ÇÁî®„Éê„Éñ„É´
      const div = document.createElement('div');
      div.className = 'chat-msg bot';
      div.innerHTML = `<div class="msg-avatar">ü§ù</div>
        <div class="faq-answer-bubble">
          <div class="faq-answer-badge">${answer.badge}</div>
          <div>${answer.text.replace(/\n/g,'<br>')}</div>
          <div style="margin-top:8px; font-size:0.75rem; color:#558B2F; border-top:1px solid #C5E1A5; padding-top:6px;">
            üí¨ ‰ªñ„Å´„ÇÇ„ÅîË≥™Âïè„Åå„Åî„Åñ„ÅÑ„Åæ„Åó„Åü„Çâ„ÅäÊ∞óËªΩ„Å´„Å©„ÅÜ„Åû
          </div>
        </div>`;
      msgs.appendChild(div);

      // bot„É≠„Ç∞„Å´„ÇÇËøΩÂä†
      chatState.log.push({ role: 'bot', msg: answer.badge + ' ' + answer.text.replace(/<[^>]+>/g,'') });
    } else {
      addBotMsg('„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ\nÊãÖÂΩìËÄÖ„ÅåË©≥„Åó„Åè„ÅîË™¨Êòé„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ„ÅäÊ∞óËªΩ„Å´ËøΩÂä†„Åß„ÅîË≥™Âïè„Åè„Å†„Åï„ÅÑ üôè');
    }

    msgs.scrollTop = msgs.scrollHeight;

    // „ÉÅ„É£„ÉÉ„Éà„ÅåÂÆå‰∫Ü„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÄÅÊ¨°„ÅÆ„Éï„É≠„Éº„Å∏„ÅÆË™òÂ∞é„ÇíË°®Á§∫
    if (!chatState.isDone) {
      setTimeout(() => {
        showChatFaqSuggest();
      }, 800);
    }
  }, 900);
}

// FAQÂæå„ÅÆÈñ¢ÈÄ£Ë≥™Âïè„Çµ„Ç∏„Çß„Çπ„Éà
function showChatFaqSuggest() {
  const msgs = document.getElementById('chatMessages');
  const qr = document.getElementById('quickReplies');

  // Êú™‰ΩøÁî®„ÅÆFAQ„ÇíÊúÄÂ§ß3‰ª∂ÊèêÊ°à
  const allFaqs = Object.keys(FAQ_ANSWERS);
  const unused = allFaqs.filter(q => !faqUsedSet.has(q));
  const suggests = unused.slice(0, 3);

  if (suggests.length === 0) return;

  qr.innerHTML = '';
  qr.style.display = 'flex';

  // „Äå‰ªñ„ÅÆË≥™Âïè„ÇíË¶ã„Çã„Äç„Éú„Çø„É≥
  const moreBtn = document.createElement('button');
  moreBtn.className = 'quick-reply-btn';
  moreBtn.textContent = 'üìã ‰ªñ„ÅÆË≥™Âïè„ÇíË¶ã„Çã';
  moreBtn.onclick = () => {
    const body = document.getElementById('faqBody');
    const icon = document.getElementById('faqToggleIcon');
    body.classList.add('open');
    icon.classList.add('open');
    qr.style.display = 'none';
    // „Çπ„ÇØ„É≠„Éº„É´„Åó„Å¶FAQ„Éë„Éç„É´„Å∏
    document.getElementById('faqPanel').scrollIntoView({ behavior: 'smooth', block: 'start' });
  };
  qr.appendChild(moreBtn);

  // Èñ¢ÈÄ£Ë≥™Âïè„Çµ„Ç∏„Çß„Çπ„Éà
  suggests.forEach(q => {
    const btn = document.createElement('button');
    btn.className = 'quick-reply-btn';
    btn.textContent = q.length > 18 ? q.substring(0,16) + '‚Ä¶' : q;
    btn.title = q;
    btn.onclick = () => {
      qr.style.display = 'none';
      qr.innerHTML = '';
      // FAQ„Éë„Éç„É´„ÅÆ„Éú„Çø„É≥„ÇÇ‰ΩøÁî®Ê∏à„Åø„Å´
      document.querySelectorAll('.faq-btn').forEach(fb => {
        if(fb.getAttribute('onclick') && fb.getAttribute('onclick').includes(q.replace(/'/g,"\'"))) {
          if(!fb.classList.contains('used')) {
            fb.classList.add('used');
            faqUsedSet.add(q);
            const badge = document.getElementById('faqUsedCount');
            badge.style.display = 'inline-block';
            badge.textContent = faqUsedSet.size + '‰ª∂Áô∫Ë®ÄÊ∏à';
          }
        }
      });
      sendFaqToChat(q);
    };
    qr.appendChild(btn);
  });

  // ÂÆå‰∫Ü„Éú„Çø„É≥
  const doneBtn = document.createElement('button');
  doneBtn.className = 'quick-reply-btn';
  doneBtn.textContent = '‚úÖ ÂÆå‰∫Ü„Åô„Çã';
  doneBtn.onclick = () => {
    qr.style.display = 'none';
    processUserInput('ÂÆå‰∫Ü„Åô„Çã');
  };
  qr.appendChild(doneBtn);
}


// ========== „ÉÅ„É£„ÉÉ„Éà„Éú„ÉÉ„Éà ==========
const CHAT_FLOW = [
  {
    id: 'greeting',
    botMsg: '„Åì„Çì„Å´„Å°„ÅØ üôè\n„ÅîËë¨ÂÑÄ„Å´Èñ¢„Åô„Çã„ÅîÂ∏åÊúõ„ÇÑ„Åî‰∏çÂÆâ„Çí„ÄÅ„Å©„ÅÜ„Åû„ÅäÊ∞óËªΩ„Å´„ÅäËÅû„Åã„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ\n\n„Åæ„Åö„ÄÅÊïÖ‰∫∫Êßò„ÅÆ„ÅäË¶ãÈÄÅ„Çä„Å´„Å§„ÅÑ„Å¶„ÄÅ‰Ωï„Åã„ÅîÂ∏åÊúõ„ÅØ„Åî„Åñ„ÅÑ„Åæ„Åô„ÅãÔºü',
    quickReplies: ['„ÅäËä±„ÇíÂ§ö„ÅèÈ£æ„Çä„Åü„ÅÑ','Èü≥Ê•Ω„ÇíÊµÅ„Åó„Åü„ÅÑ','Ë≤ªÁî®„Çí„Åß„Åç„Çã„Å†„ÅëÊäë„Åà„Åü„ÅÑ','ÂÆóÊïôÁöÑ„Å™„Åì„Å®„ÇíÁõ∏Ë´á„Åó„Åü„ÅÑ','Áâπ„Å´Â∏åÊúõ„ÅØ„Å™„ÅÑ','„Åù„ÅÆ‰ªñ'],
    nextId: 'concerns'
  },
  {
    id: 'concerns',
    botMsg: '„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô üå∏\nÊ¨°„Å´„ÄÅ„Åî‰∏çÂÆâ„Å™ÁÇπ„ÇÑ„ÅîË≥™Âïè„ÅØ„Åî„Åñ„ÅÑ„Åæ„Åô„ÅãÔºü\n„Å©„Çì„Å™‰∫õÁ¥∞„Å™„Åì„Å®„Åß„ÇÇ„ÄÅÈÅ†ÊÖÆ„Å™„Åè„ÅäËÅû„Åã„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ',
    quickReplies: ['Ë≤ªÁî®„Éª„ÅäÊîØÊâï„ÅÑ„Å´„Å§„ÅÑ„Å¶','ÂÆóÊïô„ÉªÂÆóÊ¥æ„Å´„Å§„ÅÑ„Å¶','ÊâãÁ∂ö„Åç„ÉªÊõ∏È°û„Å´„Å§„ÅÑ„Å¶','Âàù„ÇÅ„Å¶„Åß‰Ωï„ÇÇ„Çè„Åã„Çâ„Å™„ÅÑ','ÂèÇÂàóËÄÖ„Å∏„ÅÆÂØæÂøú','Áâπ„Å´‰∏çÂÆâ„ÅØ„Å™„ÅÑ'],
    nextId: 'free'
  },
  {
    id: 'free',
    botMsg: '„Åã„Åó„Åì„Åæ„Çä„Åæ„Åó„Åü„ÄÇÊãÖÂΩìËÄÖ„ÅåÂøÉ„ÇíËæº„ÇÅ„Å¶„ÅîÂØæÂøú„ÅÑ„Åü„Åó„Åæ„Åô üïäÔ∏è\n\n‰ªñ„Å´‰Ωï„Åã„ÅîË¶ÅÊúõ„Éª„ÅîË≥™Âïè„ÅØ„Åî„Åñ„ÅÑ„Åæ„Åô„ÅãÔºü\nÔºà„Å™„Åë„Çå„Å∞„ÄåÂÆå‰∫Ü„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºâ',
    quickReplies: ['‰ªñ„Å´„ÇÇ„ÅÇ„Çã','ÂÆå‰∫Ü„Åô„Çã'],
    nextId: 'done'
  }
];

let chatState = {
  flowIndex: 0,
  isWaiting: false,
  isDone: false,
  log: []
};

function initChat() {
  const msgs = document.getElementById('chatMessages');
  if(!msgs) return;
  msgs.innerHTML = '';
  chatState = { flowIndex: 0, isWaiting: false, isDone: false, log: [] };
  document.getElementById('chatDoneBanner').classList.remove('show');
  document.getElementById('chatInput').disabled = false;
  document.getElementById('chatSendBtn').disabled = false;
  showTypingThenBot(CHAT_FLOW[0].botMsg, CHAT_FLOW[0].quickReplies);
}

function showTypingThenBot(message, quickReplies) {
  const msgs = document.getElementById('chatMessages');
  const qr = document.getElementById('quickReplies');
  qr.style.display = 'none';
  qr.innerHTML = '';

  // „Çø„Ç§„Éî„É≥„Ç∞„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº
  const typing = document.createElement('div');
  typing.className = 'chat-msg bot';
  typing.id = 'typingMsg';
  typing.innerHTML = `<div class="msg-avatar">ü§ù</div><div class="msg-bubble" style="background:#eee; color:#999; font-style:italic;"><span class="typing-dots"><span></span><span></span><span></span></span> ÂÖ•Âäõ‰∏≠...</div>`;
  msgs.appendChild(typing);
  msgs.scrollTop = msgs.scrollHeight;

  setTimeout(() => {
    // „Çø„Ç§„Éî„É≥„Ç∞ÂâäÈô§„ÄÅ„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
    const old = document.getElementById('typingMsg');
    if(old) old.remove();
    addBotMsg(message);
    // „ÇØ„Ç§„ÉÉ„ÇØ„É™„Éó„É©„Ç§Ë°®Á§∫
    if(quickReplies && quickReplies.length > 0) {
      qr.style.display = 'flex';
      quickReplies.forEach(r => {
        const btn = document.createElement('button');
        btn.className = 'quick-reply-btn';
        btn.textContent = r;
        btn.onclick = () => onQuickReply(r);
        qr.appendChild(btn);
      });
    }
  }, 800);
}

function addBotMsg(text) {
  const msgs = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className = 'chat-msg bot';
  div.innerHTML = `<div class="msg-avatar">ü§ù</div><div class="msg-bubble">${text.replace(/\n/g,'<br>')}</div>`;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

function addUserMsg(text) {
  const msgs = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className = 'chat-msg user';
  div.innerHTML = `<div class="msg-bubble">${escHtml(text)}</div><div class="msg-avatar user-av">üë§</div>`;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

function onQuickReply(text) {
  document.getElementById('quickReplies').style.display = 'none';
  document.getElementById('quickReplies').innerHTML = '';
  processUserInput(text);
}

function chatKeyDown(e) {
  if(e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendChatMessage();
  }
}

function sendChatMessage() {
  if(chatState.isDone) return;
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if(!text) return;
  input.value = '';
  document.getElementById('quickReplies').style.display = 'none';
  document.getElementById('quickReplies').innerHTML = '';
  processUserInput(text);
}

function processUserInput(text) {
  addUserMsg(text);
  chatState.log.push({ role: 'user', msg: text });
  state.chatLog = chatState.log.slice();

  const flow = CHAT_FLOW;
  const fi = chatState.flowIndex;

  // „ÄåÂÆå‰∫Ü„Åô„Çã„Äç„ÇíÈÅ∏Êäû
  if(text === 'ÂÆå‰∫Ü„Åô„Çã' || (fi >= flow.length)) {
    finishChat();
    return;
  }

  // Ê¨°„ÅÆ„Éï„É≠„Éº„Å∏
  const nextId = flow[fi]?.nextId;
  const nextFlow = flow.find(f => f.id === nextId);
  chatState.flowIndex = flow.indexOf(nextFlow);

  if(nextFlow) {
    if(nextFlow.id === 'done') {
      finishChat();
    } else if(text === '‰ªñ„Å´„ÇÇ„ÅÇ„Çã') {
      // „Éï„É™„ÉºÂÖ•Âäõ„ÇíÁ∂ö„Åë„Çã
      setTimeout(() => {
        addBotMsg('„ÇÇ„Å°„Çç„Çì„Åß„Åô„ÄÇ‰ªñ„Å´„ÇÇ„ÅîËá™Áî±„Å´„ÅäËÅû„Åã„Åõ„Åè„Å†„Åï„ÅÑ üòä');
      }, 600);
    } else {
      showTypingThenBot(nextFlow.botMsg, nextFlow.quickReplies);
    }
  } else {
    finishChat();
  }
}

function finishChat() {
  chatState.isDone = true;
  setTimeout(() => {
    addBotMsg('„ÅîÂÖ•Âäõ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åó„Åü üôè\nÊãÖÂΩìËÄÖ„ÅåÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç„Åó„ÄÅÂøÉ„ÇíËæº„ÇÅ„Å¶„ÅîÂØæÂøú„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ');
    document.getElementById('chatDoneBanner').classList.add('show');
    document.getElementById('chatInput').disabled = true;
    document.getElementById('chatSendBtn').disabled = true;
    document.getElementById('quickReplies').style.display = 'none';
    // state„Å´‰øùÂ≠ò
    state.chatLog = chatState.log.slice();
    state.wishes = chatState.log.filter(l=>l.role==='user').map(l=>l.msg).join(' / ');
  }, 700);
}

// ========== „Çπ„ÉÜ„ÉÉ„ÉóÈÅ∑Áßª ==========
function goToStep(n) {
  // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥
  if(n > state.currentStep) {
    if(!validate(state.currentStep)) {
      gaTrack('validation_error', {
        step_number: state.currentStep,
        step_label: (typeof STEP_LABELS !== 'undefined' ? STEP_LABELS[state.currentStep] : 'step'+state.currentStep)
      });
      return;
    }
  }
  
  // ÁèæÂú®„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÇíÈùûË°®Á§∫
  document.getElementById('step' + state.currentStep).classList.remove('active');
  document.getElementById('dot' + state.currentStep).classList.remove('active');
  document.getElementById('dot' + state.currentStep).classList.add('done');
  if(state.currentStep > 1) {
    document.getElementById('con' + (state.currentStep-1)).classList.add('done');
  }
  
  state.currentStep = n;
  
  // Êñ∞„Åó„ÅÑ„Çπ„ÉÜ„ÉÉ„Éó„ÇíË°®Á§∫
  document.getElementById('step' + n).classList.add('active');
  document.getElementById('dot' + n).classList.add('active');
  document.getElementById('dot' + n).classList.remove('done');
  
  // „Çπ„ÉÜ„ÉÉ„ÉóÂõ∫Êúâ„ÅÆÂàùÊúüÂåñ
  if(n === 3) renderPlans();
  if(n === 4) renderHalls();
  if(n === 5) renderCourses();
  if(n === 6) { setTimeout(initChat, 100); }
  if(n === 7) renderEstimate();
  if(n === 8) {
    renderFinalSummary();
    gaTrack('form_complete', {
      form_name: 'funeral_support',
      funeral_type: state.funeralType || '',
      plan_name: (state.selectedPlan && state.selectedPlan.name) || '',
      hall_name: (state.selectedHall && state.selectedHall.name) || '',
      attendance: state.attendance || '',
      is_member: state.isMember ? 'member' : 'general'
    });
  }
  
  window.scrollTo(0, 0);
  autoSaveDebounced(); // Ëá™Âãï‰øùÂ≠ò

  // GA4: „Çπ„ÉÜ„ÉÉ„ÉóË°®Á§∫„Ç§„Éô„É≥„Éà
  gaStepView(n);
  // STEP1 ÂàùÂõûÂÖ•ÂäõÈñãÂßã
  if(n === 1) gaTrack('form_start', { form_name: 'funeral_support' });
}

// ========== „Éê„É™„Éá„Éº„Ç∑„Éß„É≥ ==========
function validate(step) {
  if(step === 1) {
    let ok = true;
    const moshuName = document.getElementById('moshuName').value.trim();
    const deceasedName = document.getElementById('deceasedName').value.trim();
    const relation = document.getElementById('relation').value;
    if(!moshuName) { document.getElementById('moshuNameError').style.display='block'; ok=false; }
    else { document.getElementById('moshuNameError').style.display='none'; }
    if(!deceasedName) { document.getElementById('deceasedNameError').style.display='block'; ok=false; }
    else { document.getElementById('deceasedNameError').style.display='none'; }
    if(!relation) { document.getElementById('relationError').style.display='block'; ok=false; }
    else { document.getElementById('relationError').style.display='none'; }
    if(ok) { state.moshuName = moshuName; state.deceasedName = deceasedName; state.relation = relation; state.phone = document.getElementById('phone').value.trim(); }
    return ok;
  }
  if(step === 2) {
    let ok = true;
    if(!state.attendance) { document.getElementById('attendanceError').style.display='block'; ok=false; }
    else document.getElementById('attendanceError').style.display='none';
    if(!state.funeralType) { document.getElementById('funeralTypeError').style.display='block'; ok=false; }
    else document.getElementById('funeralTypeError').style.display='none';
    return ok;
  }
  if(step === 3) {
    if(!state.selectedPlan) { document.getElementById('planError').style.display='block'; return false; }
    document.getElementById('planError').style.display='none'; return true;
  }
  if(step === 4) {
    if(!state.selectedHall) { document.getElementById('hallError').style.display='block'; return false; }
    document.getElementById('hallError').style.display='none'; return true;
  }
  if(step === 5) {
    if(!state.selectedCourse) { document.getElementById('courseError').style.display='block'; return false; }
    document.getElementById('courseError').style.display='none'; return true;
  }
  return true;
}

// ========== ÈÅ∏Êäû„Éè„É≥„Éâ„É©„Éº ==========
function selectAttendance(btn, val) {
  document.querySelectorAll('#attendanceGroup .btn-choice').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  state.attendance = val;
  state.selectedPlan = null; state.selectedHall = null; state.selectedCourse = null;
  document.getElementById('attendanceError').style.display='none';
}

function selectFuneralType(btn, val) {
  document.querySelectorAll('#funeralTypeGroup .btn-choice').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  state.funeralType = val;
  state.selectedPlan = null; state.selectedHall = null; state.selectedCourse = null;
  document.getElementById('funeralTypeError').style.display='none';
}

function selectPlan(planId) {
  state.selectedPlan = currentPlans.find(p => p.id === planId) || null;
  if (state.selectedPlan) gaTrack('plan_select', { plan_id: planId, plan_name: state.selectedPlan.name || planId });
  document.querySelectorAll('.plan-card').forEach(c => c.classList.remove('selected'));
  const card = document.getElementById('plan_'+planId);
  if(card) card.classList.add('selected');
  state.selectedHall = null; state.selectedCourse = null;
  document.getElementById('planError').style.display='none';
  // „Éõ„Éº„É´„Çí„É™„Çª„ÉÉ„Éà
}

function selectHall(hallId) {
  state.selectedHall = HALLS[hallId] || null;
  if (state.selectedHall) gaTrack('hall_select', { hall_id: hallId, hall_name: state.selectedHall.name || hallId });
  document.querySelectorAll('.hall-card').forEach(c => c.classList.remove('selected'));
  const card = document.getElementById('hall_'+hallId);
  if(card) card.classList.add('selected');
  state.selectedCourse = null;
  document.getElementById('hallError').style.display='none';
}

function selectCourse(courseId) {
  state.selectedCourse = courseId;
  gaTrack('course_select', { course_id: courseId, course_name: (COURSES[courseId] && COURSES[courseId].name) || courseId });
  document.querySelectorAll('.course-card').forEach(c => c.classList.remove('selected'));
  const card = document.getElementById('course_'+courseId);
  if(card) card.classList.add('selected');
  document.getElementById('courseError').style.display='none';
}

function selectMember(btn, val) {
  document.querySelectorAll('#memberGroup .btn-choice').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  state.isMember = val;
}

// ========== „Éó„É©„É≥ÊèèÁîª ==========
let currentPlans = [];

function renderPlans() {
  const summary = document.getElementById('step3Summary');
  summary.textContent = `ÂèÇÂàó‰∫àÂÆöÔºö${getAttendanceLabel(state.attendance)}„ÄÄËë¨ÂÑÄÂΩ¢ÂºèÔºö${getFuneralTypeLabel(state.funeralType)}`;
  
  currentPlans = getPlans(state.attendance, state.funeralType);
  const container = document.getElementById('planCards');
  container.innerHTML = '';
  
  currentPlans.forEach(plan => {
    const badgeClass = plan.label === 'small' ? 'badge-small' : (plan.label === 'rec' ? 'badge-rec' : 'badge-large');
    const badgeText = plan.label === 'small' ? 'üîµ Â∞èË¶èÊ®°' : (plan.label === 'rec' ? '‚≠ê „Åä„Åô„Åô„ÇÅ' : 'üî¥ Â§ßË¶èÊ®°');
    
    const card = document.createElement('div');
    card.className = 'plan-card' + (state.selectedPlan && state.selectedPlan.id === plan.id ? ' selected' : '');
    card.id = 'plan_' + plan.id;
    card.onclick = () => selectPlan(plan.id);
    card.innerHTML = `
      <div class="plan-card-badge ${badgeClass}">${badgeText} <span class="plan-type-tag tag-${plan.priceType}">${plan.sizeTag}</span></div>
      <div class="plan-card-body">
        <div class="plan-card-title">${plan.icon} ${plan.name}</div>
        <div class="plan-card-sub">ÂØæÂøú„Éõ„Éº„É´Ôºö${plan.halls.map(h=>HALLS[h]?.short||h).join('„Éª')}</div>
        <div class="plan-card-desc">${plan.desc}</div>
        <div style="margin-top:8px; font-size:0.8rem; color:#558B2F;">
          ÁõÆÂÆâ‰æ°Ê†ºÔºà‰ºöÂì°ÔºâÔºö${formatPrice(getMinPrice(plan.priceType))}„Äú
        </div>
      </div>
    `;
    container.appendChild(card);
  });
  
  if(!state.selectedPlan) document.getElementById('planError').style.display='none';
}

function getMinPrice(priceType) {
  // Áõ¥Ëë¨„ÉªÁÅ´Ëë¨Âºè„ÅØ single „Ç≠„Éº„ÅÆ„Åø
  if(priceType === 'chokuso' || priceType === 'kasou') {
    const pc = PRICING[priceType];
    return pc ? pc.single[0] : 148000;
  }
  const pc = PRICING[priceType] || PRICING.compact;
  return pc.ai[0];
}

// ========== „Éõ„Éº„É´ÊèèÁîª ==========
function renderHalls() {
  const summary = document.getElementById('step4Summary');
  const planName = state.selectedPlan ? state.selectedPlan.name : '';
  summary.textContent = `ÈÅ∏Êäû„Éó„É©„É≥Ôºö${planName}`;
  
  const { recommended, others } = getRecommendedHalls(state.attendance, state.funeralType, state.selectedPlan);
  state.showingAllHalls = false;
  
  const container = document.getElementById('hallCards');
  container.innerHTML = '';
  
  renderHallCards(recommended, container, true);
  
  const showAllBtn = document.getElementById('showAllHallsBtn');
  if(others.length > 0) {
    showAllBtn.style.display = 'block';
    showAllBtn._othersToAdd = others;
  } else {
    showAllBtn.style.display = 'none';
  }
  
  if(!state.selectedHall) document.getElementById('hallError').style.display='none';
}

function renderHallCards(hallIds, container, isRecommended) {
  hallIds.forEach(hallId => {
    const hall = HALLS[hallId];
    if(!hall) return;
    
    const card = document.createElement('div');
    card.className = 'hall-card hall-card-wrapper' + (state.selectedHall && state.selectedHall.id === hallId ? ' selected' : '');
    card.id = 'hall_' + hallId;
    card.onclick = () => selectHall(hallId);
    
    const badge = hall.badge ? `<span class="hall-recommended-badge">${hall.badge}</span>` : '';
    const livingBadge = hall.special === 'living' ? `<div class="living-badge">üè° 1Êó•1ÁµÑ„Éó„É©„Ç§„Éô„Éº„Éà</div>` : '';
    
    card.innerHTML = `
      <span class="hall-selected-check">‚úî</span>
      <img class="hall-card-img" src="${hall.image}" alt="${hall.name}" loading="lazy" onerror="this.style.background='#e0d5c8';this.style.height='110px';">
      ${badge}
      <div class="hall-card-body">
        <div class="hall-card-name">${hall.name}</div>
        ${livingBadge}
        <div class="hall-card-cap">${hall.capacity}</div>
        <div class="hall-card-addr">${hall.address}</div>
        <div class="hall-card-addr" style="color:#558B2F; margin-top:2px;">${hall.special === 'chokuso' ? '' : 'üöÉ '}${hall.access}</div>
        ${hall.url && hall.url !== 'https://saiki-sousai.com/' ? `<div style="margin-top:6px;"><a href="${hall.url}" target="_blank" onclick="event.stopPropagation();" style="font-size:0.78rem;color:#558B2F;text-decoration:underline;">üîó Ë©≥Á¥∞„Éª„Éó„É©„É≥„ÇíË¶ã„Çã</a></div>` : ''}
      </div>
    `;
    container.appendChild(card);
  });
}

function showAllHalls() {
  const btn = document.getElementById('showAllHallsBtn');
  const others = btn._othersToAdd;
  const container = document.getElementById('hallCards');
  renderHallCards(others, container, false);
  btn.style.display = 'none';
}

// ========== „Ç≥„Éº„ÇπÊèèÁîª ==========
function renderCourses() {
  const plan = state.selectedPlan;
  const hall = state.selectedHall;

  // Áõ¥Ëë¨„ÉªÁÅ´Ëë¨Âºè„ÅØ„Ç≥„Éº„ÇπÈÅ∏Êäû‰∏çË¶Å
  if(plan && plan.isSimplePlan) {
    // ‚òÖ‰øÆÊ≠£: DOM„Å´‰æùÂ≠ò„Åõ„ÅöÂÖà„Å´state„Çí„Çª„ÉÉ„ÉàÔºàvalidateÈÄöÈÅé„ÅÆ„Åü„ÇÅÔºâ
    state.selectedCourse = 'single';
    const coursesContainer = document.getElementById('courseCards');
    if(coursesContainer) {
      coursesContainer.innerHTML = `
        <div style="background:#f0f8f0;border:2px solid #a8d8a8;border-radius:12px;padding:20px;text-align:center;">
          <div style="font-size:2rem;margin-bottom:8px;">üïäÔ∏è</div>
          <div style="font-weight:bold;color:#4a7c59;font-size:1.05rem;margin:8px 0;">Á•≠Â£á„Ç≥„Éº„Çπ„ÅÆÈÅ∏Êäû„ÅØ‰∏çË¶Å„Åß„Åô</div>
          <div style="font-size:0.85rem;color:#666;line-height:1.6;">Áõ¥Ëë¨„ÉªÁÅ´Ëë¨Âºè„Éó„É©„É≥„ÅØÁ•≠Â£á„Ç≥„Éº„Çπ„Åå„Åî„Åñ„ÅÑ„Åæ„Åõ„Çì„ÄÇ<br>„Åù„ÅÆ„Åæ„Åæ„ÄåÊ¨°„Å∏„Äç„Éú„Çø„É≥„Åß„ÅäÈÄ≤„Åø„Åè„Å†„Åï„ÅÑ„ÄÇ</div>
        </div>`;
    }
    // step5„Çø„Ç§„Éà„É´„ÇÇÊõ¥Êñ∞
    const step5Title = document.querySelector('#step5 .step-title');
    if(step5Title) step5Title.innerHTML = '<span class="step-num">5</span>„Éó„É©„É≥Á¢∫Ë™çÔºà„Ç≥„Éº„ÇπÈÅ∏Êäû‰∏çË¶ÅÔºâ';
    // courseError„ÇíÈùûË°®Á§∫„Å´„Åô„Çã
    const errEl = document.getElementById('courseError');
    if(errEl) errEl.style.display = 'none';
    return;
  }
  // hall/plan Êú™ÈÅ∏Êäû„ÉÅ„Çß„ÉÉ„ÇØÔºàÊóß„Ç≥„Éº„Éâ„Å®ÂêåÁ≠âÔºâ
  if(!hall || !plan) return;
  
  // ‚òÖ‰øÆÊ≠£v6: priceType „ÇíÂÖà„Å´Á¢∫ÂÆöÔºàTDZ„Ç®„É©„ÉºÂõûÈÅøÔºâ
  // „É™„Éì„É≥„Ç∞Â∞ÇÁî®„Éõ„Éº„É´„ÅØ living Âõ∫ÂÆö„ÄÅ„Åù„Çå‰ª•Â§ñ„ÅØ„Éó„É©„É≥„ÅÆ priceType „ÇíÂÑ™ÂÖà
  const isLiving = hall.special === 'living';
  const priceType = isLiving ? 'living' : (plan.priceType || hall.pricingType);
  const pricing = PRICING[priceType] || PRICING.compact;
  
  const summary = document.getElementById('step5Summary');
  const priceTypeLabel = {'compact':'„Ç≥„É≥„Éë„ÇØ„ÉàÂÆ∂ÊóèËë¨','living':'„É™„Éì„É≥„Ç∞Ëë¨','family':'ÂÆ∂ÊóèËë¨ÁöÑ„Å™„ÅäËë¨Âºè','normal':'‰∏ÄËà¨Ëë¨Ôºè„Åµ„Å§„ÅÜ„ÅÆ„ÅäËë¨Âºè'};
  summary.textContent = `„Éõ„Éº„É´Ôºö${hall.name}„ÄÄ„Éó„É©„É≥Ôºö${plan.name}„ÄÄ„Äê${priceTypeLabel[priceType] || priceType}„Äë`;
  
  const courseIds = ['ai','hana','kaori','kaga'];
  const priceKeys = ['ai','hana','kaori','kaga'];
  
  const container = document.getElementById('courseCards');
  container.innerHTML = '';
  
  courseIds.forEach((cId, i) => {
    const course = COURSES[cId];
    const prices = pricing[priceKeys[i]];
    const memberPrice = prices[0];
    const normalPrice = prices[1];
    
    // ÁîªÂÉèÈÅ∏ÊäûÔºö‰∏ÄËà¨Ëë¨„ÅØ normal_ ÁîªÂÉè„ÄÅ„É™„Éì„É≥„Ç∞Ëë¨„ÅØ living_ ÁîªÂÉè„ÄÅ„Åù„Çå‰ª•Â§ñ„ÅØÂÖ±ÈÄöÁîªÂÉè
    let imgSrc;
    if(isLiving) {
      imgSrc = IMG['living_'+cId] || IMG[cId];
    } else if(priceType === 'normal') {
      imgSrc = IMG['normal_'+cId] || IMG[cId];
    } else {
      imgSrc = IMG[cId];
    }
    
    const card = document.createElement('div');
    card.className = 'course-card' + (state.selectedCourse === cId ? ' selected' : '');
    card.id = 'course_' + cId;
    card.onclick = () => selectCourse(cId);
    card.innerHTML = `
      <img class="course-card-img" src="${imgSrc}" alt="${course.name}Á•≠Â£á" loading="lazy" onerror="this.style.background='#f5e6d0';this.style.height='130px';">
      <div class="course-card-body" style="background:${course.color};">
        <div class="course-card-name">‚öò ${course.name}</div>
        <div class="course-card-price">
          ‰ºöÂì° <span class="member-price">${formatPrice(memberPrice)}</span><br>
          <span style="font-size:0.75rem;">‰∏ÄËà¨ ${formatPrice(normalPrice)}</span>
        </div>
        <div class="course-card-desc">${course.desc}</div>
      </div>
      <div class="course-selected-mark">‚úî ÈÅ∏Êäû‰∏≠</div>
    `;
    container.appendChild(card);
  });
  
  if(!state.selectedCourse) document.getElementById('courseError').style.display='none';
}

// ========== Ë¶ãÁ©ç„ÇÇ„ÇäÊèèÁîª ==========
function renderEstimate() {
  const hall = state.selectedHall;
  const plan = state.selectedPlan;
  const course = state.selectedCourse;
  
  if(!hall || !plan || !course) return;
  
  // ‚òÖ‰øÆÊ≠£: „É™„Éì„É≥„Ç∞Â∞ÇÁî®„Éõ„Éº„É´„ÅØ living Âõ∫ÂÆö„ÄÅ„Åù„Çå‰ª•Â§ñ„ÅØ„Éó„É©„É≥„ÅÆ priceType „ÇíÂÑ™ÂÖà
  const priceType = (hall.special === 'living') ? 'living' : (plan.priceType || hall.pricingType);
  const pricing = PRICING[priceType] || PRICING.compact;
  
  // ‚òÖÁõ¥Ëë¨„ÉªÁÅ´Ëë¨Âºè„Éó„É©„É≥ÔºàisSimplePlanÔºâ„ÅÆÂ†¥Âêà„ÅØ single „Ç≠„Éº„Åß‰æ°Ê†ºÂèñÂæó
  let prices;
  if(plan.isSimplePlan || course === 'single') {
    const simplePricing = PRICING[priceType] || PRICING.chokuso;
    prices = simplePricing ? simplePricing.single : [198000, 248000];
  } else {
    const priceKey = course;
    if(!pricing[priceKey]) {
      console.error('[v8] renderEstimate: pricing not found for course=', priceKey, 'priceType=', priceType);
      document.getElementById('estimateCard').innerHTML = '<div style="color:red;padding:12px;">‚ö†Ô∏è ‰æ°Ê†º„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº„ÄÇ„ÅäÊâãÊï∞„Åß„Åô„ÅåÊúÄÂàù„Åã„Çâ„ÇÑ„ÇäÁõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</div>';
      return;
    }
    prices = pricing[priceKey];
  }
  const isMember = state.isMember === 'yes' || state.isMember === 'join';
  const basePrice = isMember ? prices[0] : prices[1];
  
  // ‚òÖv10‰øÆÊ≠£: „Åä„ÇÇ„Å¶„Å™„ÅóË≤ª„Éª„Ç™„Éó„Ç∑„Éß„É≥Ë≤ª„ÅØ„Äå„Ç≥„Éº„ÇπÊñôÈáë„Å´Âä†ÁÆó„Äç„Åô„ÇãÂà•Ë≤ªÁî®
  // ÂèÇÂàóËÄÖÊï∞„Å´Âøú„Åò„Åü„Åä„ÇÇ„Å¶„Å™„ÅóÁõÆÂÆâ„ÇíË®≠ÂÆö
  // Áõ¥Ëë¨„ÉªÁÅ´Ëë¨Âºè„ÅÆÂ†¥Âêà„ÅØ„Åä„ÇÇ„Å¶„Å™„ÅóË≤ª„Å™„Åó„ÄÅÊê¨ÈÄÅË≤ª„ÅÆ„Åø
  const isSimple = plan.isSimplePlan || course === 'single';
  // ‚òÖ30%Ê∏õÔºà2026/02 Ë™øÊï¥Ôºâ
  const attendanceHospitality = {
    'under5':    35000,   // ÂÖÉ10‰∏á‚Üí50%
    'under15':   52500,   // ÂÖÉ15‰∏á‚Üí50%
    '15to30':    87500,   // ÂÖÉ25‰∏á‚Üí50%
    '30to50':   140000,   // ÂÖÉ40‰∏á‚Üí50%
    'over50':   210000    // ÂÖÉ60‰∏á‚Üí50%
  };
  const hospitalityEstimate = isSimple ? 30000 : (attendanceHospitality[state.attendance] || 35000);
  const optionEstimate = isSimple ? 0 : 200000; // Áõ¥Ëë¨„ÅØËøΩÂä†„Ç™„Éó„Ç∑„Éß„É≥„Å™„Åó
  const totalEstimate = basePrice + hospitalityEstimate;
  
  const courseInfo = COURSES[course];
  const relationLabel = getRelationLabel(state.relation);
  const memberNote = state.isMember === 'yes' ? 'Ôºà‰ºöÂì°‰æ°Ê†ºÈÅ©Áî®Ôºâ' : state.isMember === 'join' ? 'ÔºàÂΩìÊó•‰ºöÂì°ÂÖ•‰ºö„Éª30%Ââ≤Âºï‰∫àÂÆöÔºâ' : state.isMember === 'unknown' ? 'Ôºà‰ºöÂì°Á¢∫Ë™çË¶ÅÔºâ' : 'Ôºà‰∏ÄËà¨‰æ°Ê†ºÔºâ';
  
  const card = document.getElementById('estimateCard');
  card.innerHTML = `
    <div class="estimate-section-title">üìã „ÅäÂÆ¢ÊßòÊÉÖÂ†±</div>
    <div class="estimate-row"><span class="estimate-label">Âñ™‰∏ªÂêç</span><span class="estimate-value">${escHtml(state.moshuName)} Êßò</span></div>
    <div class="estimate-row"><span class="estimate-label">‰∫°„Åè„Å™„Çâ„Çå„ÅüÊñπ„ÅÆ„ÅäÂêçÂâç</span><span class="estimate-value">${escHtml(state.deceasedName)} Êßò</span></div>
    <div class="estimate-row"><span class="estimate-label">ÊïÖ‰∫∫„Å®„ÅÆÈñ¢‰øÇ</span><span class="estimate-value">${relationLabel}</span></div>
    <div class="estimate-row"><span class="estimate-label">ÂèÇÂàó‰∫àÂÆö‰∫∫Êï∞</span><span class="estimate-value">${getAttendanceLabel(state.attendance)}</span></div>
    <div class="estimate-row"><span class="estimate-label">Ëë¨ÂÑÄÂΩ¢Âºè</span><span class="estimate-value">${getFuneralTypeLabel(state.funeralType)}</span></div>
    ${state.religion ? `<div class="estimate-row"><span class="estimate-label">„ÅîÂÆóÊïô„ÉªÂÆóÊ¥æ</span><span class="estimate-value">${escHtml(state.religion)}</span></div>` : ''}
    ${state.templeInfo ? `<div class="estimate-row"><span class="estimate-label">Ëè©ÊèêÂØ∫„Éª„ÅäÂØ∫</span><span class="estimate-value" style="font-size:0.78rem; line-height:1.4;">${escHtml(state.templeInfo).replace(/\n/g, '<br>')}</span></div>` : ''}
    
    <div class="estimate-section-title" style="margin-top:14px">üèõÔ∏è ÈÅ∏ÊäûÂÜÖÂÆπ</div>
    <div class="estimate-row"><span class="estimate-label">„Éó„É©„É≥</span><span class="estimate-value">${escHtml(plan.name)}</span></div>
    <div class="estimate-row"><span class="estimate-label">„Éõ„Éº„É´</span><span class="estimate-value">${escHtml(hall.name)}</span></div>
    <div class="estimate-row"><span class="estimate-label">Á•≠Â£á„Ç≥„Éº„Çπ</span><span class="estimate-value">‚öò ${courseInfo.name}</span></div>
    <div class="estimate-row"><span class="estimate-label" style="color:#888;font-size:0.78rem;">‰æ°Ê†ºÁ®ÆÂà•</span><span class="estimate-value" style="font-size:0.78rem;color:#558B2F;">${{'compact':'„Ç≥„É≥„Éë„ÇØ„ÉàÂÆ∂ÊóèËë¨','living':'„É™„Éì„É≥„Ç∞Ëë¨','family':'ÂÆ∂ÊóèËë¨ÁöÑ„Å™„ÅäËë¨Âºè','normal':'‰∏ÄËà¨Ëë¨Ôºè„Åµ„Å§„ÅÜ„ÅÆ„ÅäËë¨Âºè'}[priceType] || priceType}</span></div>
    <div class="estimate-row"><span class="estimate-label">„Éõ„Éº„É´‰ΩèÊâÄ</span><span class="estimate-value" style="font-size:0.78rem;">${hall.address}</span></div>
    <div class="estimate-row"><span class="estimate-label">„Ç¢„ÇØ„Çª„Çπ</span><span class="estimate-value" style="font-size:0.78rem;">${hall.access}</span></div>
    
    <div class="estimate-section-title" style="margin-top:14px">üí∞ Ë≤ªÁî®ÁõÆÂÆâ</div>
    <div class="estimate-row">
      <span class="estimate-label">${isSimple ? 'Áõ¥Ëë¨„ÉªÁÅ´Ëë¨Ë≤ªÁî®' : 'Ëë¨ÂÑÄÂü∫Êú¨„Çª„ÉÉ„Éà'}</span>
      <span class="estimate-value">${formatPrice(basePrice)}</span>
    </div>
    <div class="estimate-row" style="font-size:0.8rem;color:#888;">
      <span class="estimate-label">${isSimple ? '‚îî Êê¨ÈÄÅ„ÉªÂÆâÁΩÆ„ÉªÁÅ´Ëë¨Á´ã‰ºöÁ≠â' : '‚îî Á•≠Â£á„ÉªÊ£∫„ÉªÊê¨ÈÄÅ„ÉªÈÅ∫ÂΩ±Á≠â'}</span>
      <span class="estimate-value">Ôºà${isSimple ? '„Éó„É©„É≥ÊñôÈáë' : '„Ç≥„Éº„ÇπÊñôÈáë'}Ôºâ</span>
    </div>
    <div class="estimate-row">
      <span class="estimate-label">${isSimple ? 'Êê¨ÈÄÅË≤ªÁõÆÂÆâ' : '„Åä„ÇÇ„Å¶„Å™„ÅóË≤ªÁî®ÔºàÁõÆÂÆâÔºâ'}</span>
      <span class="estimate-value">${formatPrice(hospitalityEstimate)}</span>
    </div>
    <div class="estimate-row" style="font-size:0.8rem;color:#888;">
      <span class="estimate-label">${isSimple ? '‚îî „ÅîÈÅ∫‰ΩìÊê¨ÈÄÅ„Éª„Éâ„É©„Ç§„Ç¢„Ç§„ÇπÁ≠â' : '‚îî ËøîÁ§ºÂìÅ„ÉªÈ£ü‰∫ã„Éª‰ºöÈ§®‰ΩøÁî®ÊñôÁ≠â'}</span>
      <span class="estimate-value">${isSimple ? '' : 'ÔºàÂèÇÂàóËÄÖÊï∞„Å´„Çà„ÇäÂ§âÂãïÔºâ'}</span>
    </div>
    <div class="estimate-total">
      <div class="estimate-total-label">Á∑èÂêàË®àÔºàÁõÆÂÆâÔºâ${memberNote}</div>
      <div class="estimate-total-price">${formatPrice(totalEstimate)}</div>
      <div class="estimate-total-note">‚Äª„Åä„ÇÇ„Å¶„Å™„ÅóË≤ªÁî®„ÅØÂèÇÂàóËÄÖÊï∞„Å´„Çà„ÇäÂ§âÂãï„Åó„Åæ„Åô„ÄÇË©≥Á¥∞„ÅØÊãÖÂΩìËÄÖ„Å´„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ</div>
      <div class="estimate-total-warning">
        <div class="estimate-total-warning-title">‚ö†Ô∏è „Åì„Çå„ÅØÊ≠£ÂºèË¶ãÁ©ç„ÇÇ„Çä„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</div>
        <div class="estimate-total-warning-text">
          ‰∏äË®ò„ÅØÊ¶ÇÁÆó„ÅÆÁõÆÂÆâ„Åß„Åô„ÄÇÂÆüÈöõ„ÅÆË≤ªÁî®„ÅØÂèÇÂàóËÄÖÊï∞„ÇÑÈÅ∏ÊäûÂÜÖÂÆπ„Å´„Çà„ÇäÂ§âÂãï„Åó„Åæ„Åô„ÄÇ<br>
          <strong>Ê≠£Âºè„Å™„ÅäË¶ãÁ©ç„ÇÇ„Çä„ÅØÊãÖÂΩìËÄÖ„Å®„ÅÆÊâì„Å°Âêà„Çè„ÅõÂæå„Å´‰ΩúÊàê„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ</strong>
        </div>
      </div>
    </div>
    
    <div style="margin-top:16px;padding:14px 16px;background:#fff5f5;border:2.5px solid #e53935;border-radius:10px;position:relative;">      <div style="position:absolute;top:-11px;left:14px;background:#e53935;color:#fff;font-size:0.72rem;font-weight:bold;padding:2px 10px;border-radius:20px;letter-spacing:0.05em;">‚ö†Ô∏è „ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ</div>      <p style="margin:6px 0 0 0;font-size:0.88rem;font-weight:bold;color:#c62828;line-height:1.7;">        „ÅÇ„Åè„Åæ„Åß„Åì„Å°„Çâ„ÅÆÈáëÈ°ç„ÅØ<u>ÁõÆÂÆâ</u>„Åß„ÄÅ„Åó„Å£„Åã„Çä„Äå„ÅäË¶ãÈÄÅ„Çä‰∫àÁÆó„Äç„ÇíÂä†„Åà„ÅüÂ†¥Âêà„ÅÆÊï∞Â≠ó„Åß„Åô„ÄÇ<br>        ÈÅ∏„Å∂„ÅÆ„ÅØ„ÅäÂÆ¢Êßò„Åß„Åô„ÅÆ„Åß<strong>‰∏çË¶Å„Å™„Ç™„Éó„Ç∑„Éß„É≥„ÅØÂâäÈô§ÂèØËÉΩ</strong>„Åß„Åô„ÄÇ<br>        <span style="font-size:0.85rem;color:#e53935;">„ÅîÂÆâÂøÉ„Åè„Å†„Åï„ÅÑÔºÅ</span>      </p>    </div>
    
    ${!isSimple ? `
    <div style="margin-top:12px; padding:10px 12px; background:#fdf6ec; border:1px dashed #d4a76a; border-radius:8px;">
      <div style="font-size:0.82rem; font-weight:bold; color:#558B2F; margin-bottom:4px;">üí° „Çà„Åè„ÅÇ„Çã„Ç™„Éó„Ç∑„Éß„É≥ÁõÆÂÆâÔºàÂèÇËÄÉÔºâ</div>
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <span style="font-size:0.82rem; color:#666;">‚îî ÁîüËä±„ÉªÊñôÁêÜ„Éª„Éê„Çπ„Çø„ÇØ„Ç∑„ÉºÁ≠â</span>
        <span style="font-size:0.88rem; font-weight:bold; color:#558B2F;">${formatPrice(optionEstimate)} ÂâçÂæå</span>
      </div>
      <div style="font-size:0.75rem; color:#aaa; margin-top:4px;">‚Äª„ÅîÂ∏åÊúõ„ÅÆÂÜÖÂÆπ„Å´„Çà„ÇäÂ§âÂãï„Åó„Åæ„Åô„ÄÇ‰∏äË®òÂêàË®à„Å´„ÅØÂê´„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ</div>
    </div>` : ''}
  `;
}

// ========== ÂÆå‰∫ÜÁîªÈù¢ ==========
function renderFinalSummary() {
  // chatLog„Åã„ÇâË¶ÅÊúõ„Éª‰∏çÂÆâ„Çí„Åæ„Å®„ÇÅ„Çã
  if(chatState.log.length > 0) {
    state.wishes = chatState.log.filter(l=>l.role==='user').map(l=>l.msg).join(' Ôºè ');
  }
  
  const summary = document.getElementById('finalSummary');
  const hall = state.selectedHall;
  const plan = state.selectedPlan;
  const course = state.selectedCourse;
  const courseInfo = COURSES[course] || {};

  // Ë¶ãÁ©ç„ÇÇ„Çä‰æ°Ê†ºÂÜçË®àÁÆó (v10: Áõ¥Ëë¨„ÉªÁÅ´Ëë¨ÂºèÂØæÂøú)
  const priceType = hall ? ((hall.special === 'living') ? 'living' : (plan?.priceType || hall.pricingType)) : 'compact';
  const pricing = PRICING[priceType] || PRICING.compact;
  // Áõ¥Ëë¨„ÉªÁÅ´Ëë¨Âºè„ÅØ single „Ç≠„Éº
  let prices;
  if(priceType === 'chokuso' || priceType === 'kasou') {
    prices = PRICING[priceType] ? PRICING[priceType].single : [198000, 248000];
  } else {
    prices = course ? (pricing[course] || (() => { console.error('[v10] „Ç≥„Éº„Çπ„Ç≠„ÉºÊú™Áô∫Ë¶ã:', course, 'priceType:', priceType); return pricing.kaga || pricing.ai; })()) : pricing.ai;
  }
  const isMember = state.isMember === 'yes' || state.isMember === 'join';
  const basePrice = isMember ? prices[0] : prices[1];
  const memberNote = state.isMember === 'yes' ? 'Ôºà‰ºöÂì°‰æ°Ê†º 35%Ââ≤ÂºïÔºâ'
    : state.isMember === 'join' ? 'ÔºàÂΩìÊó•ÂÖ•‰ºö 30%Ââ≤ÂºïÔºâ'
    : state.isMember === 'unknown' ? 'Ôºà‰ºöÂì°Á¢∫Ë™çË¶ÅÔºâ' : 'Ôºà‰∏ÄËà¨‰æ°Ê†ºÔºâ';
  
  summary.innerHTML = `
    <strong style="color:#33691E; display:block; margin-bottom:10px; font-size:0.95rem; border-bottom:2px solid #d4a76a; padding-bottom:6px;">üìã „ÅîËë¨ÂÑÄ Á¢∫Ë™çÂÜÖÂÆπ„Çµ„Éû„É™„Éº</strong>
    <table style="width:100%; border-collapse:collapse; font-size:0.86rem; line-height:1.9;">
      <tr><td style="color:#888; width:42%; padding:3px 0;">üë§ Âñ™‰∏ªÂêç</td><td><strong>${escHtml(state.moshuName)}</strong> Êßò</td></tr>
      <tr><td style="color:#888; width:42%; padding:3px 0;">üïäÔ∏è ‰∫°„Åè„Å™„Çâ„Çå„ÅüÊñπ</td><td><strong>${escHtml(state.deceasedName)}</strong> Êßò</td></tr>
      <tr><td style="color:#888;">üîó ÊïÖ‰∫∫„Å®„ÅÆÈñ¢‰øÇ</td><td>${getRelationLabel(state.relation)}</td></tr>
      <tr><td style="color:#888;">üìû „ÅäÈõªË©±Áï™Âè∑</td><td>${escHtml(state.phone) || 'Êú™ÂÖ•Âäõ'}</td></tr>
      <tr><td style="color:#888;">üë• ÂèÇÂàó‰∫àÂÆö‰∫∫Êï∞</td><td><strong>${getAttendanceLabel(state.attendance)}</strong></td></tr>
      <tr><td style="color:#888;">‚öò Ëë¨ÂÑÄÂΩ¢Âºè</td><td><strong>${getFuneralTypeLabel(state.funeralType)}</strong></td></tr>
      <tr><td colspan="2" style="padding-top:8px; border-top:1px solid #e0d5c8;"></td></tr>
      <tr><td style="color:#888;">üìã ÈÅ∏Êäû„Éó„É©„É≥</td><td><strong>${escHtml(plan?.name||'')}</strong></td></tr>
      <tr><td style="color:#888;">üèõÔ∏è ÂºèÂ†¥„Éõ„Éº„É´</td><td><strong>${escHtml(hall?.name||'')}</strong></td></tr>
      <tr><td style="color:#888;">üìç ‰ΩèÊâÄ</td><td style="font-size:0.78rem;">${hall?.address||''}</td></tr>
      <tr><td style="color:#888;">üöÉ „Ç¢„ÇØ„Çª„Çπ</td><td style="font-size:0.78rem;">${hall?.access||''}</td></tr>
      <tr><td style="color:#888;">üéã Á•≠Â£á„Ç≥„Éº„Çπ</td><td><strong>${courseInfo.name||''}</strong></td></tr>
      <tr><td colspan="2" style="padding-top:8px; border-top:1px solid #e0d5c8;"></td></tr>
      <tr><td style="color:#888;">üí≥ ‰ºöÂì°Âå∫ÂàÜ</td><td>${getMemberLabel(state.isMember)}</td></tr>
      <tr><td style="color:#888;">üí∞ Ë≤ªÁî®ÁõÆÂÆâ</td><td><strong style="color:#33691E; font-size:1rem;">${formatPrice(basePrice)}</strong> ${memberNote}</td></tr>
    </table>
  `;

  // „ÉÅ„É£„ÉÉ„ÉàÂ±•Ê≠¥„ÇíPDFÁî®„Å´ÊèèÁîª
  renderPrintChatLog();
}

  // STEP8Á¥ôÂêπÈõ™
  function launchConfetti() {
    var wrap = document.getElementById('confettiWrap');
    if (!wrap) return;
    wrap.innerHTML = '';
    var colors = ['#7CB342','#9CCC65','#F48FB1','#F8BBD0','#DCEDC8','#FFF9C4','#FFE0B2','#E1BEE7'];
    for (var ci = 0; ci < 22; ci++) {
      var p = document.createElement('div');
      p.className = 'confetti-piece';
      p.style.left = (Math.random() * 100) + '%';
      p.style.background = colors[Math.floor(Math.random() * colors.length)];
      p.style.animationDuration = (1.2 + Math.random() * 1.2) + 's';
      p.style.animationDelay = (Math.random() * 1.0) + 's';
      p.style.width = (6 + Math.random() * 6) + 'px';
      p.style.height = (6 + Math.random() * 6) + 'px';
      p.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
      wrap.appendChild(p);
    }
    // 2ÁßíÂæå„Å´ÂÜçÂ∫¶Ëµ∑Âãï
    setTimeout(launchConfetti, 2600);
  }


function renderPrintChatLog() {
  const log = chatState.log;
  const container = document.getElementById('printChatMessages');
  const section = document.getElementById('printChatLog');
  if(!container) return;
  container.innerHTML = '';

  if(!log || log.length === 0) {
    section.style.display = 'none';
    return;
  }

  // „Éú„ÉÉ„Éà„ÅÆÊúÄÂàù„ÅÆÁô∫Ë®Ä„ÇíÂÖàÈ†≠„Å´ËøΩÂä†
  const firstBot = { role: 'bot', msg: '„Åì„Çì„Å´„Å°„ÅØ üôè\n„ÅîËë¨ÂÑÄ„Å´Èñ¢„Åô„Çã„ÅîÂ∏åÊúõ„ÇÑ„Åî‰∏çÂÆâ„Çí„ÄÅ„Å©„ÅÜ„Åû„ÅäÊ∞óËªΩ„Å´„ÅäËÅû„Åã„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ\n„Åæ„Åö„ÄÅÊïÖ‰∫∫Êßò„ÅÆ„ÅäË¶ãÈÄÅ„Çä„Å´„Å§„ÅÑ„Å¶„ÄÅ‰Ωï„Åã„ÅîÂ∏åÊúõ„ÅØ„Åî„Åñ„ÅÑ„Åæ„Åô„ÅãÔºü' };
  const fullLog = [firstBot, ...log];

  fullLog.forEach((entry, idx) => {
    const isBot = entry.role === 'bot';
    const row = document.createElement('div');
    row.className = 'pdf-chat-row' + (isBot ? '' : ' user-row');

    const label = document.createElement('div');
    label.className = 'pdf-chat-label';
    label.textContent = isBot ? 'ü§ù ÊãÖÂΩì' : 'üë§ „ÅäÂÆ¢Êßò';

    const bubbleWrap = document.createElement('div');
    bubbleWrap.style.display = 'flex'; bubbleWrap.style.flexDirection = 'column';
    bubbleWrap.style.maxWidth = '82%';

    const bubble = document.createElement('div');
    bubble.className = isBot ? 'pdf-chat-bubble-bot' : 'pdf-chat-bubble-user';
    bubble.innerHTML = escHtml(entry.msg).replace(/\n/g, '<br>');

    bubbleWrap.appendChild(bubble);
    if(isBot) { row.appendChild(label); row.appendChild(bubbleWrap); }
    else       { row.appendChild(bubbleWrap); row.appendChild(label); }
    container.appendChild(row);
  });

  // „Éú„ÉÉ„Éà„ÅÆÁµê„Å≥„É°„ÉÉ„Çª„Éº„Ç∏
  const closingRow = document.createElement('div');
  closingRow.className = 'pdf-chat-row';
  const closingLabel = document.createElement('div');
  closingLabel.className = 'pdf-chat-label'; closingLabel.textContent = 'ü§ù ÊãÖÂΩì';
  const closingBubble = document.createElement('div');
  closingBubble.className = 'pdf-chat-bubble-bot';
  closingBubble.innerHTML = '„ÅîÂÖ•Âäõ„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åó„Åü üôè<br>ÊãÖÂΩìËÄÖ„ÅåÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç„Åó„ÄÅÂøÉ„ÇíËæº„ÇÅ„Å¶„ÅîÂØæÂøú„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ';
  closingRow.appendChild(closingLabel); closingRow.appendChild(closingBubble);
  container.appendChild(closingRow);

  section.style.display = 'block';
}

// ========== „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£ ==========
function formatPrice(n) {
  return 'Ôø•' + n.toLocaleString('ja-JP');
}

function escHtml(s) {
  return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function getAttendanceLabel(v) {
  const m = {under5:'5Âêç‰ª•‰∏ã',under15:'15Âêç‰ª•‰∏ã','15to30':'15„Äú30Âêç','30to50':'30„Äú50Âêç',over50:'50Âêç‰ª•‰∏ä'};
  return m[v] || v;
}

function getFuneralTypeLabel(v) {
  const m = {family:'ÂÆ∂ÊóèËë¨',family_friends:'ÂÆ∂ÊóèËë¨ÔºàÂèã‰∫∫Â∞ëÊï∞ÂèÇÂä†Ôºâ',general:'‰∏ÄËà¨Ëë¨',general_company:'‰∏ÄËà¨Ëë¨Ôºà‰ºöÁ§æ„ÉªÂõ£‰ΩìÔºâ',chokuso:'Áõ¥Ëë¨„ÉªÁÅ´Ëë¨Âºè',kasouonly:'ÁÅ´Ëë¨„ÅÆ„Åø'};
  return m[v] || v;
}

function getRelationLabel(v) {
  const m = {spouse:'ÈÖçÂÅ∂ËÄÖ',parent:'Ë¶™ÔºàÁà∂„ÉªÊØçÔºâ',child:'Â≠ê„Å©„ÇÇ',sibling:'ÂÖÑÂºü„ÉªÂßâÂ¶π',grandparent:'Á•ñÁà∂„ÉªÁ•ñÊØç',inlaw:'Áæ©ÁêÜ„ÅÆË¶™',relative:'„Åù„ÅÆ‰ªñË¶™Êóè',other:'„Åù„ÅÆ‰ªñ'};
  return m[v] || v;
}

function getMemberLabel(v) {
  const m = {yes:'‰ºöÂì°Ôºà35%Ââ≤ÂºïÈÅ©Áî®Ôºâ',join:'ÂΩìÊó•‰ºöÂì°ÂÖ•‰ºöÂ∏åÊúõÔºà30%Ââ≤ÂºïÔºâ',no:'Èùû‰ºöÂì°Ôºà‰∏ÄËà¨‰æ°Ê†ºÔºâ',unknown:'‰∏çÊòéÔºàË¶ÅÁ¢∫Ë™çÔºâ'};
  return m[v] || 'Êú™ÂõûÁ≠î';
}


// ============================================================
// ===== ÈÄÅ‰ø°Âá¶ÁêÜÔºàEmailJS + Google Apps ScriptÔºâ=====
// ============================================================

// ‚ñº‚ñº‚ñº Ë®≠ÂÆöÁÆáÊâÄ ‚ñº‚ñº‚ñº -----------------------------------------------
// „ÄêEmailJSË®≠ÂÆöÊâãÈ†Ü„Äë
// 1. https://www.emailjs.com/ „Åß„Ç¢„Ç´„Ç¶„É≥„Éà‰ΩúÊàêÔºàÁÑ°Êñô„Éó„É©„É≥„ÅÇ„ÇäÔºâ
// 2. „ÄåAdd New Service„Äç„ÅßGmailÁ≠â„ÇíÈÄ£Êê∫ ‚Üí Service ID„Çí„Ç≥„Éî„Éº
// 3. „ÄåEmail Templates„Äç„Åß„ÉÜ„É≥„Éó„É¨„Éº„Éà‰ΩúÊàê ‚Üí Template ID„Çí„Ç≥„Éî„Éº
// 4. „ÄåAccount > API Keys„Äç„ÅßPublic Key„Çí„Ç≥„Éî„Éº
// 5. ‰∏ãË®ò3Ë°å„Å´Ë≤º„Çä‰ªò„Åë„Çã„Å†„Åë„Åß„É°„Éº„É´ÈÄÅ‰ø°„ÅåÊúâÂäπ„Å´„Å™„Çä„Åæ„ÅôÔºÅ
const EMAILJS_SERVICE_ID  = 'YOUR_SERVICE_ID';   // ‚Üê ÊâãÈ†Ü2„ÅÆService ID
const EMAILJS_TEMPLATE_ID = 'YOUR_TEMPLATE_ID';  // ‚Üê ÊâãÈ†Ü3„ÅÆTemplate ID
const EMAILJS_PUBLIC_KEY  = 'YOUR_PUBLIC_KEY';   // ‚Üê ÊâãÈ†Ü4„ÅÆPublic Key
const EMAILJS_TO_EMAIL    = 'info@saiki-sousai.com'; // ‚Üê ÈÄÅ‰ø°ÂÖà„É°„Éº„É´ÔºàË®≠ÂÆöÊ∏àÔºâ

// „ÄêGASË®≠ÂÆöÔºö„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´Ë®òÈå≤„Åó„Åü„ÅÑÂ†¥Âêà„ÅÆ„ÅøÔºàÁúÅÁï•ÂèØÔºâ„Äë
// 1. Google„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Çí‰ΩúÊàê
// 2. Êã°ÂºµÊ©üËÉΩ > Apps Script „ÅßGAS„Çπ„ÇØ„É™„Éó„Éà„Çí‰ΩúÊàê„Éª„Éá„Éó„É≠„Ç§
// 3. „Éá„Éó„É≠„Ç§„ÅßÂèñÂæó„Åó„ÅüURL„Çí‰∏ãË®ò„Å´Ë≤º„Çä‰ªò„Åë
const GAS_WEBHOOK_URL = 'YOUR_GAS_WEBHOOK_URL';  // ‚Üê GAS Web„Ç¢„Éó„É™„ÅÆURLÔºàÁúÅÁï•ÂèØÔºâ
// ‚ñ≤‚ñ≤‚ñ≤ Ë®≠ÂÆöÁÆáÊâÄ„Åì„Åì„Åæ„Åß ‚ñ≤‚ñ≤‚ñ≤ ----------------------------------------

function submitAndComplete() {
  // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥ÔºàSTEP 7 ÈÄöÈÅé„ÉÅ„Çß„ÉÉ„ÇØÔºâ
  if(!state.selectedHall || !state.selectedCourse) {
    alert('ÂºèÂ†¥„ÉªÁ•≠Â£á„Ç≥„Éº„Çπ„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÂâç„ÅÆÊâãÈ†Ü„Çí„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇ');
    return;
  }

  // ÈÄÅ‰ø°„Éú„Çø„É≥ÁÑ°ÂäπÂåñ
  const btn = document.getElementById('submitBtn');
  if(btn) btn.disabled = true;

  // „Ç™„Éº„Éê„Éº„É¨„Ç§Ë°®Á§∫
  document.getElementById('submitOverlay').classList.add('show');

  // ÈÄÅ‰ø°„Éá„Éº„Çø‰ΩúÊàê
  const hall = state.selectedHall;
  const plan = state.selectedPlan;
  const course = state.selectedCourse;
  const courseInfo = COURSES[course] || {};
  const priceType = hall ? ((hall.special === 'living') ? 'living' : (plan?.priceType || hall.pricingType)) : 'compact';
  const pricing   = PRICING[priceType] || PRICING.compact;
  // ‚òÖv10‰øÆÊ≠£: Áõ¥Ëë¨„ÉªÁÅ´Ëë¨ÂºèÂØæÂøú„ÄÇÈÅ∏Êäû„Ç≥„Éº„Çπ„Ç≠„Éº„ÅßÊ≠£Á¢∫„Å´ÂèÇÁÖß
  let prices;
  if(priceType === 'chokuso' || priceType === 'kasou') {
    prices = PRICING[priceType] ? PRICING[priceType].single : [198000, 248000];
  } else {
    prices = course ? (pricing[course] || (() => { console.error('[v10] submitAndComplete „Ç≥„Éº„Çπ„Ç≠„ÉºÊú™Áô∫Ë¶ã:', course); return pricing.kaga || pricing.ai; })()) : pricing.ai;
  }
  const isMember  = state.isMember === 'yes' || state.isMember === 'join';
  const basePrice = isMember ? prices[0] : prices[1];

  const chatLog = chatState.log
    .map(l => (l.role === 'bot' ? '[ÊãÖÂΩìAI] ' : '[„ÅäÂÆ¢Êßò] ') + l.msg)
    .join('\n');

  const now = new Date();
  const dateStr = now.getFullYear() + '/' +
    String(now.getMonth()+1).padStart(2,'0') + '/' +
    String(now.getDate()).padStart(2,'0') + ' ' +
    String(now.getHours()).padStart(2,'0') + ':' +
    String(now.getMinutes()).padStart(2,'0');

  const payload = {
    submitted_at:    dateStr,
    moshuName:       state.moshuName,
    deceasedName:    state.deceasedName,
    relation:        getRelationLabel(state.relation),
    phone:           state.phone || 'Êú™ÂÖ•Âäõ',
    attendance:      getAttendanceLabel(state.attendance),
    funeral_type:    getFuneralTypeLabel(state.funeralType),
    plan_name:       plan?.name || '',
    hall_name:       hall?.name || '',
    hall_address:    hall?.address || '',
    hall_access:     hall?.access || '',
    course_name:     courseInfo.name || '',
    member_status:   getMemberLabel(state.isMember),
    price_estimate:  formatPrice(basePrice),
    price_type:      priceType,
    wishes:          state.wishes || 'Ôºà„Å™„ÅóÔºâ',
    chat_log:        chatLog || 'Ôºà„Å™„ÅóÔºâ',
    to_email:        EMAILJS_TO_EMAIL
  };

  // ‰∏¶Ë°åÈÄÅ‰ø°ÔºàEmailJS + GASÔºâ
  const emailPromise = sendViaEmailJS(payload);
  const gasPromise   = sendViaGAS(payload);

  Promise.allSettled([emailPromise, gasPromise]).then(results => {
    // „Ç™„Éº„Éê„Éº„É¨„Ç§ÈùûË°®Á§∫
    document.getElementById('submitOverlay').classList.remove('show');

    const emailOk = results[0].status === 'fulfilled';
    const gasOk   = results[1].status === 'fulfilled';

    // STEP 8 „Å´ÈÅ∑Áßª
    goToStep(8);

    // ÁµêÊûú„Éê„Éä„ÉºË°®Á§∫
    setTimeout(() => {
      const banner = document.getElementById('submitResultBanner');
      if(!banner) return;
      if(emailOk && gasOk) {
        banner.className = 'submit-result-banner success';
        banner.innerHTML = '‚úÖ ÈÄÅ‰ø°ÂÆå‰∫ÜÔºÅ<br>ÊãÖÂΩìËÄÖ„Å∏„ÅÆ„É°„Éº„É´ÈÄöÁü•„Å®„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å∏„ÅÆË®òÈå≤„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ<br>„ÅäÁ¥ÑÊùü„ÅÆ„ÅäÊôÇÈñì„Å´ÊãÖÂΩìËÄÖ„ÅåÂèÇ„Çä„Åæ„Åô„ÄÇÂøÉ„ÇíËæº„ÇÅ„Å¶„ÅäÊâì„Å°Âêà„Çè„Åõ„ÅÆÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç„Åï„Åõ„Å¶„ÅÑ„Åü„Å†„Åç„Åæ„Åô„ÄÇ';
      } else if(emailOk || gasOk) {
        banner.className = 'submit-result-banner success';
        const detail = emailOk ? '„É°„Éº„É´ÈÄöÁü•„ÅØÈÄÅ‰ø°Ê∏à„Åø„Åß„Åô„ÄÇ' : '„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å∏„ÅÆË®òÈå≤„ÅØÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ';
        banner.innerHTML = '‚úÖ ÈÄÅ‰ø°ÂÆå‰∫ÜÔºà‰∏ÄÈÉ®Ôºâ<br>' + detail;
      } else {
        banner.className = 'submit-result-banner error';
        banner.innerHTML = '‚ö†Ô∏è ÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ<br>„ÅäÊâãÊï∞„Åß„Åô„Åå <strong>üìû 0120-315-312</strong> „Åæ„Åß„ÅäÈõªË©±„ÅÑ„Åü„Å†„Åè„Åã„ÄÅ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶ÂÜçÈÄÅ‰ø°„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
        if(btn) btn.disabled = false;
      }
    }, 400);

    console.log('Email:', results[0].status, results[0].reason || '');
    console.log('GAS:',   results[1].status, results[1].reason || '');
  });
}

// ---------- EmailJS ÈÄÅ‰ø° ----------
function sendViaEmailJS(payload) {
  return new Promise((resolve, reject) => {
    // EmailJSÊú™Ë®≠ÂÆö„ÉÅ„Çß„ÉÉ„ÇØ
    if(EMAILJS_PUBLIC_KEY === 'YOUR_PUBLIC_KEY') {
      console.warn('EmailJS: Êú™Ë®≠ÂÆö„ÅÆ„Åü„ÇÅ„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åô');
      return reject('EmailJS not configured');
    }
    emailjs.init(EMAILJS_PUBLIC_KEY);
    const templateParams = {
      to_email:         payload.to_email,
      submitted_at:     payload.submitted_at,
      name:             payload.name,
      relation:         payload.relation,
      phone:            payload.phone,
      attendance:       payload.attendance,
      funeral_type:     payload.funeral_type,
      plan_name:        payload.plan_name,
      hall_name:        payload.hall_name,
      hall_address:     payload.hall_address,
      hall_access:      payload.hall_access,
      course_name:      payload.course_name,
      member_status:    payload.member_status,
      price_estimate:   payload.price_estimate,
      wishes:           payload.wishes,
      chat_log:         payload.chat_log,
      estimate_detail:  payload.estimate_detail || ''
    };
    emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams)
      .then(() => resolve('email_ok'))
      .catch(err => reject(err));
  });
}

// ---------- Google Apps Script ÈÄÅ‰ø° ----------
function sendViaGAS(payload) {
  return new Promise((resolve, reject) => {
    // GASÊú™Ë®≠ÂÆö„ÉÅ„Çß„ÉÉ„ÇØ
    if(GAS_WEBHOOK_URL === 'YOUR_GAS_WEBHOOK_URL') {
      console.warn('GAS: Êú™Ë®≠ÂÆö„ÅÆ„Åü„ÇÅ„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åô');
      return reject('GAS not configured');
    }
    fetch(GAS_WEBHOOK_URL, {
      method: 'POST',
      mode: 'no-cors', // GAS„ÅØno-cors„ÅßÈÄÅ‰ø°
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    })
    .then(() => resolve('gas_ok'))
    .catch(err => reject(err));
  });
}

function printPage() {
  // Âç∞Âà∑Êó•ÊôÇ„Çí„Éò„ÉÉ„ÉÄ„Éº„Å´„Çª„ÉÉ„Éà
  const now = new Date();
  const dateStr = now.getFullYear() + 'Âπ¥' +
    String(now.getMonth()+1).padStart(2,'0') + 'Êúà' +
    String(now.getDate()).padStart(2,'0') + 'Êó• ' +
    String(now.getHours()).padStart(2,'0') + ':' +
    String(now.getMinutes()).padStart(2,'0') +
    ' ‰ΩúÊàê';
  const pd = document.getElementById('printDate');
  if(pd) pd.textContent = dateStr + '„ÄÄüìû 0120-315-312';
  window.print();
}

// ========== Ë¶ãÁ©ç„ÇÇ„Çä„É°„Éº„É´Ëá™ÂãïÈÄÅ‰ø° ==========
async function sendEstimateEmail() {
  const hall = state.selectedHall;
  const plan = state.selectedPlan;
  const course = state.selectedCourse;

  // EmailJSÊú™Ë®≠ÂÆö„ÉÅ„Çß„ÉÉ„ÇØ
  if(EMAILJS_PUBLIC_KEY === 'YOUR_PUBLIC_KEY') {
    showEstimateEmailBanner('warning',
      '‚ö†Ô∏è EmailJS„ÅåÊú™Ë®≠ÂÆö„Åß„Åô„ÄÇ<br>' +
      'HTML„Éï„Ç°„Ç§„É´ÂÜÖ„ÅÆ <code>EMAILJS_SERVICE_ID</code>„Éª<code>EMAILJS_TEMPLATE_ID</code>„Éª<code>EMAILJS_PUBLIC_KEY</code> „ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ<br>' +
      '<a href="https://www.emailjs.com/" target="_blank" style="color:#1565c0;">‚ñ∂ EmailJSË®≠ÂÆö„Éö„Éº„Ç∏„Å∏</a>'
    );
    return;
  }
  if(!hall || !plan || !course) {
    gaTrack('email_send_error', { error_type: 'send_failed' });
    showEstimateEmailBanner('error', '‚ö†Ô∏è Ë¶ãÁ©ç„ÇÇ„Çä„ÅåÂÆåÊàê„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÂêÑ„Çπ„ÉÜ„ÉÉ„Éó„ÇíÂÆå‰∫Ü„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
    return;
  }

  const btn = document.getElementById('sendEstimateEmailBtn');
  if(btn) { btn.disabled = true; btn.textContent = '‚è≥ ÈÄÅ‰ø°‰∏≠...'; }

  // „Éö„Ç§„É≠„Éº„ÉâÁµÑ„ÅøÁ´ã„Å¶ÔºàsubmitAndComplete„Å®Âêå„Åò„É≠„Ç∏„ÉÉ„ÇØÔºâ
  const courseInfo = COURSES[course] || {};
  const priceType  = (hall.special === 'living') ? 'living' : (plan.priceType || hall.pricingType);
  const pricing    = PRICING[priceType] || PRICING.compact;
  const isSimple   = plan.isSimplePlan || course === 'single';
  let prices;
  if(isSimple) {
    const sp = PRICING[priceType] || PRICING.chokuso;
    prices = sp ? sp.single : [198000, 248000];
  } else {
    prices = pricing[course] || pricing.ai || [0,0];
  }
  const isMember  = state.isMember === 'yes' || state.isMember === 'join';
  const basePrice = isMember ? prices[0] : prices[1];
  // ‚òÖ30%Ê∏õÔºà2026/02 Ë™øÊï¥Ôºâ
  const attendHosp = { under5:35000, under15:52500, '15to30':87500, '30to50':140000, over50:210000 };
  const hospEst   = isSimple ? 30000 : (attendHosp[state.attendance] || 70000);
  const totalEst  = basePrice + hospEst;
  const memberTag = isMember ? '‰ºöÂì°‰æ°Ê†º' : '‰∏ÄËà¨‰æ°Ê†º';

  const chatLog = chatState.log.length > 0
    ? chatState.log.map(l => (l.role==='bot'?'[ÊãÖÂΩìAI] ':'[„ÅäÂÆ¢Êßò] ') + l.msg).join('\n')
    : 'Ôºà„Å™„ÅóÔºâ';

  const now = new Date();
  const dateStr = now.getFullYear() + '/' +
    String(now.getMonth()+1).padStart(2,'0') + '/' +
    String(now.getDate()).padStart(2,'0') + ' ' +
    String(now.getHours()).padStart(2,'0') + ':' +
    String(now.getMinutes()).padStart(2,'0');

  // Ë¶ãÁ©ç„ÇÇ„ÇäË©≥Á¥∞„ÉÜ„Ç≠„Çπ„ÉàÔºà„É°„Éº„É´Êú¨ÊñáÁî®Ôºâ
  const estimateDetail = [
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
    '‚öò „Åï„ÅÑ„ÅçËë¨Á•≠„ÄÄ„ÅäË¶ãÁ©ç„ÇÇ„Çä',
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
    '',
    '„Äê„ÅäÂÆ¢ÊßòÊÉÖÂ†±„Äë',
    '„ÄÄÂñ™‰∏ªÂêç„ÄÄ„ÄÄ„ÄÄ: ' + (state.moshuName || 'Êú™ÂÖ•Âäõ') + '„ÄÄÊßò',
    '„ÄÄÊïÖ‰∫∫ÊßòÂêç„ÄÄ„ÄÄ: ' + (state.deceasedName || 'Êú™ÂÖ•Âäõ') + '„ÄÄÊßò',
    '„ÄÄÊïÖ‰∫∫„Å®„ÅÆÈñ¢‰øÇ: ' + getRelationLabel(state.relation),
    '„ÄÄÈõªË©±Áï™Âè∑„ÄÄ„ÄÄ: ' + (state.phone || 'Êú™ÂÖ•Âäõ'),
    '„ÄÄÂèÇÂàó‰∫àÂÆö‰∫∫Êï∞: ' + getAttendanceLabel(state.attendance),
    '„ÄÄËë¨ÂÑÄÂΩ¢Âºè„ÄÄ„ÄÄ: ' + getFuneralTypeLabel(state.funeralType),
    ...(state.religion ? ['„ÄÄ„ÅîÂÆóÊïô„ÉªÂÆóÊ¥æ: ' + state.religion] : []),
    ...(state.templeInfo ? ['„ÄÄËè©ÊèêÂØ∫ÊÉÖÂ†±„ÄÄ: ' + state.templeInfo.replace(/\n/g, '\n„ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄ„ÄÄ')] : []),
    '',
    '„ÄêÈÅ∏Êäû„Éó„É©„É≥„Éª‰ºöÂ†¥„Äë',
    '„ÄÄ„Éó„É©„É≥„ÄÄ : ' + (plan.name || ''),
    '„ÄÄ‰ºö„ÄÄÂ†¥„ÄÄ : ' + (hall.name || ''),
    '„ÄÄ‰Ωè„ÄÄÊâÄ„ÄÄ : ' + (hall.address || ''),
    '„ÄÄÁ•≠Â£á„Ç≥„Éº„Çπ: ' + (isSimple ? 'ÔºàÁõ¥Ëë¨„ÉªÁÅ´Ëë¨Âºè„ÅÆ„Åü„ÇÅ„Ç≥„Éº„Çπ„Å™„ÅóÔºâ' : (courseInfo.name || course)),
    '„ÄÄ‰ºöÂì°Âå∫ÂàÜ : ' + getMemberLabel(state.isMember),
    '',
    '„ÄêË≤ªÁî®ÁõÆÂÆâÔºà' + memberTag + 'Ôºâ„Äë',
    '„ÄÄ' + (isSimple ? 'Áõ¥Ëë¨„ÉªÁÅ´Ëë¨Ë≤ªÁî®' : 'Ëë¨ÂÑÄÂü∫Êú¨„Çª„ÉÉ„Éà') + ': ' + formatPrice(basePrice),
    '„ÄÄ' + (isSimple ? 'Êê¨ÈÄÅË≤ªÁõÆÂÆâ' : '„Åä„ÇÇ„Å¶„Å™„ÅóË≤ªÁî®ÁõÆÂÆâ') + ': ' + formatPrice(hospEst),
    '„ÄÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',
    '„ÄÄÂêàË®àÁõÆÂÆâ„ÄÄ„ÄÄ„ÄÄ: ' + formatPrice(totalEst),
    '',
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
    '„ÄêÈáçË¶Å„Äë„Åì„Çå„ÅØÊ≠£ÂºèË¶ãÁ©ç„ÇÇ„Çä„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì',
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
    '',
    '‚ö†Ô∏è ‰∏äË®ò„ÅÆÈáëÈ°ç„ÅØÊ¶ÇÁÆó„ÅÆÁõÆÂÆâ„Åß„Åô',
    '',
    'ÂÆüÈöõ„ÅÆË≤ªÁî®„ÅØ‰ª•‰∏ã„Å´„Çà„ÇäÂ§âÂãï„Åó„Åæ„ÅôÔºö',
    '‚Ä¢ „Åä„ÇÇ„Å¶„Å™„ÅóË≤ªÁî®ÔºàÂèÇÂàóËÄÖÊï∞„Å´„Çà„ÇãÔºâ',
    '‚Ä¢ „Ç™„Éó„Ç∑„Éß„É≥„Çµ„Éº„Éì„Çπ„ÅÆÈÅ∏ÊäûÂÜÖÂÆπ',
    '‚Ä¢ ÂºèÂ†¥„ÅÆ‰ΩøÁî®Áä∂Ê≥Å„ÇÑÊó•Á®ã',
    '‚Ä¢ „Åù„ÅÆ‰ªñ„ÅîË¶ÅÊúõ„Å´„Çà„ÇãËøΩÂä†È†ÖÁõÆ',
    '',
    'Ê≠£Âºè„Å™„ÅäË¶ãÁ©ç„ÇÇ„Çä„ÅØ„ÄÅÊãÖÂΩìËÄÖ„Å®„ÅÆÊâì„Å°Âêà„Çè„ÅõÂæå„Å´',
    '‰ΩúÊàê„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇË©≥Á¥∞„ÅØÂøÖ„ÅöÊãÖÂΩìËÄÖ„Å´„ÅîÁ¢∫Ë™ç„Åè„Å†„Åï„ÅÑ„ÄÇ',
    '',
    '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ',
    '',
    '„Äê„ÅîÂ∏åÊúõ„ÉªÂÇôËÄÉ„Äë',
    (state.wishes ? state.wishes.trim() : 'Ôºà„Å™„ÅóÔºâ'),
    '',
    '„Äê„ÉÅ„É£„ÉÉ„ÉàÂ±•Ê≠¥„Äë',
    chatLog,
    '',
    'üìû 0120-315-312Ôºà24ÊôÇÈñìÂèó‰ªòÔºâ',
    'üåê https://saiki-sousai.com/'
  ].join('\n')
  const payload = {
    submitted_at:     dateStr,
    moshuName:        state.moshuName || 'Êú™ÂÖ•Âäõ',
    deceasedName:     state.deceasedName || 'Êú™ÂÖ•Âäõ',
    relation:         getRelationLabel(state.relation),
    phone:            state.phone || 'Êú™ÂÖ•Âäõ',
    attendance:       getAttendanceLabel(state.attendance),
    funeral_type:     getFuneralTypeLabel(state.funeralType),
    plan_name:        plan.name || '',
    hall_name:        hall.name || '',
    hall_address:     hall.address || '',
    hall_access:      hall.access || '',
    course_name:      isSimple ? 'ÔºàÁõ¥Ëë¨„ÉªÁÅ´Ëë¨ÂºèÔºâ' : (courseInfo.name || ''),
    member_status:    getMemberLabel(state.isMember),
    price_estimate:   formatPrice(totalEst) + 'ÔºàÁõÆÂÆâÔºâ',
    wishes:           state.wishes || 'Ôºà„Å™„ÅóÔºâ',
    chat_log:         chatLog,
    to_email:         EMAILJS_TO_EMAIL,
    estimate_detail:  estimateDetail
  };

  try {
    await sendViaEmailJS(payload);
    gaTrack('email_send_success', { hall_name: (state.selectedHall && state.selectedHall.name) || '' });
    showEstimateEmailBanner('success',
      '‚úÖ „É°„Éº„É´ÈÄÅ‰ø°ÂÆå‰∫ÜÔºÅ<br>' +
      '<strong>' + EMAILJS_TO_EMAIL + '</strong> „Å´Ë¶ãÁ©ç„ÇÇ„ÇäÂÜÖÂÆπ„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü„ÄÇ<br>' +
      'ÊãÖÂΩìËÄÖ„Çà„Çä„ÅîÈÄ£Áµ°„Çí„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ„ÄÇ'
    );
    // ÈÄÅ‰ø°Ê∏à„Åø„Éï„É©„Ç∞
    if(btn) { btn.textContent = '‚úÖ ÈÄÅ‰ø°Ê∏à„Åø'; btn.style.background = '#4caf50'; }
  } catch(err) {
    console.error('Ë¶ãÁ©ç„ÇÇ„Çä„É°„Éº„É´ÈÄÅ‰ø°„Ç®„É©„Éº:', err);
    let msg = '‚ùå „É°„Éº„É´ÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ<br>';
    if(err === 'EmailJS not configured') {
      msg += 'EmailJS„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇSERVICE_ID„ÉªTEMPLATE_ID„ÉªPUBLIC_KEY„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
    } else if(err && err.status === 400) {
      msg += '„ÉÜ„É≥„Éó„É¨„Éº„ÉàÂ§âÊï∞Âêç„Åå‰∏ÄËá¥„Åó„Å™„ÅÑÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇEmailJS„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„ÅÆ„ÉÜ„É≥„Éó„É¨„Éº„Éà„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
    } else if(err && err.status === 401) {
      msg += 'PUBLIC_KEY„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇEmailJS„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„ÅßÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
    } else {
      msg += '„ÅäÊâãÊï∞„Åß„Åô„Åå <strong>üìû 0120-315-312</strong> „Åæ„Åß„ÅäÈõªË©±„Åè„Å†„Åï„ÅÑ„ÄÇ<br>';
      msg += '<small style="color:#999;">' + JSON.stringify(err) + '</small>';
    }
    showEstimateEmailBanner('error', msg);
    if(btn) { btn.disabled = false; btn.textContent = '‚úâÔ∏è „É°„Éº„É´ÈÄÅ‰ø°'; }
  }
}

function showEstimateEmailBanner(type, html) {
  const el = document.getElementById('estimateEmailBanner');
  if(!el) return;
  const styles = {
    success: 'background:#e8f5e9; border:2px solid #4caf50; color:#1b5e20;',
    error:   'background:#ffebee; border:2px solid #f44336; color:#b71c1c;',
    warning: 'background:#fff8e1; border:2px solid #ffa000; color:#e65100;'
  };
  el.style.cssText = 'display:block; margin-top:12px; padding:14px 16px; border-radius:10px; font-size:0.9rem; font-weight:bold; line-height:1.8; ' + (styles[type] || styles.warning);
  el.innerHTML = html;
  el.scrollIntoView({ behavior:'smooth', block:'nearest' });
}

// ========== PDF‰øùÂ≠òÔºàhtml2canvas + jsPDFÔºâ ==========
function downloadEstimatePDF() {
  const hall   = state.selectedHall;
  const plan   = state.selectedPlan;
  const course = state.selectedCourse;
  if (!hall || !plan || !course) { alert('Ë¶ãÁ©ç„ÇÇ„ÇäÊÉÖÂ†±„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ'); return; }

  const now2 = new Date();
  const dateStr = now2.getFullYear() + 'Âπ¥'
    + String(now2.getMonth()+1).padStart(2,'0') + 'Êúà'
    + String(now2.getDate()).padStart(2,'0') + 'Êó•';

  const cardEl = document.getElementById('estimateCard');
  const cardHTML = cardEl ? cardEl.innerHTML : '<p>Ë¶ãÁ©ç„ÇÇ„ÇäÊÉÖÂ†±„ÇíÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ</p>';

  const printCSS = `
    @media print { body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } }
    body { font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif; margin: 0; padding: 20px; font-size: 13px; color: #333; }
    .print-header { text-align: center; border-bottom: 2px solid #7CB342; padding-bottom: 10px; margin-bottom: 16px; }
    .print-header h1 { font-size: 20px; color:#33691E; margin: 0 0 4px 0; }
    .print-header .date { font-size: 11px; color: #888; }
    .estimate-section-title { font-weight: bold; color:#33691E; font-size: 13px; margin: 14px 0 6px; padding: 4px 8px; background: #F1F8E9; border-left: 3px solid #7CB342; border-radius: 3px; }
    .estimate-row { display: flex; justify-content: space-between; padding: 5px 4px; border-bottom: 1px dashed #e0d5c5; font-size: 12px; }
    .estimate-label { color: #666; flex: 1; }
    .estimate-value { font-weight: 500; text-align: right; flex: 1; }
    .estimate-total { background: linear-gradient(135deg, #558B2F, #33691E); color: #fff; padding: 12px 14px; border-radius: 8px; margin-top: 12px; text-align: center; }
    .estimate-total-label { font-size: 11px; opacity: 0.85; margin-bottom: 4px; }
    .estimate-total-price { font-size: 22px; font-weight: bold; }
    .estimate-total-note { font-size: 10px; opacity: 0.75; margin-top: 4px; }
    .estimate-total-warning { margin-top: 8px; padding: 10px 12px; background: #fff3e0; border: 3px solid #ff6f00; border-radius: 8px; text-align: left; }
    .estimate-total-warning-title { font-size: 12px; font-weight: bold; color: #d84315; margin-bottom: 6px; text-align: center; }
    .estimate-total-warning-text { font-size: 10px; color: #bf360c; line-height: 1.6; font-weight: 500; }
    .print-footer { margin-top: 20px; padding-top: 10px; border-top: 1px solid #ddd; text-align: center; font-size: 10px; color: #888; }
    .info-box-print { margin-top: 12px; padding: 10px 12px; background: #fff5f5; border: 2px solid #e53935; border-radius: 8px; font-size: 11px; color: #c62828; }
  `;

  const printHTML = '<!DOCTYPE html><html lang="ja"><head>'
    + '<meta charset="UTF-8">'
    + '<meta name="viewport" content="width=device-width,initial-scale=1">'
    + '<title>\u3055\u3044\u304d\u846c\u796d \u304a\u898b\u7a4d\u3082\u308a</title>'
    + '<style>' + printCSS + '</style></head><body>'
    + '<div class="print-header"><h1>\u29f8 \u3055\u3044\u304d\u846c\u796d \u304a\u898b\u7a4d\u3082\u308a</h1>'
    + '<div class="date">\u4f5c\u6210\u65e5: ' + dateStr + '</div></div>'
    + cardHTML
    + '<div class="info-box-print">'
    + '\u26a0\ufe0f \u4e0a\u8a18\u306f\u304a\u898b\u7a4d\u3082\u308a\u306e\u76ee\u5b89\u3067\u3059\u3002\u304a\u3082\u3066\u306a\u3057\u8cbb\u7528\u30fb\u30aa\u30d7\u30b7\u30e7\u30f3\u8cbb\u7528\u306a\u3069\u306f\u53c2\u5217\u8005\u6570\u3084\u5185\u5bb9\u306b\u3088\u308a\u5909\u52d5\u3057\u307e\u3059\u3002\u8a73\u7d30\u306f\u62c5\u5f53\u8005\u306b\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002'
    + '</div>'
    + '<div class="print-footer">'
    + '\ud83d\udcde 0120-315-312\uff0824\u6642\u9593\u53d7\u4ed8\uff09 \uff5c https://saiki-sousai.com/<br>'
    + '\u30a2\u30a4\u30d5\u30a3\u30c3\u30c8\u3055\u3044\u304d\u846c\u796d'
    + '</div>'
    + '<script>window.onload=function(){window.print();};<\/script>'
    + '</body></html>';

  const blob = new Blob([printHTML], { type: 'text/html;charset=utf-8' });
  const url  = URL.createObjectURL(blob);
  const win  = window.open(url, '_blank');
  if (!win) {
    alert('\u30dd\u30c3\u30d7\u30a2\u30c3\u30d7\u304c\u30d6\u30ed\u30c3\u30af\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u30d6\u30e9\u30a6\u30b6\u306e\u30dd\u30c3\u30d7\u30a2\u30c3\u30d7\u3092\u8a31\u53ef\u3057\u3066\u304b\u3089\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002');
    URL.revokeObjectURL(url);
    return;
  }
  setTimeout(function(){ URL.revokeObjectURL(url); }, 30000);
}

function loadScript(src) {
  return new Promise((resolve, reject) => {
    if(document.querySelector(`script[src="${src}"]`)) { resolve(); return; }
    const s = document.createElement('script');
    s.src = src; s.onload = resolve; s.onerror = reject;
    document.head.appendChild(s);
  });
}

// ========== LINEÂÖ±Êúâ ==========
function shareToLINE() {
  const hall   = state.selectedHall;
  const plan   = state.selectedPlan;
  const course = state.selectedCourse;
  if (!hall || !plan) { alert('ÂÖà„Å´Ë¶ãÁ©ç„ÇÇ„Çä„ÇíÂÆåÊàê„Åï„Åõ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'); return; }

  /* ‚îÄ‚îÄ ‰æ°Ê†ºË®àÁÆóÔºàrenderEstimate „Å®Âêå„Åò„É≠„Ç∏„ÉÉ„ÇØÔºâ ‚îÄ‚îÄ */
  const priceType  = (hall.special === 'living') ? 'living' : (plan.priceType || hall.pricingType);
  const pricing    = PRICING[priceType] || PRICING.compact;
  const isSimple   = plan.isSimplePlan || course === 'single';
  let prices;
  if (isSimple) {
    const sp = PRICING[priceType] || PRICING.chokuso;
    prices   = sp ? sp.single : [198000, 248000];
  } else {
    prices = pricing[course] || [0, 0];
  }
  const isMember  = state.isMember === 'yes' || state.isMember === 'join';
  const basePrice = isMember ? prices[0] : prices[1];
  const hospMap   = { under5:35000, under15:52500, '15to30':87500, '30to50':140000, over50:210000 };
  const hospEst   = isSimple ? 30000 : (hospMap[state.attendance] || 70000);
  const optEst    = isSimple ? 0 : 200000;
  const total     = basePrice + hospEst + (isSimple ? 0 : optEst);

  const courseName  = isSimple
    ? 'ÔºàÁõ¥Ëë¨„ÉªÁÅ´Ëë¨Âºè / „Ç≥„Éº„ÇπÈÅ∏Êäû„Å™„ÅóÔºâ'
    : (COURSES[course] ? COURSES[course].name : course);
  const memberTag   = isMember ? '„Äê‰ºöÂì°‰æ°Ê†º„Äë' : '„Äê‰∏ÄËà¨‰æ°Ê†º„Äë';
  const memberNote  = state.isMember === 'join' ? '\n„ÄÄ„ÄÄ‚ÄªÂΩìÊó•‰ºöÂì°ÂÖ•‰ºö„Åß30%Ââ≤Âºï‰∫àÂÆö' : '';

  /* ‚îÄ‚îÄ ÈÄÅ‰ø°„ÉÜ„Ç≠„Çπ„ÉàÁµÑ„ÅøÁ´ã„Å¶ ‚îÄ‚îÄ */
  const SEP  = '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ';
  const SEP2 = '‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ‚îÑ';
  const lines = [
    SEP,
    '„ÄÄüåø „Åï„ÅÑ„ÅçËë¨Á•≠ÔΩú„ÅäË¶ãÁ©ç„ÇÇ„ÇäÂÜÖÂÆπ',
    SEP,
    '',
    'üìã „ÅäÂÆ¢ÊßòÊÉÖÂ†±',
    `„ÄÄÂñ™‰∏ªÂêç„ÄÄ„ÄÄ„ÄÄ: ${state.moshuName || 'Êú™ÂÖ•Âäõ'} Êßò`,
    `„ÄÄÊïÖ‰∫∫ÊßòÂêç„ÄÄ„ÄÄ: ${state.deceasedName || 'Êú™ÂÖ•Âäõ'} Êßò`,
    `„ÄÄÊïÖ‰∫∫„Å®„ÅÆÈñ¢‰øÇ : ${getRelationLabel(state.relation)}`,
    `„ÄÄÂèÇÂàó‰∫àÂÆö‰∫∫Êï∞ : ${getAttendanceLabel(state.attendance)}`,
    `„ÄÄËë¨ÂÑÄ„ÅÆÂΩ¢Âºè„ÄÄ: ${getFuneralTypeLabel(state.funeralType)}`,
    '',
    'üèõ ÈÅ∏ÊäûÂÜÖÂÆπ',
    `„ÄÄ„Éó„É©„É≥„ÄÄ„ÄÄ: ${plan.name}`,
    `„ÄÄ‰ºö„ÄÄÂ†¥„ÄÄ„ÄÄ: ${hall.name}`,
    `„ÄÄ„Äí‰Ωè„ÄÄÊâÄ„ÄÄ: ${hall.address}`,
    `„ÄÄÁ•≠Â£á„Ç≥„Éº„Çπ : ${courseName}`,
    `„ÄÄ‰ºöÂì°Âå∫ÂàÜ„ÄÄ: ${getMemberLabel(state.isMember)}${memberNote}`,
    '',
    'üí¥ Ë≤ªÁî®ÁõÆÂÆâÔºàÁ®éËæºÔºâ',
    `„ÄÄ‚ñ∂ ${isSimple ? 'Áõ¥Ëë¨„ÉªÁÅ´Ëë¨Ë≤ªÁî®' : 'Ëë¨ÂÑÄÂü∫Êú¨„Çª„ÉÉ„Éà'}`,
    `„ÄÄ„ÄÄ ${formatPrice(basePrice)}„ÄÄ${memberTag}`,
    `„ÄÄ‚ñ∂ ${isSimple ? 'Êê¨ÈÄÅË≤ªÁõÆÂÆâ' : '„Åä„ÇÇ„Å¶„Å™„ÅóË≤ªÔºàËøîÁ§ºÂìÅ„ÉªÈ£ü‰∫ãÁ≠âÔºâ'}`,
    `„ÄÄ„ÄÄ ${formatPrice(hospEst)}${isSimple ? '' : '„ÄÄ‚ÄªÂèÇÂàóËÄÖÊï∞„Å´„Çà„ÇäÂ§âÂãï'}`,
  ];
  if (!isSimple) {
    lines.push('„ÄÄ‚ñ∂ „Ç™„Éó„Ç∑„Éß„É≥ÁõÆÂÆâÔºàÁîüËä±„ÉªÊñôÁêÜ„Éª„Éê„ÇπÁ≠âÔºâ');
    lines.push(`„ÄÄ„ÄÄ ${formatPrice(optEst)}„ÄÄ‚ÄªÂÜÖÂÆπ„Å´„Çà„ÇäÂ§âÂãï`);
  }
  lines.push(SEP2);
  lines.push('„ÄÄüí∞ ÂêàË®àÁõÆÂÆâ');
  lines.push(`„ÄÄ„ÄÄ ${formatPrice(total)}„ÄÄ${memberTag}`);
  lines.push('„ÄÄ„ÄÄ ÔºàÊ∂àË≤ªÁ®é10%Ëæº„ÅøÔºâ');
  lines.push('');
  lines.push(SEP);
  lines.push('‚ö†Ô∏è „Åì„ÅÆÈáëÈ°ç„ÅØ„ÅÇ„Åè„Åæ„Åß„ÄêÁõÆÂÆâ„Äë„Åß„Åô„ÄÇ');
  lines.push('„ÄÄ ‰∏çË¶Å„Å™„Ç™„Éó„Ç∑„Éß„É≥„ÅØÂâäÈô§„Åß„Åç„Åæ„Åô„ÄÇ');
  if (state.wishes && state.wishes.trim()) {
    lines.push('');
    lines.push('üìù „ÅîÂ∏åÊúõ„ÉªÂÇôËÄÉ');
    lines.push(state.wishes.trim());
  }
  lines.push('');
  lines.push('üìû 0120-315-312Ôºà24ÊôÇÈñì365Êó•Ôºâ');
  lines.push('üåê https://saiki-sousai.com/');
  lines.push(SEP);

  const text = lines.join('\n');

  /* ‚îÄ‚îÄ URLÁµÑ„ÅøÁ´ã„Å¶„ÉªËµ∑Âãï ‚îÄ‚îÄ */
  const encoded = encodeURIComponent(text);
  const url     = 'https://line.me/R/msg/text/?text=' + encoded;

  const opened = tryOpenUrl(url);
  if(!opened) {
    showShareFallbackModal('LINE„ÅßÂÖ±Êúâ„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü', text, url, 'LINEÁî®„É™„É≥„ÇØ„ÇíÈñã„Åè');
  }

  /* „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: LINE„ÅåÈñã„Åë„Å™„ÅÑÂ†¥Âêà„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº */
  setTimeout(() => {
    if (document.hidden) return; // LINE„ÅåÈñã„ÅÑ„Åü„Å®Âà§Êñ≠
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(text).then(() => {
        alert('LINE„Ç¢„Éó„É™„ÅåÈñã„Åç„Åæ„Åô„ÄÇÈñã„Åã„Å™„ÅÑÂ†¥Âêà„ÅØ„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü„ÄÇ\nLINE„ÅÆ„Éà„Éº„ÇØ„Å´„Éö„Éº„Çπ„Éà„Åó„Å¶„Åä‰Ωø„ÅÑ„Åè„Å†„Åï„ÅÑ„ÄÇ');
      }).catch(() => {});
    }
  }, 2500);

  if (typeof gaTrack === 'function') gaTrack('line_share', { step: state.currentStep });
}

function saveFormData() {
  try {
    const draft = {
      state: {
        moshuName: state.moshuName, deceasedName: state.deceasedName, relation: state.relation,
        attendance: state.attendance, funeralType: state.funeralType,
        isMember: state.isMember, wishes: state.wishes,
        selectedPlan: state.selectedPlan ? state.selectedPlan.id : null,
        selectedHall: state.selectedHall ? state.selectedHall.id : null,
        selectedCourse: state.selectedCourse,
        currentStep: state.currentStep
      },
      savedAt: new Date().toISOString()
    };
    localStorage.setItem(SAVE_KEY, JSON.stringify(draft));
    showAutoSaveBanner('üíæ ÂÖ•ÂäõÂÜÖÂÆπ„ÇíËá™Âãï‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
  } catch(e) { console.warn('Ëá™Âãï‰øùÂ≠òÂ§±Êïó:', e); }
}

function loadFormData() {
  try {
    const raw = localStorage.getItem(SAVE_KEY);
    if(!raw) return false;
    const draft = JSON.parse(raw);
    if(!draft || !draft.state) return false;
    const saved = draft.state;
    const savedAt = draft.savedAt ? new Date(draft.savedAt) : null;
    const now = new Date();
    if(savedAt && (now - savedAt) > 48 * 60 * 60 * 1000) {
      localStorage.removeItem(SAVE_KEY); return false;
    }
    // Á¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞
    const dateStr = savedAt ? (savedAt.getMonth()+1)+'Êúà'+savedAt.getDate()+'Êó• '+String(savedAt.getHours()).padStart(2,'0')+':'+String(savedAt.getMinutes()).padStart(2,'0') : '';
    const msg = `ÂâçÂõû„ÅÆÂÖ•Âäõ„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åó„ÅüÔºà${dateStr}‰øùÂ≠òÔºâ„ÄÇ\nÁ∂ö„Åç„Åã„ÇâÂÜçÈñã„Åó„Åæ„Åô„ÅãÔºü`;
    if(!confirm(msg)) { localStorage.removeItem(SAVE_KEY); return false; }
    // state„ÇíÂæ©ÂÖÉ
    state.moshuName = saved.moshuName || '';
    state.deceasedName = saved.deceasedName || '';
    state.relation = saved.relation || '';
    state.attendance = saved.attendance || '';
    state.funeralType = saved.funeralType || '';
    state.isMember = saved.isMember || '';
    state.wishes = saved.wishes || '';
    if(saved.selectedPlan) {
      // plan„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÂÜçÂèñÂæóÔºàPLANSÂÜÖ„ÇíÊ§úÁ¥¢Ôºâ
      for(const k in PLANS){ if(PLANS[k].id === saved.selectedPlan){ state.selectedPlan = PLANS[k]; break; } }
    }
    if(saved.selectedHall) {
      state.selectedHall = HALLS[saved.selectedHall] || null;
    }
    state.selectedCourse = saved.selectedCourse || null;
    const step = Math.max(1, Math.min(saved.currentStep || 1, 7));
    showAutoSaveBanner('‚úÖ ÂâçÂõû„ÅÆÂÖ•ÂäõÂÜÖÂÆπ„ÇíÂæ©ÂÖÉ„Åó„Åæ„Åó„Åü');
    return step;
  } catch(e) { console.warn('Âæ©ÂÖÉÂ§±Êïó:', e); return false; }
}

function clearSavedData() {
  localStorage.removeItem(SAVE_KEY);
  showAutoSaveBanner('üóë ‰øùÂ≠ò„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
  setTimeout(() => {
    const b = document.getElementById('autoSaveBanner');
    if(b) b.style.display = 'none';
  }, 2000);
}

let _saveTimer = null;
function autoSaveDebounced() {
  clearTimeout(_saveTimer);
  _saveTimer = setTimeout(() => saveFormData(), 1500);
}

function showAutoSaveBanner(msg) {
  const b = document.getElementById('autoSaveBanner');
  const m = document.getElementById('autoSaveMsg');
  if(b && m) {
    m.textContent = msg;
    b.style.display = 'flex';
    clearTimeout(b._hideTimer);
    b._hideTimer = setTimeout(() => { b.style.display = 'none'; }, 3000);
  }
}

// ========== Ëµ∑ÂãïÊôÇÔºöÈÄî‰∏≠‰øùÂ≠ò„Éá„Éº„Çø„ÅÆÂæ©ÂÖÉ ==========
(function initApp() {
  const savedStep = loadFormData();
  if(savedStep && savedStep > 1) {
    // ÁèæÂú®„ÅÆstep1„Çíhide„Åó„Å¶‰øùÂ≠òÊ∏à„Åøstep„Å∏ÈÅ∑Áßª
    document.getElementById('step1').classList.remove('active');
    document.getElementById('dot1').classList.remove('active');
    // 1„ÄúsavedStep-1 „Çí done „Å´„Åô„Çã
    for(let i = 1; i < savedStep; i++) {
      const dot = document.getElementById('dot'+i);
      if(dot) { dot.classList.remove('active'); dot.classList.add('done'); }
      const con = document.getElementById('con'+i);
      if(con) con.classList.add('done');
    }
    state.currentStep = savedStep;
    const stepEl = document.getElementById('step'+savedStep);
    if(stepEl) stepEl.classList.add('active');
    const dotEl = document.getElementById('dot'+savedStep);
    if(dotEl) { dotEl.classList.add('active'); dotEl.classList.remove('done'); }
    // „Çπ„ÉÜ„ÉÉ„ÉóÂõ∫Êúâ„ÅÆÊèèÁîª
    if(savedStep === 3) renderPlans();
    if(savedStep === 4) renderHalls();
    if(savedStep === 5) renderCourses();
    if(savedStep === 7) renderEstimate();
  }
})();
  // ===== ÊúÄÂàù„Å´Êàª„ÇãÈñ¢Êï∞ÔºàÂÖ®„Çπ„ÉÜ„ÉÉ„ÉóÂÖ±ÈÄöÔºâ =====
  function restartApp() {
    // STEP3‰ª•Èôç„ÅØÂÖ•ÂäõÊ∏à„Åø„Éá„Éº„Çø„Åå„ÅÇ„Çã„Åü„ÇÅÂº∑„ÇÅ„ÅÆË≠¶Âëä
    const warningMsg = state.currentStep >= 3
      ? 'ÊúÄÂàù„ÅÆÁîªÈù¢„Å´Êàª„Çä„Åæ„Åô„ÄÇ\n„Åì„Åì„Åæ„Åß„ÅÆÂÖ•ÂäõÂÜÖÂÆπÔºà„Éó„É©„É≥„Éª„Éõ„Éº„É´„Éª„Ç≥„Éº„ÇπÈÅ∏Êäû„Å™„Å©Ôºâ„ÅØ„Åô„Åπ„Å¶„ÇØ„É™„Ç¢„Åï„Çå„Åæ„Åô„ÄÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü'
      : 'ÊúÄÂàù„ÅÆÁîªÈù¢„Å´Êàª„Çä„Åæ„Åô„ÄÇÂÖ•ÂäõÂÜÖÂÆπ„ÅØ„ÇØ„É™„Ç¢„Åï„Çå„Åæ„Åô„Åå„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü';

    if (!confirm(warningMsg)) return;

    // state „ÇíÂÆåÂÖ®ÂàùÊúüÂåñ
    state.moshuName      = '';
    state.deceasedName   = '';
    state.relation       = '';
    state.phone          = '';
    state.attendance     = '';
    state.funeralType    = '';
    state.selectedPlan   = null;
    state.selectedHall   = null;
    state.selectedCourse = null;
    state.wishes         = '';
    state.concerns       = '';
    state.chatLog        = [];
    state.isMember       = '';
    state.religion       = '';
    state.templeInfo     = '';

    // „Éï„Ç©„Éº„É†ÂÖ•ÂäõÊ¨Ñ„Çí„ÇØ„É™„Ç¢
    ['clientName','clientRelation','clientPhone'].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.value = '';
    });

    // ÈÅ∏ÊäûÊ∏à„Åø„Éè„Ç§„É©„Ç§„Éà„Çí„É™„Çª„ÉÉ„Éà
    document.querySelectorAll('.btn-choice.selected').forEach(b => b.classList.remove('selected'));

    // localStorage „ÅÆ„Ç™„Éº„Éà„Çª„Éº„Éñ„Çí„ÇØ„É™„Ç¢
    try { localStorage.removeItem('saikiFormData'); } catch(e) {}

    // STEP1„Å∏ÈÅ∑Áßª„Åó„Å¶„Éà„ÉÉ„Éó„Å∏„Çπ„ÇØ„É≠„Éº„É´
    goToStep(1);
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }


// ===== SMS ÂÖ±Êúâ =====
function smsShare() {
  const hall   = state.selectedHall;
  const plan   = state.selectedPlan;
  const course = state.selectedCourse;

  /* Ë≤ªÁî®Ë®àÁÆó */
  let totalStr = '';
  if (hall && plan && course) {
    const priceType = (hall.special === 'living') ? 'living' : (plan.priceType || hall.pricingType);
    const pricing   = PRICING[priceType] || PRICING.compact;
    const isSimple  = plan.isSimplePlan || course === 'single';
    let prices;
    if (isSimple) {
      const sp = PRICING[priceType] || PRICING.chokuso;
      prices   = sp ? sp.single : [198000, 248000];
    } else {
      prices = pricing[course] || [0, 0];
    }
    const isMember  = state.isMember === 'yes' || state.isMember === 'join';
    const basePrice = isMember ? prices[0] : prices[1];
    const hospMap   = { under5:35000, under15:52500, '15to30':87500, '30to50':140000, over50:210000 };
    const hospEst   = isSimple ? 30000 : (hospMap[state.attendance] || 70000);
    const optEst    = isSimple ? 0 : 200000;
    const total     = basePrice + hospEst + (isSimple ? 0 : optEst);
    totalStr        = '\nÂêàË®àÁõÆÂÆâ: ' + formatPrice(total) + (isMember ? '„Äê‰ºöÂì°„Äë' : '„Äê‰∏ÄËà¨„Äë');
  }

  const hallName   = (hall && hall.name)      || 'Êú™ÈÅ∏Êäû';
  const planName   = (plan && plan.name)      || 'Êú™ÈÅ∏Êäû';
  const courseName = course
    ? (COURSES[course] ? COURSES[course].name : course)
    : 'Êú™ÈÅ∏Êäû';

  const body = [
    '„ÄêÈáçË¶Å„Äë„Åì„Çå„ÅØÊ≠£ÂºèË¶ãÁ©ç„ÇÇ„Çä„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì',
    '',
    '„Äê„Åï„ÅÑ„ÅçËë¨Á•≠ Ê¶ÇÁÆó„ÅäË¶ãÁ©ç„ÇÇ„Çä„Äë',
    `${state.moshuName || '„ÅäÂÆ¢Êßò'} Êßò`,
    '',
    '‚ñº „ÅîÈÅ∏ÊäûÂÜÖÂÆπ',
    `ÂºèÂ†¥: ${hallName}`,
    `„Éó„É©„É≥: ${planName}`,
    `Á•≠Â£á: ${courseName}`,
    ...(state.religion ? [`ÂÆóÊïô: ${state.religion}`] : []),
    totalStr,
    '',
    'üìû 0120-315-312',
    'Ôºà24ÊôÇÈñì365Êó•Âèó‰ªòÔºâ',
  ].join('\n');

  const encoded = encodeURIComponent(body);
  const ua  = navigator.userAgent;
  const url = /iPhone|iPad|iPod/.test(ua)
    ? 'sms:&body='  + encoded
    : 'sms:?body='  + encoded;

  // iOS/SNSÂÜÖ„Éñ„É©„Ç¶„Ç∂ÂØæÁ≠ñÔºö„Éó„É≠„Ç∞„É©„É†„ÇØ„É™„ÉÉ„ÇØ„Çà„Çä location.href „ÅÆÊñπ„ÅåÊàêÂäüÁéá„ÅåÈ´ò„ÅÑ
  try {
    window.location.href = url;
  } catch(e) {
    console.warn('SMS: location.href failed', e);
  }

  if (typeof gaTrack === 'function') gaTrack('sms_share', { step: state.currentStep });
}


// ========== ÂÆóÊïô„ÉªËè©ÊèêÂØ∫Èñ¢ÈÄ£„ÅÆÈñ¢Êï∞ ==========
function updateReligionState() {
  state.religion = document.getElementById('religion').value;
  saveToLocalStorage();
}

function updateTempleState() {
  state.templeInfo = document.getElementById('templeInfo').value.trim();
  saveToLocalStorage();
}



// ================================
// ÂÖ±Êúâ/Âá∫Âäõ„ÅåÈñã„Åë„Å™„ÅÑÁí∞Â¢ÉÂêë„Åë„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ
// ================================
function showShareFallbackModal(title, text, actionUrl, actionLabel) {
  const old = document.getElementById('shareFallbackModal');
  if (old) old.remove();

  const overlay = document.createElement('div');
  overlay.id = 'shareFallbackModal';
  overlay.style.cssText = [
    'position:fixed','inset:0','z-index:99999',
    'background:rgba(0,0,0,0.55)','display:flex',
    'align-items:center','justify-content:center','padding:18px'
  ].join(';');

  const card = document.createElement('div');
  card.style.cssText = [
    'width:100%','max-width:560px','background:#fff','border-radius:14px',
    'border:3px solid #ff6f00','box-shadow:0 10px 30px rgba(0,0,0,0.25)',
    'padding:16px 14px','font-family:"Noto Sans JP",sans-serif'
  ].join(';');

  const h = document.createElement('div');
  h.textContent = title || 'ÂÖ±Êúâ„Å´Â§±Êïó„Åó„Åæ„Åó„ÅüÔºà„Ç≥„Éî„Éº„Åó„Å¶„Åä‰Ωø„ÅÑ„Åè„Å†„Åï„ÅÑÔºâ';
  h.style.cssText = 'font-weight:900;font-size:1.05rem;color:#d84315;text-align:center;margin-bottom:10px;';

  const note = document.createElement('div');
  note.innerHTML = '„Åä‰Ωø„ÅÑ„ÅÆÁí∞Â¢ÉÔºà„Ç¢„Éó„É™ÂÜÖ„Éñ„É©„Ç¶„Ç∂/„Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóÂà∂ÈôêÁ≠âÔºâ„Å´„Çà„Çä„ÄÅÂÖ±ÊúâÁîªÈù¢„ÅåÈñã„Åë„Å™„ÅÑÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ<br><strong>‰∏ã„ÅÆÂÜÖÂÆπ„Çí„Ç≥„Éî„Éº„Åó„Å¶</strong> LINE/SMS „Å´Ë≤º„Çä‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
  note.style.cssText = 'font-size:0.88rem;line-height:1.7;color:#5d4037;background:#fff3e0;padding:10px;border-radius:10px;margin-bottom:10px;';

  const ta = document.createElement('textarea');
  ta.value = text || '';
  ta.readOnly = true;
  ta.style.cssText = 'width:100%;height:210px;resize:vertical;border:2px solid #ffe0b2;border-radius:10px;padding:10px;font-size:0.86rem;line-height:1.55;';

  const btnRow = document.createElement('div');
  btnRow.style.cssText = 'display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;';

  const copyBtn = document.createElement('button');
  copyBtn.type = 'button';
  copyBtn.textContent = 'üìã „Ç≥„Éî„Éº';
  copyBtn.style.cssText = 'flex:1;min-width:140px;padding:12px;border:none;border-radius:12px;background:linear-gradient(135deg,#ff6f00,#e65100);color:#fff;font-weight:900;';
  copyBtn.onclick = async () => {
    try {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(ta.value);
      } else {
        ta.focus(); ta.select();
        document.execCommand('copy');
      }
      copyBtn.textContent = '‚úÖ „Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü';
      setTimeout(()=>copyBtn.textContent='üìã „Ç≥„Éî„Éº', 1400);
    } catch(e) {
      alert('„Ç≥„Éî„Éº„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„ÉÜ„Ç≠„Çπ„Éà„ÇíÈï∑Êäº„Åó/ÈÅ∏Êäû„Åó„Å¶„Ç≥„Éî„Éº„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
    }
  };

  let openLink = null;
  if (actionUrl) {
    openLink = document.createElement('a');
    openLink.href = actionUrl;
    openLink.target = '_blank';
    openLink.rel = 'noopener noreferrer';
    openLink.textContent = actionLabel || 'üîó „É™„É≥„ÇØ„ÇíÈñã„Åè';
    openLink.style.cssText = 'flex:1;min-width:160px;padding:12px;border:2px solid #ff6f00;border-radius:12px;background:#fff;color:#e65100;font-weight:900;text-align:center;text-decoration:none;display:inline-block;';
  }

  const closeBtn = document.createElement('button');
  closeBtn.type = 'button';
  closeBtn.textContent = 'Èñâ„Åò„Çã';
  closeBtn.style.cssText = 'min-width:120px;padding:12px;border:2px solid #ddd;border-radius:12px;background:#fff;color:#555;font-weight:800;';
  closeBtn.onclick = () => overlay.remove();

  btnRow.appendChild(copyBtn);
  if (openLink) btnRow.appendChild(openLink);
  btnRow.appendChild(closeBtn);

  card.appendChild(h);
  card.appendChild(note);
  card.appendChild(ta);
  card.appendChild(btnRow);

  overlay.appendChild(card);
  overlay.addEventListener('click', (e) => { if (e.target === overlay) overlay.remove(); });
  document.body.appendChild(overlay);
}

function tryOpenUrl(url) {
  // window.open „Åå‰Ωø„Åà„Å™„ÅÑÁí∞Â¢É„ÇÇ„ÅÇ„Çã„Åü„ÇÅË§áÊï∞ÊâãÊÆµ
  let win = null;
  try { win = window.open(url, '_blank'); } catch(e) {}
  if (win) return true;
  try {
    window.location.href = url;
    return true;
  } catch(e) {}
  return false;
}
</script>
</body>
</html>